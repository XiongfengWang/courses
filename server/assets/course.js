/* (c) Mathigon */
var App=function(exports){'use strict';function __decorate(e,t,n,s){var a=arguments.length,o=3>a?t:null===s?s=Object.getOwnPropertyDescriptor(t,n):s,l;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,s);else for(var p=e.length-1;0<=p;p--)(l=e[p])&&(o=(3>a?l(o):3<a?l(t,n,o):l(t,n))||o);return 3<a&&o&&Object.defineProperty(t,n,o),o}function __awaiter(e,t,i,n){return new(i||(i=Promise))(function(s,r){function a(e){try{l(n.next(e))}catch(t){r(t)}}function o(e){try{l(n["throw"](e))}catch(t){r(t)}}function l(e){e.done?s(e.value):new i(function(t){t(e.value)}).then(a,o)}l((n=n.apply(e,t||[])).next())})}function isOneOf(e,...t){for(let i of t)if(e===i)return!0;return!1}function delay(e,i=0){return i?+setTimeout(e,i):(e(),0)}function wait(e){return new Promise(t=>setTimeout(t,e))}function defer(){let e=()=>{},t=()=>{};const i=new Promise((i,n)=>{e=i,t=n});return i.catch(e=>e),{promise:i,resolve:e,reject:t}}function repeat(e,t){return Array(t).fill(e)}function repeat2D(e,t,n){const s=[];for(let r=0;r<t;++r)s.push(repeat(e,n));return s}function tabulate(e,t){const n=[];for(let s=0;s<t;++s)n.push(e(s));return n}function last(e,t=0){return e[e.length-1-t]}function total(e){return e.reduce((e,t)=>e+t,0)}function sortBy(e,t,i=!1){return e.slice(0).sort((e,n)=>{const s=t(e),r=t(n);return s<r?i?1:-1:s>r?i?-1:1:0})}function loop(e){let t=0;return()=>e[t++%e.length]}function cumulative(e){let t=0;return e.map(e=>t+=e)}function words(e,t=/\s+/){return e?e.trim().split(t):[]}function toCamelCase(e){return e.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(e,t)=>t.toUpperCase())}function stringDistance(e,t){let n=repeat2D(0,e.length+1,t.length+1);for(let s=0;s<=e.length;s++)n[s][0]=s;for(let s=0;s<=t.length;s++)n[0][s]=s;for(let s=1;s<=e.length;s++)for(let i=1;i<=t.length;i++)n[s][i]=Math.min(n[s-1][i-1]+(e.charAt(s-1)===t.charAt(i-1)?0:1),n[s-1][i]+1,n[s][i-1]+1);return n[e.length][t.length]}function autoCorrect(e,t){let i=e.length/2,n=t.map(t=>({w:t,d:stringDistance(e,t)})).filter(({d:e})=>e<i),s=sortBy(n,e=>e.d)[0];return s?s.w:null}function pad2(e){return 1===e.length?"0"+e:e}function getColourAt(e,t){if(0>=t)return e[0];if(1<=t)return last(e);const i=Math.floor(t*(e.length-1)),n=t*(e.length-1)-i;return Color.mix(e[i+1],e[i],n)}function isOneOf$1(e,...t){for(let i of t)if(e===i)return!0;return!1}function applyDefaults(e,t){for(let i of Object.keys(t))e.hasOwnProperty(i)||(e[i]=t[i]);return e}function deepExtend(e,t,n=defaultMerge){for(const s of Object.keys(t))s in e&&Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=n(e[s],t[s]):s in e&&e[s]instanceof Object&&t[s]instanceof Object?deepExtend(e[s],t[s]):e[s]=t[s]}function delay$1(e,i=0){return i?+setTimeout(e,i):(e(),0)}function defer$1(){let e=()=>{},t=()=>{};const i=new Promise((i,n)=>{e=i,t=n});return i.catch(e=>e),{promise:i,resolve:e,reject:t}}function throttle(e,i=0){let t=!1,n=!1;return function(...s){t?n=!0:(e(...s),t=!0,setTimeout(function(){n&&e(...s),t=!1,n=!1},i))}}function safeToJSON(e,t={}){if(!e)return t;try{return JSON.parse(e)||t}catch(i){return t}}function repeat$1(e,t){return Array(t).fill(e)}function last$1(e,t=0){return e[e.length-1-t]}function total$1(e){return e.reduce((e,t)=>e+t,0)}function unique(e){return e.filter((t,n)=>e.indexOf(t)===n)}function words$1(e,t=/\s+/){return e?e.trim().split(t):[]}function toCamelCase$1(e){return e.toLowerCase().replace(/^-/,"").replace(/-(.)/g,(e,t)=>t.toUpperCase())}function toQueryString(e){const t=[];for(let i of Object.keys(e)){let n=e[i];if(i=encodeURIComponent(i),null==n){t.push(i);continue}n=Array.isArray(n)?n.join(","):""+n,n=n.replace(/(\r)?\n/g,"\r\n"),n=encodeURIComponent(n),n=n.replace(/%20/g,"+"),t.push(i+"="+n)}return t.join("&")}function post(e,t){const i={method:"POST",body:t?"string"==typeof t?t:toQueryString(t):void 0,headers:{"Content-Type":"application/x-www-form-urlencoded","X-CSRF-Token":window.csrfToken||""}};return fetch(e,i).then(e=>e.text())}function loadImage(e){return new Promise(t=>{const i=new Image;i.onload=()=>t(i),i.src=e})}function savePostData(e,t){POST_DATA.has(e)?deepExtend(POST_DATA.get(e),t,(e,t)=>unique(e.concat(t))):POST_DATA.set(e,t)}function sendPostData(){if(window.navigator.onLine)for(const[e,t]of POST_DATA)POST_DATA.delete(e),post(e,{data:JSON.stringify(t)}).catch(i=>{console.error("Failed to send POST request:",i),savePostData(e,t)})}function deferredPost(e,t){savePostData(e,t),doDeferredPost()}function nearlyEquals(e,i,n=PRECISION){return!(isNaN(e)||isNaN(i))&&Math.abs(e-i)<n}function isBetween(e,i,n,s=PRECISION){return i>n&&([i,n]=[n,i]),e>i+s&&e<n-s}function roundTo(e,t=1){return Math.round(e/t)*t}function clamp(e,t=-Infinity,i=1/0){return Math.min(i,Math.max(t,e))}function lerp(e,i,n=.5){return e+(i-e)*n}function square(e){return e*e}function subsets(e,t=0){const i=e.slice(0),n=subsetsHelper(i);return t?n.filter(e=>e.length===t):n}function subsetsHelper(e){if(1===e.length)return[[],e];const t=e.pop(),i=subsetsHelper(e),n=[];for(const r of i)n.push(r,[...r,t]);return n}function uid(e=10){return Math.random().toString(36).substr(2,e)}function isOneOf$2(e,...t){for(let i of t)if(e===i)return!0;return!1}function repeat$2(e,t){return Array(t).fill(e)}function repeat2D$1(e,t,n){const s=[];for(let r=0;r<t;++r)s.push(repeat$2(e,n));return s}function tabulate2D(e,t,n){const s=[];for(let r=0;r<t;++r){const t=[];for(let i=0;i<n;++i)t.push(e(r,i));s.push(t)}return s}function list(e,t,n=1){const s=[];if(void 0===t&&0<=e)for(let t=0;t<e;t+=n)s.push(t);else if(void 0===t)for(let t=0;t>e;t-=n)s.push(t);else if(e<=t)for(let r=e;r<=t;r+=n)s.push(r);else for(let r=e;r>=t;r-=n)s.push(r);return s}function total$2(e){return e.reduce((e,t)=>e+t,0)}function flatten(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?flatten(t):t),[])}function rad(e,t=ORIGIN){const i=Math.atan2(e.y-t.y,e.x-t.x);return(i+TWO_PI)%TWO_PI}function liesOnSegment(e,t){return nearlyEquals(e.p1.x,e.p2.x)?isBetween(t.y,e.p1.y,e.p2.y):isBetween(t.x,e.p1.x,e.p2.x)}function liesOnRay(e,t){return nearlyEquals(e.p1.x,e.p2.x)?0<(t.y-e.p1.y)/(e.p2.y-e.p1.y):0<(t.x-e.p1.x)/(e.p2.x-e.p1.x)}function lineLineIntersection(e,t){const i=e.p1.x-e.p2.x,n=e.p1.y-e.p2.y,s=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,a=i*r-n*s;if(nearlyEquals(a,0))return[];const o=e.p1.x*e.p2.y-e.p1.y*e.p2.x,l=t.p1.x*t.p2.y-t.p1.y*t.p2.x;return[new Point((o*s-i*l)/a,(o*r-n*l)/a)]}function circleCircleIntersection(e,t){const i=Point.distance(e.c,t.c);if(i>e.r+t.r)return[];if(i<Math.abs(e.r-t.r))return[];if(nearlyEquals(i,0)&&nearlyEquals(e.r,t.r))return[];if(nearlyEquals(i,e.r+t.r))return[new Line(e.c,t.c).midpoint];const n=(square(e.r)-square(t.r)+square(i))/(2*i),s=Math.sqrt(square(e.r)-square(n)),r=(t.c.x-e.c.x)*n/i+(t.c.y-e.c.y)*s/i+e.c.x,a=(t.c.y-e.c.y)*n/i-(t.c.x-e.c.x)*s/i+e.c.y,o=(t.c.x-e.c.x)*n/i-(t.c.y-e.c.y)*s/i+e.c.x,l=(t.c.y-e.c.y)*n/i+(t.c.x-e.c.x)*s/i+e.c.y;return[new Point(r,a),new Point(o,l)]}function lineCircleIntersection(e,t){const i=e.p2.x-e.p1.x,n=e.p2.y-e.p1.y,s=square(i)+square(n),r=t.c.x,a=t.c.y,o=(e.p1.x-r)*(e.p2.y-a)-(e.p2.x-r)*(e.p1.y-a),l=square(t.r)*s-square(o);if(0>l)return[];const d=o*n/s,p=-o*i/s;if(nearlyEquals(l,0))return[t.c.shift(d,p)];const c=i*(0>n?-1:1)*Math.sqrt(l)/s,h=Math.abs(n)*Math.sqrt(l)/s;return[t.c.shift(d+c,p+h),t.c.shift(d-c,p-h)]}function isPolygonLike(e){return isOneOf$2(e.type,"polygon","polyline","rectangle")}function isLineLike(e){return isOneOf$2(e.type,"line","ray","segment")}function isCircle(e){return"circle"===e.type}function intersections(...e){if(2>e.length)return[];if(2<e.length)return flatten(subsets(e,2).map(t=>intersections(...t)));let[t,i]=e;if(isPolygonLike(i)&&([t,i]=[i,t]),isPolygonLike(t)){const e=isLineLike(i)?t.points.filter(e=>i.contains(e)):[];return[...e,...intersections(i,...t.edges)]}return simpleIntersection(t,i)}function simpleIntersection(e,t){let i=[];isLineLike(e)&&isLineLike(t)?i=lineLineIntersection(e,t):isLineLike(e)&&isCircle(t)?i=lineCircleIntersection(e,t):isCircle(e)&&isLineLike(t)?i=lineCircleIntersection(t,e):isCircle(e)&&isCircle(t)&&(i=circleCircleIntersection(e,t));for(const n of[e,t])"segment"===n.type&&(i=i.filter(e=>liesOnSegment(n,e))),"ray"===n.type&&(i=i.filter(e=>liesOnRay(n,e)));return i}function pointerPosition(t){if(t instanceof TouchEvent){const e=t.targetTouches.length?t.targetTouches:t.changedTouches;return new Point(e[0].clientX,e[0].clientY)}return new Point(t.clientX,t.clientY)}function getTouches(t){return t instanceof TouchEvent?t.touches:[]}function svgPointerPosn(e,t){const i=pointerPosition(e);return i.transform(t.inverseTransformMatrix)}function canvasPointerPosition(e,t){const i=pointerPosition(e),n=t.bounds,s=(i.x-n.left)*t.canvasWidth/n.width,r=(i.y-n.top)*t.canvasHeight/n.height;return new Point(s,r)}function getEventTarget(e){if(e instanceof PointerEvent&&"mouse"===e.pointerType)return $(e.target);const t=pointerPosition(e);return $(document.elementFromPoint(t.x,t.y))}function makeTapEvent(t){if(t._data.tapEvent)return;t._data.tapEvent=!0;let i=null;t.on("pointerdown",t=>i=pointerPosition(t)),t.on("pointerup",n=>{if(i){const e=pointerPosition(n);6>Point.distance(i,e)&&t.trigger("tap",n),i=null}}),t.on("pointercancel",()=>i=null)}function makeClickOutsideEvent(t){t._data.clickOutsideEvent||(t._data.clickOutsideEvent=!0,$body.on("pointerdown",i=>{const e=$(i.target);e&&(e.equals(t)||e.hasParent(t))||t.trigger("clickOutside",i)}))}function slide(t,i){function n(t){t.preventDefault(),t.handled||1<getTouches(t).length||(t.handled=!0,"move"in i&&l.on("pointermove",s),l.on("pointerstop",r),d=c=o(t),i.start&&i.start(d))}function s(t){t.preventDefault(),a||(a=!0,window.requestAnimationFrame(function(){if(a){const e=o(t);i.move&&i.move(e,d,c),c=e,a=!1}}))}function r(t){t.preventDefault(),0<getTouches(t).length||(a=!1,i.move&&l.off("pointermove",s),l.off("pointerstop",r),i.end&&i.end(c,d))}let a=!1,o=pointerPosition;t instanceof SVGBaseView?o=i=>svgPointerPosn(i,t.$ownerSVG):t instanceof CanvasView&&(o=i=>canvasPointerPosition(i,t));const l=i.justInside?t:$body;let d=null,c=null;"auto"===t.css("touch-action")&&t.css("touch-action","none"),t.on("pointerdown",n),i.justInside&&t.on("mouseleave",r)}function makeScrollEvents(e){function t(){const i=e.scrollTop;return i===a?void(r=!1):void(a=i,e.trigger("scroll",{top:a}),window.requestAnimationFrame(t))}function i(){r||window.requestAnimationFrame(t),r=!0}function n(){window.addEventListener("touchmove",i),window.addEventListener("touchend",s)}function s(){window.removeEventListener("touchmove",i),window.removeEventListener("touchend",s)}if(e._data.scrollEvents)return;e._data.scrollEvents=!0;let r=!1,a=null;const o=e instanceof WindowView?window:e._el;o.addEventListener("scroll",i),e._el.addEventListener("touchstart",function(t){t.handled||n()})}function hover(e,t){let i=0,n=!1,s=!1;e.on("mouseover",()=>{t.preventMouseover&&t.preventMouseover()||(clearTimeout(i),i=delay$1(()=>{n||(t.enter&&t.enter(),s=!0,n=!0)},t.delay))}),e.on("mouseout",()=>{s&&(clearTimeout(i),i=delay$1(()=>{n&&(t.exit&&t.exit(),n=!1)},t.exitDelay||t.delay))});const r=t.$clickTarget||e;r.on("click",()=>{n&&!s?(t.exit&&t.exit(),n=!1):!n&&(t.enter&&t.enter(),s=!1,n=!0)}),e.on("clickOutside",()=>{n&&(t.exit&&t.exit(),n=!1)})}function intersectionCallback(t){for(const i of t){const e=i.isIntersecting?"enterViewport":"exitViewport";setTimeout(()=>$(i.target).trigger(e))}}function makeIntersectionEvents(e){if(!e._data.intersectionEvents){if(e._data.intersectionEvents=!0,!window.IntersectionObserver){let t=!1;return void $body.on("scroll",()=>{const i=e.isInViewport;t&&!i?(e.trigger("exitViewport"),t=!1):i&&!t&&(e.trigger("enterViewport"),t=!0)})}observer||(observer=new IntersectionObserver(intersectionCallback)),observer.observe(e._el)}}function makePointerPositionEvents(t){if(t._data.pointerPositionEvents)return;t._data.pointerPositionEvents=!0;const i=t.parent;let n=null;i.on("pointerend",()=>n=null),i.on("pointermove",i=>{const e=n,s=getEventTarget(i);n=s.equals(t)||s.hasParent(t),null!=e&&n&&!e&&t.trigger("pointerenter",i),!n&&e&&t.trigger("pointerleave",i)})}function makeMouseEvent(t,i){i._events["_"+t]||(i._events["_"+t]=!0,pointerSupport?i.on(t.replace("mouse","pointer"),n=>{"mouse"===n.pointerType&&i.trigger(t,n)}):!touchSupport&&i._el.addEventListener(t,n=>i.trigger(t,n)))}function makeKeyEvent(t){t.on("keydown",i=>{if(!(i.metaKey||i.ctrlKey)&&!(Browser.isAndroid&&229===i.keyCode)){const e=(i.key||String.fromCharCode(i.which)).toLowerCase();t.trigger("key",{code:i.keyCode,key:e})}}),Browser.isAndroid&&t instanceof InputView&&t.on("input",i=>{const e=i.data[i.data.length-1].toLowerCase();t.trigger("key",{code:null,key:e}),t.value=""})}function bindEvent(t,i,n,s){if(i in aliases){const r=words$1(aliases[i]);for(const i of r)t._el.addEventListener(i,n,s)}else i in customEvents?customEvents[i](t):t._el.addEventListener(i,n,s)}function unbindEvent(t,i,n){if(i in aliases){const s=words$1(aliases[i]);for(const i of s)t._el.removeEventListener(i,n)}else if(i in customEvents);else t._el.removeEventListener(i,n)}function drawArc(e,t,i){const n=t.x*(i.y-e.y)+e.x*(t.y-i.y)+i.x*(e.y-t.y),s=0<n?1:0,r=Point.distance(t,e);return[e.x,e.y+"A"+r,r,0,s,1,i.x,i.y].join(",")}function angleSize(e,t={}){return e.isRight&&!t.round?20:24+20*(1-clamp(e.rad,0,Math.PI)/Math.PI)}function drawAngle(e,t={}){let i=e.a;const n=e.b;let s=e.c;const r=t.size||angleSize(e,t),o=Point.difference(i,n).unitVector,l=Point.difference(s,n).unitVector;i=Point.sum(n,o.scale(r)),s=Point.sum(n,l.scale(r));let h=t.fill?`M${n.x},${n.y}L`:"M";if(e.isRight&&!t.round){const e=Point.sum(i,l.scale(r));h+=`${i.x},${i.y}L${e.x},${e.y}L${s.x},${s.y}`}else h+=drawArc(i,n,s);return t.fill&&(h+="Z"),h}function drawPath(...e){return"M"+e.map(e=>e.x+","+e.y).join("L")}function drawLineMark(e,t){const i=e.perpendicularVector.scale(6),s=e.unitVector.scale(3),n=e.midpoint;return t===LineMark.BAR?drawPath(n.add(i),n.add(i.inverse)):t===LineMark.BAR2?drawPath(n.add(s).add(i),n.add(s).add(i.inverse))+drawPath(n.add(s.inverse).add(i),n.add(s.inverse).add(i.inverse)):t===LineMark.ARROW?drawPath(n.add(s.inverse).add(i),n.add(s),n.add(s.inverse).add(i.inverse)):t===LineMark.ARROW2?drawPath(n.add(s.scale(-2)).add(i),n,n.add(s.scale(-2)).add(i.inverse))+drawPath(n.add(i),n.add(s.scale(2)),n.add(i.inverse)):void 0}function arrowPath(e,t){if(!e||!t)return"";const i=t.perpendicular,n=e.add(t.scale(9)).add(i.scale(9)),s=e.add(t.scale(9)).add(i.scale(-9));return drawPath(n,e,s)}function drawLineArrows(e,t){let i="";return isOneOf$1(t,LineArrow.START,LineArrow.BOTH)&&(i+=arrowPath(e.p1,e.unitVector)),isOneOf$1(t,LineArrow.END,LineArrow.BOTH)&&(i+=arrowPath(e.p2,e.unitVector.inverse)),i}function drawArcArrows(e,t){let i="";if(isOneOf$1(t,LineArrow.START,LineArrow.BOTH)){const t=new Line(e.c,e.start).perpendicularVector.inverse;i+=arrowPath(e.start,t)}if(isOneOf$1(t,LineArrow.END,LineArrow.BOTH)){const t=new Line(e.c,e.end).perpendicularVector;i+=arrowPath(e.end,t)}return i}function drawSVG(e,t={}){if("angle"===e.type)return e=e,drawAngle(e,t);if("segment"===e.type){if(e=e,e.p1.equals(e.p2))return"";let i=drawPath(e.p1,e.p2);return t.mark&&(i+=drawLineMark(e,t.mark)),t.arrows&&(i+=drawLineArrows(e,t.arrows)),i}if("ray"===e.type){if(e=e,!t.box)return"";const i=intersections(e,t.box)[0];return i?drawPath(e.p1,i):""}if("line"===e.type){if(e=e,!t.box)return"";const i=intersections(e,t.box);if(2>i.length)return"";let n=drawPath(i[0],i[1]);return t.mark&&(n+=drawLineMark(e,t.mark)),n}if("circle"===e.type)return e=e,`M ${e.c.x-e.r} ${e.c.y} a ${e.r},${e.r} 0 1 0 `+`${2*e.r} 0 a ${e.r} ${e.r} 0 1 0 ${-2*e.r} 0`;if("arc"===e.type){e=e;let i="M"+drawArc(e.start,e.c,e.end);return t.arrows&&(i+=drawArcArrows(e,t.arrows)),i}return"sector"===e.type?(e=e,`M ${e.c.x} ${e.c.y} L ${drawArc(e.start,e.c,e.end)} Z`):"polyline"===e.type?(e=e,drawPath(...e.points)):"polygon"===e.type||"triangle"===e.type?(e=e,drawPath(...e.points)+"Z"):"rectangle"===e.type?(e=e,drawPath(...e.polygon.points)+"Z"):""}function drawCanvas(e,t,i={}){if(i.fill&&(e.fillStyle=i.fill),i.opacity&&(e.globalAlpha=i.opacity),i.stroke&&(e.strokeStyle=i.stroke,e.lineWidth=i.strokeWidth||1,i.lineCap&&(e.lineCap=i.lineCap),i.lineJoin&&(e.lineJoin=i.lineJoin)),e.beginPath(),"segment"===t.type)t=t,e.moveTo(t.p1.x,t.p1.y),e.lineTo(t.p2.x,t.p2.y);else if("circle"===t.type)t=t,e.arc(t.c.x,t.c.y,t.r,0,2*Math.PI);else if("polygon"===t.type||"triangle"===t.type){t=t,e.moveTo(t.points[0].x,t.points[0].y);for(const i of t.points.slice(1))e.lineTo(i.x,i.y);e.closePath()}else if("polyline"===t.type){t=t,e.moveTo(t.points[0].x,t.points[0].y);for(const i of t.points.slice(1))e.lineTo(i.x,i.y)}i.fill&&e.fill(),i.stroke&&e.stroke()}function observable(e={}){function t(t,i){s[t]=i,t in e||Object.defineProperty(e,t,{get:()=>s[t],set(i){s[t]=i,e.update()}})}const i=[],s={};let r=1,a=ALPHABETH.split("").map(e=>"_"+e);for(const i of Object.keys(e))t(i,e[i]);return e.update=()=>{for(const e of i)e(s)},e.watch=(e,t)=>{i.push(e),t||e(s)},e.set=(i,n)=>{s[i]===n||(t(i,n),e.update())},e.assign=i=>{for(const e of Object.keys(i))t(e,i[e]);e.update()},e.name=()=>(a.length||(r+=1,a=ALPHABETH.split("").map(e=>repeat$1("_",r)+e)),a.pop()),e}function parse(t,i=!0){let n=t.replace(/×/g,"*");i&&(n=n.replace(/"/g,"\"").replace(/\${([^}]+)}/g,(e,t)=>`" + (${t}) + "`),n="\""+n+"\"");try{return new Function("_vars",`try {
      with(_vars) { return ${n} }
    } catch(_error) {
      if (!(_error instanceof ReferenceError)) console.warn(_error);
      return "";
    }`)}catch(i){return console.warn("WHILE PARSING: ",t,"\n",i),()=>void 0}}function makeTemplate(e,t,i,n=i){if(0>i[t].indexOf("${"))return;const s=parse(i[t]);e.watch(()=>n[t]=s(e)||""),n[t]=s(e)||""}function bindObservable(e,t,i=!0){for(const n of e.attributes){const i=n.name.startsWith("x-")?document.createAttribute(n.name.slice(2)):n;makeTemplate(t,"value",n,i),i!==n&&e._el.setAttributeNode(i)}if(e.children.length)for(const n of e.childNodes)n instanceof Text?makeTemplate(t,"text",n):i&&bindObservable(n,t);else e.html.trim()&&makeTemplate(t,"html",e)}function $(e,t){if(!e)return;const i=t?t._el:document.documentElement,n="string"==typeof e?i.querySelector(e):e;if(n){if(n._view)return n._view;const e=(n.tagName||"").toLowerCase();return"svg"===e?new SVGParentView(n):"canvas"===e?new CanvasView(n):"form"===e?new FormView(n):"input"===e||"select"===e?new InputView(n):"video"===e||"audio"===e?new MediaView(n):SVG_TAGS.includes(e)?new SVGBaseView(n):new HTMLBaseView(n)}}function $$(e,t){const i=t?t._el:document.documentElement,n=e?i.querySelectorAll(e):[];return Array.from(n,e=>$(e))}function $N(e,t={},i){const n=SVG_TAGS.includes(e)?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(const[s,r]of Object.entries(t))r&&("id"===s?n.id=r:"html"===s?n.innerHTML=r:"text"===s?n.textContent=r:"path"===s?n.setAttribute("d",drawSVG(r)):n.setAttribute(s,r));const s=$(n);return i&&i.append(s),s}function replaceSvgImports(){if(polyfill){const e=Array.from(document.querySelectorAll("svg > use"));e.forEach(function(e){const t=e.getAttribute("xlink:href"),[i,n]=t.split("#");if(!i.length||!n)return;const s=e.parentNode;s.removeChild(e),i in requests||(requests[i]=fetch(i).then(e=>e.text()));const r=requests[i];r.then(e=>{const t=document.implementation.createHTMLDocument("");t.documentElement.innerHTML=e;const i=t.getElementById(n),r=i.cloneNode(!0),a=document.createDocumentFragment();for(;r.childNodes.length;)a.appendChild(r.firstChild);s.appendChild(a)})})}}function animate(e,t){function i(){a&&(!t||r<=t)&&window.requestAnimationFrame(i);const l=Date.now()-n;e(t?Math.min(1,l/t):l,l-r,o),t&&l>=t&&s.resolve(),r=l}if(0===t)return e(1,0,()=>{}),ResolvedAnimation;const n=Date.now(),s=defer$1();let r=0,a=!0;const o=()=>{a=!1,s.reject()};return i(),{cancel:o,promise:s.promise}}function easeIn(e,i=0,t=0){return"quad"===e?i**2:"cubic"===e?i**3:"quart"===e?i**4:"quint"===e?i**5:"circ"===e?1-Math.sqrt(1-i**2):"sine"===e?1-Math.cos(i*Math.PI/2):"exp"===e?0>=i?0:Math.pow(2,10*(i-1)):"back"===e?(t||(t=1.70158),i*i*((t+1)*i-t)):"elastic"===e?(t||(t=.3),-Math.pow(2,10*(i-1))*Math.sin((2*(i-1)/t-.5)*Math.PI)):"swing"===e?.5-Math.cos(i*Math.PI)/2:"spring"===e?1-Math.cos(4.5*i*Math.PI)*Math.exp(6*-i):"bounce"===e?i<1/11?1/64-7.5625*(.5/11-i)*(.5/11-i):i<3/11?1/16-7.5625*(2/11-i)*(2/11-i):i<7/11?1/4-7.5625*(5/11-i)*(5/11-i):1-7.5625*(1-i)*(1-i):i}function ease(e,i=0,t=0){if(0===i)return 0;if(1===i)return 1;const[n,s]=e.split("-");return"in"===s?easeIn(n,i,t):"out"===s?1-easeIn(n,1-i,t):.5>=i?easeIn(n,2*i,t)/2:1-easeIn(n,2*(1-i),t)/2}function transition(e,t,i=400,n=0,s="ease-in-out"){if(!isReady)return Object.keys(t).forEach(i=>{const n=t[i];e.css(i,Array.isArray(n)?n[1]:n)}),ResolvedAnimation;"bounce-in"===s&&(s=BOUNCE_IN),"bounce-out"===s&&(s=BOUNCE_OUT);let r="";Browser.isSafari&&(r=e._el.style.transition,e.css("transition","none"),Browser.redraw());const a=e._data.animation;a&&a.cancel();const o={},l={},d=defer$1(),c=window.getComputedStyle(e._el);Object.keys(t).forEach(i=>{const s=t[i],r=toCamelCase$1(i);l[r]=Array.isArray(s)?s[0]:c.getPropertyValue(i),o[r]=Array.isArray(s)?s[1]:s,n&&e.css(i,l[r])});const h=o.height;"auto"===o.height&&(o.height=total$1(e.children.map(e=>e.outerHeight))+"px");let g=!1,u;delay$1(()=>{g||(u=e._el.animate([l,o],{duration:i,easing:s,fill:"forwards"}),u.onfinish=()=>{e._el&&Object.keys(t).forEach(t=>e.css(t,"height"===t?h:o[t])),Browser.isSafari&&e.css("transition",r),d.resolve(),u.cancel()})},n);const m={cancel(){g=!0,e._el&&Object.keys(t).forEach(t=>e.css(t,e.css(t))),u&&u.cancel()},promise:d.promise};return setTimeout(()=>e._data.animation=m),m}function enter(e,t="fade",i=500,n=0){if(e.show(),!isReady)return ResolvedAnimation;if("fade"===t)return transition(e,{opacity:[0,1]},i,n);if("pop"===t){const t=e.transform.replace(/scale\([0-9.]*\)/,"").replace(CSS_MATRIX,"translate($1px,$2px)");return transition(e,{opacity:[0,1]},i,n),transition(e,{transform:[t+" scale(0.5)",t+" scale(1)"]},i,n,"bounce-in")}if("descend"===t){return transition(e,{opacity:[0,1],transform:["translateY(-50%)","none"]},i,n)}if(t.startsWith("draw")){const s=e.strokeLength;e.css({opacity:1,"stroke-dasharray":s+"px"});const r="draw-reverse"===t?2*s+"px":0,a=transition(e,{"stroke-dashoffset":[s+"px",r]},i,n,"linear");return a.promise.then(()=>e.css("stroke-dasharray","")),a}if(t.startsWith("slide")){const s={opacity:[0,1],transform:["translateY(50px)","none"]};return t.includes("down")&&(s.transform[0]="translateY(-50px)"),transition(e,s,i,n)}if(t.startsWith("reveal")){const s={opacity:[0,1],height:[0,"auto"]};return t.includes("left")&&(s.transform=["translateX(-50%)","none"]),t.includes("right")&&(s.transform=["translateX(50%)","none"]),transition(e,s,i,n)}return ResolvedAnimation}function exit(e,t="fade",i=400,n=0,s=!1){if(!e._el)return ResolvedAnimation;if(!isReady)return e.hide(),ResolvedAnimation;if("none"===e.css("display"))return ResolvedAnimation;let r;if("fade"===t)r=transition(e,{opacity:[1,0]},i,n);else if("pop"===t){const t=e.transform.replace(/scale\([0-9.]*\)/,"");transition(e,{opacity:[1,0]},i,n),r=transition(e,{transform:[t+" scale(1)",t+" scale(0.5)"]},i,n,"bounce-out")}else if("ascend"===t){r=transition(e,{opacity:[1,0],transform:["none","translateY(-50%)"]},i,n)}else if(t.startsWith("draw")){const s=e.strokeLength;e.css("stroke-dasharray",s);const a="draw-reverse"===t?2*s+"px":0;r=transition(e,{"stroke-dashoffset":[a,s+"px"]},i,n,"linear")}else if(t.startsWith("slide")){const s={opacity:0,transform:"translateY(50px)"};t.includes("up")&&(s.transform="translateY(-50px)"),r=transition(e,s,i,n)}else if(t.startsWith("reveal")){const s={opacity:0,height:0};t.includes("left")&&(s.transform="translateX(-50%)"),t.includes("right")&&(s.transform="translateX(50%)"),r=transition(e,s,i,n)}return r.promise.then(()=>s?e.remove():e.hide()),r}function getViewParams(e,t){const n=t.regex.exec(e);if(n){n.shift();const e={};for(const[s,i]of t.params.entries())e[i]=n[s];return e}return null}function getTemplate(e,t,i){return __awaiter(this,void 0,void 0,function*(){if(e.template)return"string"==typeof e.template?e.template:e.template(t);const n=yield fetch(i+(0<=i.indexOf("?")?"&xhr=1":"?xhr=1"));return n.text()})}function applyTemplate(e,t){const i=Array.from(e.childNodes);if(t.template)e.innerHTML=t.template;else if(t.templateId){const i=document.querySelector(t.templateId);if(!i)throw new Error(`Template not found: ${t.templateId}`);for(;e.firstChild;)e.removeChild(e.firstChild);const n=i.content,s=document.importNode(n,!0);e.appendChild(s)}if(i.length){const t=e.querySelector("slot:not([name])");for(const n of i){const i=n.getAttribute?n.getAttribute("slot"):null,s=i?e.querySelector(`slot[name="${i}"]`):t;s&&s.parentNode.insertBefore(n,s)}for(const t of Array.from(e.querySelectorAll("slot")))t.parentNode.removeChild(t)}}function customElementChildren(e){const t=[];for(const i of Array.from(e.children))i.tagName.startsWith("X-")?t.push(i):t.push(...customElementChildren(i));return t}function register(e,t={}){return function(i){class n extends CustomHTMLElement{constructor(){super(),this._view=new i(this)}}n.observedAttributes=t.attributes||[],customElementOptions.set(e.toUpperCase(),t),window.customElements.define(e,n)}}function nearlyEquals$1(e,i,n=PRECISION$1){return!(isNaN(e)||isNaN(i))&&Math.abs(e-i)<n}function isInteger(e,i=PRECISION$1){return nearlyEquals$1(e%1,0,i)}function isBetween$1(e,i,n,s=PRECISION$1){return i>n&&([i,n]=[n,i]),e>i+s&&e<n-s}function addThousandSeparators(e){let[t,i]=(""+e).split(".");for(;NUM_REGEX.test(t);)t=t.replace(NUM_REGEX,"$1,$2");return t+(i?"."+i:"")}function addPowerSuffix(e,t=6){if(!t)return e;const i=(""+Math.abs(Math.floor(e))).length,n=0>e?1:0;if(i<=t-n)return round(e,t-i-n-1);const s=Math.floor(Math.log10(Math.abs(e))/3);return round(e/Math.pow(10,3*s),t-(i%3||3)-n-1)+POWER_SUFFIX[s]}function numberFormat(e,t=0){return addThousandSeparators(addPowerSuffix(e,t)).replace("-","\u2013")}function parseNumber(e){return e=e.replace(/^–/,"-").trim(),!e||e.match(/[^0-9.,-]/)?NaN:SPECIAL_DECIMAL.test(e)?parseFloat(e.replace(/,/,".")):POINT_DECIMAL.test(e)?parseFloat(e.replace(/,/g,"")):COMMA_DECIMAL.test(e)?parseFloat(e.replace(/\./g,"").replace(/,/,".")):NaN}function fmt(e){let[i,n,t]=("00"+e).substr(-3).split("");return[0==+i?"":ONES[+i]+" hundred ",0==+t?TENS[+n]:TENS[+n]&&TENS[+n]+"-"||"",ONES[+n+ +t]||ONES[+t]].join("")}function cons(e,t,i){return t?[t,i&&" "+i||""," ",e].join(""):e}function toWord(e){if(0===e)return"zero";let t="",s=0;for(;e;)t=cons(t,fmt(e%1e3),MULTIPLIERS[s]),s+=1,e=0|e/1e3;return t.trim()}function round(e,t=0){let i=Math.pow(10,t);return Math.round(e*i)/i}function roundTo$1(e,t=1){return Math.round(e/t)*t}function clamp$1(e,t=-Infinity,i=1/0){return Math.min(i,Math.max(t,e))}function lerp$1(e,i,n=.5){return e+(i-e)*n}function square$1(e){return e*e}function subsets$1(e,t=0){const i=e.slice(0),n=subsetsHelper$1(i);return t?n.filter(e=>e.length===t):n}function subsetsHelper$1(e){if(1===e.length)return[[],e];const t=e.pop(),i=subsetsHelper$1(e),n=[];for(const r of i)n.push(r,[...r,t]);return n}function uid$1(e=10){return Math.random().toString(36).substr(2,e)}function isOneOf$3(e,...t){for(let i of t)if(e===i)return!0;return!1}function repeat$3(e,t){return Array(t).fill(e)}function repeat2D$2(e,t,n){const s=[];for(let r=0;r<t;++r)s.push(repeat$3(e,n));return s}function tabulate$1(e,t){const n=[];for(let s=0;s<t;++s)n.push(e(s));return n}function tabulate2D$1(e,t,n){const s=[];for(let r=0;r<t;++r){const t=[];for(let i=0;i<n;++i)t.push(e(r,i));s.push(t)}return s}function list$1(e,t,n=1){const s=[];if(void 0===t&&0<=e)for(let t=0;t<e;t+=n)s.push(t);else if(void 0===t)for(let t=0;t>e;t-=n)s.push(t);else if(e<=t)for(let r=e;r<=t;r+=n)s.push(r);else for(let r=e;r>=t;r-=n)s.push(r);return s}function total$3(e){return e.reduce((e,t)=>e+t,0)}function flatten$1(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?flatten$1(t):t),[])}function toLinkedList(e){const t=e.map(e=>({val:e,next:null})),s=t.length;for(let n=0;n<s-1;++n)t[n].next=t[n+1];return t[s-1].next=t[0],t}function rad$1(e,t=ORIGIN$1){const i=Math.atan2(e.y-t.y,e.x-t.x);return(i+TWO_PI$1)%TWO_PI$1}function liesOnSegment$1(e,t){return nearlyEquals$1(e.p1.x,e.p2.x)?isBetween$1(t.y,e.p1.y,e.p2.y):isBetween$1(t.x,e.p1.x,e.p2.x)}function liesOnRay$1(e,t){return nearlyEquals$1(e.p1.x,e.p2.x)?0<(t.y-e.p1.y)/(e.p2.y-e.p1.y):0<(t.x-e.p1.x)/(e.p2.x-e.p1.x)}function lineLineIntersection$1(e,t){const i=e.p1.x-e.p2.x,n=e.p1.y-e.p2.y,s=t.p1.x-t.p2.x,r=t.p1.y-t.p2.y,a=i*r-n*s;if(nearlyEquals$1(a,0))return[];const o=e.p1.x*e.p2.y-e.p1.y*e.p2.x,l=t.p1.x*t.p2.y-t.p1.y*t.p2.x;return[new Point$1((o*s-i*l)/a,(o*r-n*l)/a)]}function circleCircleIntersection$1(e,t){const i=Point$1.distance(e.c,t.c);if(i>e.r+t.r)return[];if(i<Math.abs(e.r-t.r))return[];if(nearlyEquals$1(i,0)&&nearlyEquals$1(e.r,t.r))return[];if(nearlyEquals$1(i,e.r+t.r))return[new Line$1(e.c,t.c).midpoint];const n=(square$1(e.r)-square$1(t.r)+square$1(i))/(2*i),s=Math.sqrt(square$1(e.r)-square$1(n)),r=(t.c.x-e.c.x)*n/i+(t.c.y-e.c.y)*s/i+e.c.x,a=(t.c.y-e.c.y)*n/i-(t.c.x-e.c.x)*s/i+e.c.y,o=(t.c.x-e.c.x)*n/i-(t.c.y-e.c.y)*s/i+e.c.x,l=(t.c.y-e.c.y)*n/i+(t.c.x-e.c.x)*s/i+e.c.y;return[new Point$1(r,a),new Point$1(o,l)]}function lineCircleIntersection$1(e,t){const i=e.p2.x-e.p1.x,n=e.p2.y-e.p1.y,s=square$1(i)+square$1(n),r=t.c.x,a=t.c.y,o=(e.p1.x-r)*(e.p2.y-a)-(e.p2.x-r)*(e.p1.y-a),l=square$1(t.r)*s-square$1(o);if(0>l)return[];const d=o*n/s,p=-o*i/s;if(nearlyEquals$1(l,0))return[t.c.shift(d,p)];const c=i*(0>n?-1:1)*Math.sqrt(l)/s,h=Math.abs(n)*Math.sqrt(l)/s;return[t.c.shift(d+c,p+h),t.c.shift(d-c,p-h)]}function isPolygonLike$1(e){return isOneOf$3(e.type,"polygon","polyline","rectangle")}function isLineLike$1(e){return isOneOf$3(e.type,"line","ray","segment")}function isCircle$1(e){return"circle"===e.type}function intersections$1(...e){if(2>e.length)return[];if(2<e.length)return flatten$1(subsets$1(e,2).map(t=>intersections$1(...t)));let[t,i]=e;if(isPolygonLike$1(i)&&([t,i]=[i,t]),isPolygonLike$1(t)){const e=isLineLike$1(i)?t.points.filter(e=>i.contains(e)):[];return[...e,...intersections$1(i,...t.edges)]}return simpleIntersection$1(t,i)}function simpleIntersection$1(e,t){let i=[];isLineLike$1(e)&&isLineLike$1(t)?i=lineLineIntersection$1(e,t):isLineLike$1(e)&&isCircle$1(t)?i=lineCircleIntersection$1(e,t):isCircle$1(e)&&isLineLike$1(t)?i=lineCircleIntersection$1(t,e):isCircle$1(e)&&isCircle$1(t)&&(i=circleCircleIntersection$1(e,t));for(const n of[e,t])"segment"===n.type&&(i=i.filter(e=>liesOnSegment$1(n,e))),"ray"===n.type&&(i=i.filter(e=>liesOnRay$1(n,e)));return i}function parseInput(e){if(e.match("^[0-9]+/[0-9]+$")){const t=e.split("/");return+t[0]/+t[1]}return parseNumber(e)}function setInputPattern(e,t){const i=isInteger(t)&&0<=t;Browser.isAndroid&&i||Browser.isIOS&&!i?e.setAttr("type","number"):Browser.isIOS&&e.setAttr("pattern","[0-9]*")}function isOneOf$4(e,...t){for(let i of t)if(e===i)return!0;return!1}function cache(e){let t=new Map;return function(...i){let n=i.join("--");return t.has(n)||t.set(n,e(...i)),t.get(n)}}function last$2(e,t=0){return e[e.length-1-t]}function unique$1(e){return e.filter((t,n)=>e.indexOf(t)===n)}function flatten$2(e){return e.reduce((e,t)=>e.concat(Array.isArray(t)?flatten$2(t):t),[])}function join(...e){return e.reduce((e,t)=>e.concat(t),[])}function words$2(e,t=/\s+/){return e?e.trim().split(t):[]}function nearlyEquals$2(e,i,n=PRECISION$2){return!(isNaN(e)||isNaN(i))&&Math.abs(e-i)<n}function uid$2(e=10){return Math.random().toString(36).substr(2,e)}function repeat$4(e,t){return Array(t).fill(e)}function repeat2D$3(e,t,n){const s=[];for(let r=0;r<t;++r)s.push(repeat$4(e,n));return s}function tabulate2D$2(e,t,n){const s=[];for(let r=0;r<t;++r){const t=[];for(let i=0;i<n;++i)t.push(e(r,i));s.push(t)}return s}function list$2(e,t,n=1){const s=[];if(void 0===t&&0<=e)for(let t=0;t<e;t+=n)s.push(t);else if(void 0===t)for(let t=0;t>e;t-=n)s.push(t);else if(e<=t)for(let r=e;r<=t;r+=n)s.push(r);else for(let r=e;r>=t;r-=n)s.push(r);return s}function total$4(e){return e.reduce((e,t)=>e+t,0)}function escape(e){return e in ESCAPES?ESCAPES[e]:e}function isSpecialFunction(e){return SPECIAL.has(e)}function needsBrackets(e,t){return!!PRECEDENCE.includes(t)&&(!!(e instanceof ExprTerm)||!!(e instanceof ExprFunction)&&!!PRECEDENCE.includes(e.fn)&&PRECEDENCE.indexOf(t)>PRECEDENCE.indexOf(e.fn))}function addMFence(e,t,i){return needsBrackets(e,t)?`<mfenced>${i}</mfenced>`:i}function addMRow(e,t){return e instanceof ExprTerm||e instanceof ExprFunction?`<mrow>${t}</mrow>`:t}function createToken(e,t){if(!e||!t)return null;if(t===TokenType.SPACE&&1<e.length)return new ExprSpace;if(t===TokenType.STR)return new ExprString(e);if(t===TokenType.NUM){if(isNaN(+e))throw ExprError.invalidExpression();return new ExprNumber(+e)}return t===TokenType.VAR?e in SPECIAL_IDENTIFIERS?new ExprIdentifier(SPECIAL_IDENTIFIERS[e]):e in SPECIAL_OPERATORS?new ExprOperator(SPECIAL_OPERATORS[e]):new ExprIdentifier(e):t===TokenType.OP?e in SPECIAL_OPERATORS?new ExprOperator(SPECIAL_OPERATORS[e]):new ExprOperator(e):void 0}function tokenize(e){const t=[];let i="",n=TokenType.UNKNOWN;for(let r of e){if("\""===r){const e=n===TokenType.STR?TokenType.UNKNOWN:TokenType.STR,s=createToken(i,n);s&&t.push(s),i="",n=e;continue}else if(n===TokenType.STR){i+=r;continue}const e=r.match(/[0-9.]/)?TokenType.NUM:IDENTIFIER_SYMBOLS.includes(r)?TokenType.VAR:OPERATOR_SYMBOLS.includes(r)?TokenType.OP:r.match(/\s/)?TokenType.SPACE:TokenType.UNKNOWN;if(!e)throw ExprError.invalidCharacter(r);if(!n||n===TokenType.NUM&&e!==TokenType.NUM||n===TokenType.VAR&&e!==TokenType.VAR&&e!==TokenType.NUM||n===TokenType.OP&&!(i+r in SPECIAL_OPERATORS)||n===TokenType.SPACE&&e!==TokenType.SPACE){const s=createToken(i,n);s&&t.push(s),i="",n=e}i+=r}const s=createToken(i,n);return s&&t.push(s),t}function makeTerm(e){return 1<e.length?new ExprTerm(e):e[0]instanceof ExprOperator?new ExprTerm(e):e[0]}function splitArray(e,t){const n=[[]];for(let s of e)t(s)?n.push([]):last$2(n).push(s);return n}function isOperator(e,t){return e instanceof ExprOperator&&words$2(t).includes(e.o)}function removeBrackets(e){return e instanceof ExprFunction&&"("===e.fn?e.args[0]:e}function findBinaryFunction(e,t,n){if(isOperator(e[0],t))throw ExprError.startOperator(e[0]);if(isOperator(last$2(e),t))throw ExprError.endOperator(last$2(e));for(let s=1;s<e.length-1;++s){if(!isOperator(e[s],t))continue;const i=e[s],r=e[s-1],a=e[s+1];if(r instanceof ExprOperator)throw ExprError.consecutiveOperators(r.o,i.o);if(a instanceof ExprOperator)throw ExprError.consecutiveOperators(i.o,a.o);const o=[removeBrackets(r),removeBrackets(a)];e.splice(s-1,3,new ExprFunction(n||i.o,o)),s-=2}}function prepareTerm(e){return findBinaryFunction(e,"^","sup"),findBinaryFunction(e,"_","sub"),findBinaryFunction(e,"/"),makeTerm(e)}function matchBrackets(e){const i=[[]];for(let n of e){const e=last$2(i).length?last$2(i)[0].o:null;if(isOperator(n,") ] }")||isOperator(n,"|")&&"|"===e){if(!isOperator(n,BRACKETS[e]))throw ExprError.conflictingBrackets(n.o);const t=i.pop(),s=last$2(i),r=isOperator(n,")")&&last$2(s)instanceof ExprIdentifier&&"\u03C0"!==last$2(s).i,a=r?s.pop().i:isOperator(n,"|")?"abs":t[0].o,o=splitArray(t.slice(1),e=>isOperator(e,","));s.push(new ExprFunction(a,o.map(prepareTerm)))}else isOperator(n,"( [ { |")?i.push([n]):last$2(i).push(n)}if(1<i.length)throw ExprError.unclosedBracket(last$2(i)[0].o);return prepareTerm(i[0])}function findAssociativeFunction(e,i,n=!1){function s(){if(o)throw ExprError.invalidExpression();a.length&&(r.push(1<a.length?new ExprFunction(i[0],a):a[0]),a=[])}const r=[];let a=[],o=!1;for(let l of e)if(isOperator(l,i)){if(o||!a.length)throw ExprError.invalidExpression();o=!0}else if(l instanceof ExprOperator)s(),r.push(l),o=!1;else{if(a.length&&!o&&(!n||l instanceof ExprNumber))throw ExprError.invalidExpression();a.push(l),o=!1}return s(),r}function collapseTerm(e){if(e=e.filter(e=>!(e instanceof ExprSpace)),!e.length)throw ExprError.invalidExpression();if(isOperator(e[0],"%!"))throw ExprError.startOperator(e[0]);for(let t=0;t<e.length;++t)isOperator(e[t],"%!")&&(e.splice(t-1,2,new ExprFunction(e[t].o,[e[t-1]])),t-=1);if(findBinaryFunction(e,"= < > \u2264 \u2265"),findBinaryFunction(e,"// \xF7","/"),e=findAssociativeFunction(e,"\xD7 * \xB7",!0),isOperator(e[0],"\u2212 \xB1")&&e.splice(0,2,new ExprFunction(e[0].o,[e[1]])),findBinaryFunction(e,"\u2212 \xB1"),isOperator(e[0],"+")&&(e=e.slice(1)),e=findAssociativeFunction(e,"+"),1<e.length)throw ExprError.invalidExpression();return e[0]}function parse$1(e,t=!1){const i=matchBrackets(tokenize(e));return t?i.collapse():i}function numEquals(e,t){try{const i=unique$1([...e.variables,...t.variables]),n=e.collapse(),s=t.collapse();for(let e=0;5>e;++e){const e={};for(let t of i)e[t]=CONSTANTS[t]||5*Math.random();const t=n.evaluate(e),r=s.evaluate(e);if(!(isNaN(t)||isNaN(r))&&!nearlyEquals$2(t,r))return!1}return!0}catch(t){return!1}}function getOrigin(e){const t=0<e.xMin?e.xMin:0>e.xMax?e.xMax:0,i=0<e.yMin?e.yMin:0>e.yMax?e.yMax:0;return new Point$1(t,i)}function defaultSteps(e,t,i){const n=(t-e)/i,s=Math.floor(Math.log10(n)),r=Math.pow(10,s),a=GRID_STEPS.find(e=>r*e<=n)*r;return t=a*Math.ceil(t/a),e=a*Math.floor(e/a),[e,t,a]}function computeAxis(e,t,i){let[n,s,r]=e,a=n?+n:i[0],o=s?+s:i[1];if(0<a&&(a=0),0>o&&(o=0),nearlyEquals$1(a,o))return[a-2,o+2,1];if(e[1]||(o+=.01*(o-a)),r)return[a,o,+r];const l=Math.floor(Math.abs(t)/GRID_SPACING);return defaultSteps(a,o,l)}function getDataBounds(e){const t=Math.min(...e.map(e=>Math.min(...e.map(e=>e.y)))),i=Math.max(...e.map(e=>Math.max(...e.map(e=>e.y))));return[t,i]}function goLeft(e){const t=e.prev;t&&isOneOf(t.tagName,"MO","MI","MN")?t.insertBefore(e):t?last(t.children).append(e):!e.parent.hasClass("math")&&(e.parent.prev?e.parent.prev.append(e):e.parent.parent.insertBefore(e))}function goRight(e){const t=e.next;return t&&isOneOf(t.tagName,"MO","MI","MN")?t.insertAfter(e):void(t?t.children[0].prepend(e):e.parent.hasClass("math")||(e.parent.next?e.parent.next.prepend(e):e.parent.parent.insertAfter(e)))}function goUp(e){let t=e.parent;for(;"MFRAC"!==t.parent.tagName||!t.prev;){if(t.hasClass("math"))return;t=t.parent}t.prev.append(e)}function goDown(e){let t=e.parent;for(;"MFRAC"!==t.parent.tagName||!t.next;){if(t.hasClass("math"))return;t=t.parent}t.next.prepend(e)}function backspace(e){const t=e.prev,i=e.parent;if(t&&isOneOf(t.tagName,"MO","MI","MN"))t.remove(),1>=i.children.length&&i.addClass("empty");else if(!t&&!i.prev&&!i.hasClass("math")){const t=i.parent;t.insertBefore(e);for(let e of t.children)for(let i of e.children)t.insertBefore(i);t.remove(),1>=e.parent.children.length&&e.parent.addClass("empty")}else goLeft(e)}function insertText(e,t){t.insertBefore(e),t.parent.removeClass("empty"),e.children.length&&e.children[0].append(t)}function type(e,t){"abcdefghijklmnopqrstuvwxyz\u03C0".includes(t)?insertText($N("mi",{text:t}),e):"0123456789.".includes(t)?insertText($N("mn",{text:t}),e):"+\u2212\xB1\xD7\xF7<>\u2264\u2265=%!".includes(t)?insertText($N("mo",{text:t,value:t}),e):"frac"===t?insertText($N("mfrac",{html:"<mrow class=\"empty\"></mrow><mrow class=\"empty\"></mrow>"}),e):"sqrt"===t?insertText($N("msqrt",{html:"<mrow class=\"empty\"></mrow>"}),e):isOneOf(t,"^","sup")?insertText($N("msup",{html:"<mrow class=\"empty\"></mrow>"}),e):"brackets"===t||"([{|".includes(t)?insertText($N("mfenced",{html:"<mrow class=\"empty\"></mrow>",type:"("}),e):")]}".includes(t)&&!e.next&&"MFENCED"===e.parent.parent.tagName&&e.parent.parent.insertAfter(e)}function cleanGroups(e,t){const i=e.$$(`${t}:first-child, *:not(${t}) + ${t}`);for(let n of i)if("MFRAC"!==n.parent.tagName)for(;n.next&&n.next.tagName===t.toUpperCase();)n.text+=n.next.text,n.next.remove()}function toString(e,t){if(e instanceof Text)return e.textContent||"";if(e.hasClass("cursor"))return"";const i=e.childNodes;return"MI"===e.tagName?e.text+(t?" ":""):"MFENCED"===e.tagName?"("+toString(i[0],t)+")":"MSUP"===e.tagName?"^("+toString(i[0],t)+")":"MFRAC"===e.tagName?`(${toString(i[0],t)})/(${toString(i[1],t)})`:"MSQRT"===e.tagName?"sqrt("+toString(i[0],t)+")":i.map(e=>toString(e,t)).join("")}function parseInput$1(e){try{return{expr:Expression.parse(e,!0)}}catch(e){return{error:e instanceof ExprError?e.message:DEFAULT_ERROR}}}function checkVariables(e,t,i){const n=e.variables;if(t.length){const e=n.find(e=>!t.includes(e));if(e){const n=autoCorrect(e,i||t);return n?`Did you mean “<em>${n}</em>” instead of “<em>${e}</em>”?`:`There shouldn’t be a variable called “<em>${e}</em>”.`}const s=t.find(e=>!n.includes(e));if(s)return`Your expression should contain “<em>${s}</em>”.`}}function checkFunctions(e,t){if(t.length){const i=e.functions.find(e=>!t.includes(e));if(i){const e=FN_NAMES[i]||"\u201C"+i+"\u201D";return`This expression should not contain ${e}.`}}}function checkNumeric(e,t,i=.001){try{return nearlyEquals$1(e.evaluate(),t.evaluate(),i)}catch(t){return!1}}function arrayEquals(e,t){return e.every((e,n)=>nearlyEquals$1(e,t[n]))}function applyTransform(e,t){e.scale*=t.scale,e.x=e.x*t.scale+t.x,e.y=e.y*t.scale+t.y}function transformEquals(e,t){return nearlyEquals$1(e.x,t.x)&&nearlyEquals$1(e.y,t.y)&&nearlyEquals$1(e.scale,t.scale)}function drawStroke(e,i,t){if("adding"===t){const t=e.strokeLength,n=.5>i?0:2*i-1;e.css({"stroke-dasharray":t+"px","stroke-dashoffset":t*(1-n)+"px"})}else if("deleting"===t){const t=e.strokeLength,n=.5>i?2*i:1;e.css({"stroke-dasharray":t+"px","stroke-dashoffset":t*(2-n)+"px"})}}function matchNodes(e,t){const i=[e];for(let n=e.expr;t.startsWith(n);){if(t===n)return i;const e=last(i).next;if(!e)return null;i.push(e),n+=e.expr}return null}function wrapInRow(e,t){return 1===t.length&&"mrow"===t[0].type?t[0]:new DisplayNodeRow(t,e)}function makeLabel(e,t,i){const n=e.hasClass("fill")||e.hasClass("move"),s=i||e.attr("label-colour");return $N("text",{target:e.attr("target")||"",class:e.attr("class")||"","data-when":e.data.when,fill:s||e.css(n?"fill":"stroke")},t.$labels)}function labelOverlap(e,t,i,n){const s=new Rectangle(new Point$1(-10,-20),20,23).rotate(i),r=t.paths.filter(t=>t.val&&t.val!==e);return n.find(e=>r.every(t=>!intersections$1(s.translate(e),t.val).length))||n[0]}function labelPosn(e,t,i){if(isOneOf(e.type,"line","ray","segment")){e=e;let n=e.perpendicularVector,s=e.angle;0<=n.y&&(n=n.scale(-1),s+=Math.PI);const r=[];for(let t of[.5,.35,.65])for(let i of[-15,5])r.push(e.at(t).add(n.scale(i)));let a=labelOverlap(e,i,s,r);return t.hasAttr("mark")&&(a=a.add(e.unitVector.scale(12))),[a,s]}if("arc"===e.type){e=e;const t=new Line$1(e.start,e.end),i=0<=t.perpendicularVector.y,n=t.angle+(i?Math.PI:0),s=e.at(.5).add(t.perpendicularVector.scale(i?14:5));return[s,n]}if("angle"===e.type){e=e;const i=(+t.attr("size")||angleSize(e,{round:t.hasAttr("round")}))+8;return[e.b.add(e.bisector.unitVector.scale(i+5)).shift(0,3)]}if("point"===e.type){e=e;const n=t.hasClass("move")?10:8,s=[e.shift(n,-n),e.shift(-n,-n),e.shift(n,10+n),e.shift(-n,10+n)];return[labelOverlap(e,i,0,s)]}return isOneOf(e.type,"polygon","polyline")?(e=e,[e.centroid.shift(0,5)]):"sector"===e.type?(e=e,[e.at(.5).subtract(e.c).scale(.6).add(e.c).shift(0,5)]):"circle"===e.type?(e=e,[e.c.shift(0,5)]):[]}function getToolTransform(e,t,i,n){return`translate(${e.x}px, ${e.y-t}px) scale(${n/100}) rotate(${i}rad)`}function openLightbox(e,t,i){isOpen=!0,$activeImg=e,$lightbox.show(),$lightboxImg.show();let n=e.bounds,r=$lightboxImg.bounds,a=n.left+n.width/2-r.left-r.width/2,o=n.top+n.height/2-r.top-r.height/2,l=Math.max(n.width/r.width,n.height/r.height);transform={x:a,y:o,s:l},$lightboxImg.css("background-image",`url(${i}), url(${t})`),$lightboxImg.css("transform",`translate(${a}px, ${o}px) scale(${l})`),Browser.redraw(),$lightboxImg.addClass("transitions"),Browser.redraw(),e.css("visibility","hidden"),$lightbox.addClass("on"),$lightboxImg.css("transform","scale(1) translate(0,0)")}function closeLightbox(){isOpen&&(isOpen=!1,$lightbox.removeClass("on"),$lightboxImg.setTransform(transform,0,transform.s),setTimeout(()=>{$activeImg.css("visibility","visible"),$lightbox.css("display","none"),$lightboxImg.css("transform","none"),$lightboxImg.removeClass("transitions")},400))}function position(e,t){let n=cumulative(e.map(e=>e.h+10));for(const[s,i]of e.entries())i!==t&&i.drag.setPosition(0,n[s-1]||0)}function check(e){return e.every((e,t)=>e.index===t)||e.every((t,n)=>t.index===e.length-n-1)}function confetti(e=2e3,t=150){$confetti||($confetti=$N("canvas",{style},$body)),$confetti.setAttr("width",Browser.width),$confetti.setAttr("height",Browser.height),$confetti.show();const i=$confetti.ctx,n=tabulate(e=>new Particle(e),t),s=animate(r=>{i.clearRect(0,0,Browser.width,Browser.height);let t=0;for(let s of n)s.draw(i),s.update(r,r<e),s.y<Browser.height&&(t+=1);t||(s.cancel(),$confetti.hide())})}function connect(e,t,i,n){let s=new Point$1(e.left-15,e.top+i-15),r=new Rectangle(s,e.width+30,e.height+30),a=r.project({x:t.left+t.width/2,y:t.top+t.height/2+n}),o=new Point$1(t.left-15,t.top+n-15),l=new Rectangle(o,t.width+30,t.height+30),d=l.project({x:e.left+e.width/2,y:e.top+e.height/2+i});return[a,d]}function distance(e,t){return Math.abs(e[0]-t[0])+Math.abs(e[1]-t[1])}function createMsgElement(e,t,i={}){const n=$N("div",{class:"msg-wrap","data-display":"flex"}),s=$N("div",{class:"msg "+t},n);return i.class&&s.addClass(i.class),i.visible||n.hide(),isOneOf(t,"hint","question")?s.html=e:"img"===t?s.css("background-image",`url(${e})`):"video"==t&&$N("iframe",{src:e,allowfullscreen:!0},s),n}function formatTime(e){const t=Math.floor(e/60),i=Math.floor(e%60);return t+":"+(10>i?"0":"")+i}function getPosition(e,t){const i=t.positionLeft-e.positionLeft+t.width/2,n=t.positionTop-e.positionTop+t.height/2;return new Point$1(i,n)}function parseAttr(e){return e?new Point$1(...e.split(",").map(e=>+e)):null}function getProgress(e){return`M${e},${e/2}a${e/2},${e/2},0,0,1,0,${e}A${e/2},${e/2},0,0,1,${e},${e/2}`}function getCheck(e){return`M ${e},0 C ${e/2},0,0,${e/2},0,${e}  s ${e/2},${e},${e},${e} `+`s ${e}-${e/2},${e}-${e}     S ${1.5*e},0,${e},0 z `+`M ${44.6*e/50},${76.1*e/50} L ${19.2*e/50},${48.8*e/50} `+`l ${4*e/50}-${4.2*e/50}     l ${19.8*e/50},${11.9*e/50} `+`l ${34.2*e/50}-${32.6*e/50} l ${3.5*e/50},${3.5*e/50} `+`L ${44.6*e/50},${76.1*e/50} z`}function tryClose(){$openModal&&$openModal.canClose&&$openModal.close()}function getOrCreateMethodChain(e,t){let i=instances.filter(i=>i.context==e&&i.methodName==t)[0];return i||(i=new MethodChain(e,t),instances.push(i)),i}function createFieldsObj(e,t,i=void 0,n=void 0,s=void 0,r=void 0){if("function"==typeof n){const a=i.get("buildHitTask");return{buildHitTask:i=>{i.set(e,null,!0),i.set(t,null,!0),n(i,s,r),a(i)}}}return assign({},e,t)}function deferUntilPluginsLoaded(e,t){const i=e.get("trackingId"),n=queueMap[i]=queueMap[i]||{},s=()=>{clearTimeout(n.timeout),n.send&&MethodChain.remove(e,"send",n.send),delete queueMap[i],n.queue.forEach(e=>e())};clearTimeout(n.timeout),n.timeout=setTimeout(s,0),n.queue=n.queue||[],n.queue.push(t),n.send||(n.send=e=>(...t)=>{s(),e(...t)},MethodChain.add(e,"send",n.send))}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function isObject(e){return"object"==typeof e&&null!==e}function now(){return+new Date}function provide(e,t){const i=window.GoogleAnalyticsObject||"ga";window[i]=window[i]||function(...e){(window[i].q=window[i].q||[]).push(e)},window.gaDevIds=window.gaDevIds||[],0>window.gaDevIds.indexOf(DEV_ID)&&window.gaDevIds.push(DEV_ID),window[i]("provide",e,t),window.gaplugins=window.gaplugins||{},window.gaplugins[capitalize(e)]=t}function initStorageListener(){window.addEventListener("storage",storageListener),isListening=!0}function removeStorageListener(){window.removeEventListener("storage",storageListener),isListening=!1}function storageListener(e){const t=instances$1[e.key];if(t){const i=assign({},t.defaults_,parse$2(e.oldValue)),n=assign({},t.defaults_,parse$2(e.newValue));t.cache_=n,t.emit("externalSet",n,i)}}function parse$2(e){let t={};if(e)try{t=JSON.parse(e)}catch(e){}return t}function trackUsage(e,t){trackVersion(e),trackPlugin(e,t)}function convertHexToBin(e){return parseInt(e||"0",16).toString(2)}function convertBinToHex(e){return parseInt(e||"0",2).toString(16)}function padZeros(e,t){if(e.length<t)for(let i=t-e.length;i;)e="0"+e,i--;return e}function flipBitOn(e,t){return e.substr(0,t)+1+e.substr(t+1)}function trackPlugin(e,t){const i=e.get("&_au");let n=padZeros(convertHexToBin(i),PLUGIN_COUNT);n=flipBitOn(n,PLUGIN_COUNT-t),e.set("&_au",convertBinToHex(n))}function trackVersion(e){e.set("&_av",VERSION)}class EventTarget{constructor(){this.events=new Map}on(t,i){for(let n of words(t))this.events.has(n)||this.events.set(n,[]),this.events.get(n).push(i)}one(t,i){this.on(t,n=>{this.off(t,i),i(n)})}off(t,i){for(let n of words(t))this.events.has(n)&&this.events.set(n,this.events.get(n).filter(e=>e!==i))}trigger(t,i){for(let n of words(t))if(this.events.has(n))for(const e of this.events.get(n))e(i)}}const shortHexRegex=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,longHexRegex=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i,rainbow=["#22ab24","#0f82f2","#cd0e66","#fd8c00"];class Color{constructor(e,t,i,n=1){this.r=e,this.g=t,this.b=i,this.a=n}get hex(){const e=[this.r,this.g,this.b].map(e=>pad2(Math.round(e).toString(16)));return"#"+e.join("")}get rgb(){const e=[this.r,this.g,this.b].map(e=>Math.round(e)).join(",");return"rgba("+e+","+this.a+")"}get hsl(){const e=this.r/255,t=this.g/255,i=this.b/255,n=Math.max(e,t,i),r=Math.min(e,t,i);let a,o;const p=(n+r)/2;if(n===r)a=o=0;else{const s=n-r;switch(o=.5<p?s/(2-n-r):s/(n+r),n){case e:a=(t-i)/s+(t<i?6:0);break;case t:a=(i-e)/s+2;break;default:a=(e-t)/s+4;}a/=6}return"hsl("+[a,o,p].join(",")+")"}toString(){return this.rgb}copy(){return new Color(this.r,this.g,this.b,this.a)}static fromHex(e){e=e.replace(shortHexRegex,function(e,t,i,n){return t+t+i+i+n+n});const t=longHexRegex.exec(e);return t?new Color(parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)):new Color(0,0,0)}static rainbow(e){return tabulate(t=>getColourAt(rainbow,t/(e-1)),e)}static mix(e,t,i=.5){return e instanceof Color||(e=Color.fromHex(e)),t instanceof Color||(t=Color.fromHex(t)),new Color(i*e.r+(1-i)*t.r,i*e.g+(1-i)*t.g,i*e.b+(1-i)*t.b,i*e.a+(1-i)*t.a)}}const defaultMerge=(e,t)=>e.concat(t);class EventTarget$1{constructor(){this.events=new Map}on(t,i){for(let n of words$1(t))this.events.has(n)||this.events.set(n,[]),this.events.get(n).push(i)}one(t,i){this.on(t,n=>{this.off(t,i),i(n)})}off(t,i){for(let n of words$1(t))this.events.has(n)&&this.events.set(n,this.events.get(n).filter(e=>e!==i))}trigger(t,i){for(let n of words$1(t))if(this.events.has(n))for(const e of this.events.get(n))e(i)}}const POST_DATA=new Map,doDeferredPost=throttle(sendPostData,5e3);window.addEventListener("online",doDeferredPost),window.onbeforeunload=sendPostData;const PRECISION=1e-6;class Point{constructor(e=0,t=0){this.x=e,this.y=t,this.type="point"}get unitVector(){return nearlyEquals(this.length,0)?new Point(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new Point(-this.x,-this.y)}get flip(){return new Point(this.y,this.x)}get perpendicular(){return new Point(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return Point.distance(this,e.project(this))}clamp(e,t,i,n){return new Point(clamp(this.x,e,t),clamp(this.y,i,n))}transform(e){const t=e[0][0]*this.x+e[0][1]*this.y+e[0][2],i=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new Point(t,i)}rotate(e,t=ORIGIN){const i=this.x-t.x,n=this.y-t.y,s=Math.cos(e),r=Math.sin(e),a=i*s-n*r+t.x,o=i*r+n*s+t.y;return new Point(a,o)}reflect(e){let t=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,n=this.x-e.p1.x,s=this.y-e.p1.y,r=(t*s-i*n)/(t*t+i*i),a=this.x+2*r*i,o=this.y-2*r*t;return new Point(a,o)}scale(e,t=e){return new Point(this.x*e,this.y*t)}shift(e,t=e){return new Point(this.x+e,this.y+t)}changeCoordinates(e,t){const i=t.xMin+(this.x-e.xMin)/e.dx*t.dx,n=t.yMin+(this.y-e.yMin)/e.dy*t.dy;return new Point(i,n)}add(e){return Point.sum(this,e)}subtract(e){return Point.difference(this,e)}equals(e){return Point.equals(this,e)}round(e=1){return new Point(roundTo(this.x,e),roundTo(this.y,e))}floor(){return new Point(Math.floor(this.x),Math.floor(this.y))}mod(e,t=e){return new Point(this.x%e,this.y%t)}angle(e=ORIGIN){return rad(this,e)}static average(...e){let t=total$2(e.map(e=>e.x))/e.length,i=total$2(e.map(e=>e.y))/e.length;return new Point(t,i)}static dot(e,t){return e.x*t.x+e.y*t.y}static sum(e,t){return new Point(e.x+t.x,e.y+t.y)}static difference(e,t){return new Point(e.x-t.x,e.y-t.y)}static distance(e,t){return Math.sqrt(square(e.x-t.x)+square(e.y-t.y))}static manhattan(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static interpolate(e,i,n=.5){return new Point(lerp(e.x,i.x,n),lerp(e.y,i.y,n))}static interpolateList(e,i=.5){const t=e.length-1,n=Math.floor(clamp(i,0,1)*t);return Point.interpolate(e[n],e[n+1],t*i-n)}static equals(e,t){return nearlyEquals(e.x,t.x)&&nearlyEquals(e.y,t.y)}static fromPolar(e,t=1){return new Point(t*Math.cos(e),t*Math.sin(e))}}const ORIGIN=new Point(0,0),TWO_PI=2*Math.PI;class Line{constructor(e,t){this.p1=e,this.p2=t,this.type="line"}make(e,t){return new Line(e,t)}get length(){return Point.distance(this.p1,this.p2)}get midpoint(){return Point.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return rad(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new Point(this.p2.y-this.p1.y,this.p1.x-this.p2.x).perpendicular}parallel(e){const t=Point.sum(e,Point.difference(this.p2,this.p1));return new Line(e,t)}perpendicular(e){return new Line(e,Point.sum(e,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}project(e){const t=Point.difference(this.p2,this.p1),i=Point.difference(e,this.p1),n=t.scale(Point.dot(t,i)/this.length**2);return Point.sum(this.p1,n)}contains(e){const t=e.x*(this.p1.y-this.p2.y)+this.p1.x*(this.p2.y-e.y)+this.p2.x*(e.y-this.p1.y);return nearlyEquals(t,0)}at(e){return Point.interpolate(this.p1,this.p2,e)}transform(e){return new this.constructor(this.p1.transform(e),this.p2.transform(e))}rotate(e,t=ORIGIN){return new this.constructor(this.p1.rotate(e,t),this.p2.rotate(e,t))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,t=e){return this.make(this.p1.scale(e,t),this.p2.scale(e,t))}shift(e,t=e){return this.make(this.p1.shift(e,t),this.p2.shift(e,t))}translate(e){return this.shift(e.x,e.y)}equals(e){return Line.equals(this,e)}static equals(e,t){return e.contains(t.p1)&&e.contains(t.p2)}}var Matrix;(function(e){function t(e,t,i){return repeat2D$1(e,t,i)}function i(e=2){const n=t(0,e,e);for(let t=0;t<e;++t)n[t][t]=1;return n}function n(...e){const[t,...i]=e,s=1<i.length?n(...i):i[0];if(t.length!==s.length||t[0].length!==s[0].length)throw new Error("Matrix sizes don\u2019t match");const r=[];for(let n=0;n<t.length;++n){const e=[];for(let i=0;i<t[n].length;++i)e.push(t[n][i]+s[n][i]);r.push(e)}return r}function s(...e){let[t,...i]=e,n=1<i.length?s(...i):i[0];if(t[0].length!==n.length)throw new Error("Matrix sizes don\u2019t match.");let r=[];for(let s=0,i;s<t.length;++s){i=[];for(let e=0,r;e<n[0].length;++e){r=0;for(let i=0;i<n.length;++i)r+=t[s][i]*n[i][e];i.push(r)}r.push(i)}return r}e.fill=t,e.identity=i,e.rotation=function(e){const t=Math.sin(e),i=Math.cos(e);return[[i,-t],[t,i]]},e.shear=function(e){return[[1,e],[0,1]]},e.reflection=function(e){const t=Math.sin(2*e),i=Math.cos(2*e);return[[i,t],[t,-i]]},e.sum=n,e.scalarProduct=function(e,t){return e.map(e=>e.map(e=>e*t))},e.product=s,e.transpose=function(e){let t=[];for(let n=0,s;n<e[0].length;++n){s=[];for(let t=0;t<e.length;++t)s.push(e[t][n]);t.push(s)}return t},e.determinant=function(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let i=0;for(let n=0;n<t;++n){let s=e[0][n],r=e[0][n];for(let a=1;a<t;++a)r*=e[a][n+a%t],s*=e[a][n-a%t];i+=r-s}return i},e.inverse=function(e){let t=e.length;if(t!==e[0].length)throw new Error("Not a square matrix.");let n=i(t),s=tabulate2D((t,i)=>e[t][i],t,t);for(let r=0,i;r<t;++r){if(i=s[r][r],!i){for(let e=r+1;e<t;++e)if(0!==s[e][r]){for(let i=0;i<t;++i)[s[e][i],s[r][i]]=[s[r][i],s[e][i]],[n[e][i],n[r][i]]=[n[r][i],n[e][i]];break}if(i=s[r][r],!i)throw new Error("Matrix not invertible.")}for(let e=0;e<t;++e)s[r][e]/=i,n[r][e]/=i;for(let e=0;e<t;++e){if(e===r)continue;let i=s[e][r];for(let a=0;a<t;++a)s[e][a]-=i*s[r][a],n[e][a]-=i*n[r][a]}}return n}})(Matrix||(Matrix={}));var Random;(function(e){function t(e){e=e.slice(0);for(let t=e.length-1,i;0<t;--t)i=Math.floor(Math.random()*(t+1)),[e[t],e[i]]=[e[i],e[t]];return e}function i(e){const t=Math.random()*total$2(e);let i=0;return e.findIndex(e=>(i+=e)>=t)}function s(e=.5){return Math.random()<e?1:0}function r(e){if(.5>e)return Math.PI/(Math.sin(Math.PI*e)*r(1-e));e-=1;let s=n[0];for(let t=1;9>t;t++)s+=n[t]/(e+t);let i=e+l+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*s}function a(e,t,i,n=1){let s=0;for(let r=t;r<i;r+=n)s+=e(r)*n||0;return s}e.shuffle=t,e.integer=function(e,t){let i=void 0===t?0:e,n=void 0===t?e:t-e+1;return i+Math.floor(n*Math.random())},e.intArray=function(e){let n=[];for(let t=0;t<e;++t)n.push(t);return t(n)},e.weighted=i;const o=new Map;e.smart=function(e,t){t||(t=uid()),o.has(t)||o.set(t,repeat$2(1,e));const n=o.get(t),s=i(n.map(e=>e*e));return n[s]-=1,0>=n[s]&&o.set(t,n.map(e=>e+1)),s},e.bernoulli=s,e.binomial=function(e=1,n=.5){let r=0;for(let t=0;t<e;++t)r+=s(n);return r},e.poisson=function(e=1){if(0>=e)return 0;const t=Math.exp(-e);let i=1,n=0;for(;i>t;++n)i*=Math.random();return n-1},e.uniform=function(e=0,t=1){return e+(t-e)*Math.random()},e.normal=function(e=0,t=1){const i=Math.random(),n=Math.random(),s=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*n);return s*Math.sqrt(t)+e},e.exponential=function(e=1){return 0>=e?0:-Math.log(Math.random())/e},e.geometric=function(e=.5){return 0>=e||1<e?null:Math.floor(Math.log(Math.random())/Math.log(1-e))},e.cauchy=function(){let e,t,i;do t=2*Math.random()-1,i=2*Math.random()-1,e=t*t+i*i;while(1<=e);return t/i},e.normalPDF=function(e,t=1,i=0){return Math.exp(-((e-t)**2)/(2*i))/Math.sqrt(2*Math.PI*i)};const l=7,n=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];e.integrate=a,e.chiCDF=function(e,i){let n=a(e=>Math.pow(e,(i-2)/2)*Math.exp(-e/2),0,e);return 1-n/Math.pow(2,i/2)/r(i/2)}})(Random||(Random={}));var Regression;(function(e){function t(e,t=!1){let i=0,s=0,r=0,a=0;const o=e.length;for(let l=0;l<o;l++)i+=e[l][0],s+=e[l][1],r+=e[l][0]*e[l][0],a+=e[l][0]*e[l][1];if(t){const e=a/r;return[0,e]}const l=(o*a-i*s)/(o*r-i*i),d=s/o-l*i/o;return[d,l]}function i(e){const t=[0,0,0,0,0,0];for(const i of e)t[0]+=i[0],t[1]+=i[1],t[2]+=i[0]*i[0]*i[1],t[3]+=i[1]*Math.log(i[1]),t[4]+=i[0]*i[1]*Math.log(i[1]),t[5]+=i[0]*i[1];const i=t[1]*t[2]-t[5]*t[5],n=Math.exp((t[2]*t[3]-t[5]*t[4])/i),s=(t[1]*t[4]-t[5]*t[3])/i;return[n,s]}function n(e,t=2){let i=e.map(e=>list(t+1).map(t=>Math.pow(e[0],t))),n=Matrix.transpose(i),s=e.map(e=>[e[1]]),a=Matrix.product(n,i),o=Matrix.inverse(a),l=Matrix.product(o,n,s);return l.map(e=>e[0])}function s(e,t){let i=e.reduce((e,t)=>e+t[1],0),n=i/e.length,s=e.reduce((e,t)=>e+(t[1]-n)**2,0),r=e.reduce((e,i)=>e+(i[1]-t(i[0]))**2,0);return 1-r/s}e.linear=t,e.exponential=i,e.logarithmic=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=i[1]*Math.log(i[0]),t[2]+=i[1],t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=(t[2]-n*t[0])/i;return[s,n]},e.power=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=Math.log(i[1])*Math.log(i[0]),t[2]+=Math.log(i[1]),t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=Math.exp((t[2]-n*t[0])/i);return[s,n]},e.polynomial=n,e.coefficient=s;const r=[{name:"linear",regression:t,fn:(e,t)=>e[0]+t*e[1]},{name:"quadratic",regression:n,fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]},{name:"cubic",regression:e=>n(e,3),fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]+t*t*t*e[3]},{name:"exponential",regression:i,fn:(e,t)=>e[0]*Math.pow(Math.E,e[1]*t)}];e.find=function(e,i=.9){if(1<e.length)for(const n of r){const t=n.regression(e),r=n.fn.bind(null,t),a=s(e,r);if(a>i)return{type:n.name,fn:r,params:t,coeff:a}}return{type:null,fn:()=>{},params:[],coeff:null}}})(Regression||(Regression={}));const touchSupport="ontouchstart"in window,pointerSupport="onpointerdown"in window;let observer;const aliases={change:"propertychange keyup input paste",scrollwheel:"DOMMouseScroll mousewheel",pointerdown:pointerSupport?"pointerdown":touchSupport?"touchstart":"mousedown",pointermove:pointerSupport?"pointermove":touchSupport?"touchmove":"mousemove",pointerup:pointerSupport?"pointerup":touchSupport?"touchend":"mouseup",pointercancel:pointerSupport?"pointercancel":"touchcancel",pointerstop:pointerSupport?"pointerup pointercancel":touchSupport?"touchend touchcancel":"mouseup"},customEvents={scroll:makeScrollEvents,tap:makeTapEvent,clickOutside:makeClickOutsideEvent,key:makeKeyEvent,mousedown:makeMouseEvent.bind(null,"mousedown"),mousemove:makeMouseEvent.bind(null,"mousemove"),mouseup:makeMouseEvent.bind(null,"mouseup"),pointerenter:makePointerPositionEvents,pointerleave:makePointerPositionEvents,enterViewport:makeIntersectionEvents,exitViewport:makeIntersectionEvents};var LineMark;(function(e){e[e.BAR=0]="BAR",e[e.BAR2=1]="BAR2",e[e.ARROW=2]="ARROW",e[e.ARROW2=3]="ARROW2"})(LineMark||(LineMark={}));var LineArrow;(function(e){e[e.START=0]="START",e[e.END=1]="END",e[e.BOTH=2]="BOTH"})(LineArrow||(LineArrow={}));const ALPHABETH="zyxwvutsrqponmlkjihgfedcba";class BaseView{constructor(e){this._el=e,this._data={},this._events={},this.model=null,e._view=this}get id(){return this._el.id}get data(){return this._el.dataset}get tagName(){return this._el.tagName.toUpperCase()}equals(e){return this._el===e._el}getModel(){const e=this.parent;return e?e.model||e.getModel():observable()}bindObservable(e,t=!0){return bindObservable(this,e,t),this.model=e,e}addClass(e){for(const t of words$1(e))this._el.classList.add(t)}removeClass(e){for(const t of words$1(e))this._el.classList.remove(t)}hasClass(e){return this._el.classList.contains(e)}toggleClass(e){return this._el.classList.toggle(e)}setClass(e,t){t?this.addClass(e):this.removeClass(e)}attr(e){return this._el.getAttribute(e)||""}hasAttr(e){return this._el.hasAttribute(e)}setAttr(e,t){this._el.setAttribute(e,t.toString())}removeAttr(e){this._el.removeAttribute(e)}get attributes(){return Array.from(this._el.attributes||[])}get html(){return this._el.innerHTML||""}set html(e){this._el.innerHTML=e}get text(){return this._el.textContent||""}set text(e){this._el.textContent=e}blur(){this._el.blur()}focus(){this._el.focus()}get bounds(){return this._el.getBoundingClientRect()}get isInViewport(){if(0===this.height)return!1;const e=this.bounds;return isBetween(e.top,-e.height,Browser.height)}get topLeftPosition(){const e=this.bounds;return new Point(e.left,e.top)}get boxCenter(){const e=this.bounds;return new Point(e.left+e.width/2,e.top+e.height/2)}get scrollWidth(){return this._el.scrollWidth}get scrollHeight(){return this._el.scrollHeight}get scrollTop(){return this._el.scrollTop}get scrollLeft(){return this._el.scrollLeft}set scrollTop(e){this._el.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}set scrollLeft(e){this._el.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}scrollTo(e,t=1e3,i="cubic"){0>e&&(e=0);const n=this.scrollTop,s=e-n;this._data.scrollAnimation&&this._data.scrollAnimation.cancel(),this._data.scrollAnimation=animate(e=>{const t=n+s*ease(i,e);this.scrollTop=t,this.trigger("scroll",{top:t})},t)}scrollBy(e,t=1e3,i="cubic"){e&&this.scrollTo(this.scrollTop+e,t,i)}css(e,t){if(void 0!==t)"string"==typeof e&&this._el.style.setProperty(e,""+t);else if("string"==typeof e)return window.getComputedStyle(this._el).getPropertyValue(e);else{const t=Object.keys(e);for(const i of t)this._el.style.setProperty(i,""+e[i])}}get transform(){return this.css("transform").replace("none","")}get transformMatrix(){const e=this.transform;if(!e)return[[1,0,0],[0,1,0]];const t=e.match(/matrix\(([0-9,.\s\-]*)\)/);if(!t||!t[1])return[[1,0,0],[0,1,0]];const i=t[1].split(",");return[[+i[0],+i[2],+i[4]],[+i[1],+i[3],+i[5]]]}get scale(){const e=this.transformMatrix;return[e[0][0],e[1][1]]}setTransform(e,i=0,n=1){let s="";e&&(s+=`translate(${roundTo(e.x,.1)}px,${roundTo(e.y,.1)}px)`),i&&(s+=` rotate(${i}rad)`),n&&(s+=` scale(${n})`),this._el.style.transform=s}translate(e,t){this.setTransform(new Point(e,t))}show(){this.hasAttr("hidden")&&this.removeAttr("hidden"),"visibility"===this.data.display?this._el.style.visibility="visible":this._el.style.display=this.data.display||"block"}hide(){"visibility"===this.data.display?this._el.style.visibility="hidden":this._el.style.display="none"}toggle(e){e?this.show():this.hide()}is(e){return this._el.matches?this._el.matches(e):Array.from(document.querySelectorAll(e)).includes(this._el)}index(){let e=0,t=this._el;for(;null!==(t=t.previousSibling);)++e;return e}prepend(e){const t=this._el.childNodes;t.length?this._el.insertBefore(e._el,t[0]):this._el.appendChild(e._el)}append(e){this._el.appendChild(e._el)}insertBefore(e){this.parent._el.insertBefore(e._el,this._el)}insertAfter(e){const t=this._el.nextSibling;t?this.parent._el.insertBefore(e._el,t):this.parent._el.appendChild(e._el)}get next(){return $(this._el.nextSibling)}get prev(){return $(this._el.previousSibling)}$(e){return $(e,this)}$$(e){return $$(e,this)}get parent(){return $(this._el.parentElement)}parents(e){const t=[];for(let i=this.parent;i;)(!e||i.is(e))&&t.push(i),i=i.parent;return t}hasParent(...e){const t=e.map(e=>e._el);for(let i=this._el.parentNode;i;){if(isOneOf$1(i,...t))return!0;i=i.parentNode}return!1}get children(){return Array.from(this._el.children||[],e=>$(e))}get childNodes(){return Array.from(this._el.childNodes,e=>e instanceof Text?e:$(e))}remove(){this._el&&this._el.parentNode&&this._el.parentNode.removeChild(this._el)}removeChildren(){for(;this._el.firstChild;)this._el.removeChild(this._el.firstChild)}on(t,i,n){for(const s of words$1(t))s in this._events?!this._events[s].includes(i)&&this._events[s].push(i):this._events[s]=[i],bindEvent(this,s,i,n)}one(t,i,n){const s=n=>{this.off(t,s),i(n)};this.on(t,s,n)}off(t,i){for(const n of words$1(t))n in this._events&&(this._events[n]=this._events[n].filter(e=>e!==i)),unbindEvent(this,n,i)}trigger(t,i={}){for(const n of words$1(t)){if(!this._events[n])return;for(const e of this._events[n])e.call(this,i)}}onKeyDown(e,t){const i=words$1(e).map(e=>KEY_CODES[e]||e);this._el.addEventListener("keydown",n=>{0<=i.indexOf(n.keyCode)&&t(n)})}animate(e,t=400,i=0,n="ease-in-out"){return transition(this,e,t,i,n)}enter(e="fade",t=500,i=0){return enter(this,e,t,i)}exit(e="fade",t=500,i=0,n=!1){return exit(this,e,t,i,n)}effect(e){this.one("animationend",()=>this.removeClass("effects-"+e)),this.addClass("effects-"+e)}copy(e=!0,t=!0){const i=$(this._el.cloneNode(e));return t&&i.copyInlineStyles(this,e),i}copyInlineStyles(e,t=!0){const i=window.getComputedStyle(e._el);for(const n of Array.from(i))this.css(n,i.getPropertyValue(n));if(t){const t=this.children,n=e.children;for(let e=0;e<t.length;++e)t[e].copyInlineStyles(n[e],!0)}}}class HTMLBaseView extends BaseView{get offsetTop(){return this._el.offsetTop}get offsetLeft(){return this._el.offsetLeft}get offsetParent(){return $(this._el.offsetParent)}get width(){return this._el.offsetWidth}get height(){return this._el.offsetHeight}get innerWidth(){const e=parseFloat(this.css("padding-left")),t=parseFloat(this.css("padding-right"));return this._el.clientWidth-e-t}get innerHeight(){const e=parseFloat(this.css("padding-bottom")),t=parseFloat(this.css("padding-top"));return this._el.clientHeight-e-t}get outerWidth(){const e=parseFloat(this.css("margin-left")),t=parseFloat(this.css("margin-right"));return this.width+e+t}get outerHeight(){const e=parseFloat(this.css("margin-bottom")),t=parseFloat(this.css("margin-top"));return this.height+e+t}get positionTop(){let e=this._el,t=0;for(;e;)t+=e.offsetTop,e=e.offsetParent;return t}get positionLeft(){let e=this._el,t=0;for(;e;)t+=e.offsetLeft,e=e.offsetParent;return t}offset(e){if(e._el===this._el.offsetParent){const t=this.offsetTop+e._el.clientTop,i=this.offsetLeft+e._el.clientLeft,n=t+this.height,s=i+this.width;return{top:t,left:i,bottom:n,right:s}}else{const t=e._el.getBoundingClientRect(),i=this._el.getBoundingClientRect();return{top:i.top-t.top,left:i.left-t.left,bottom:i.bottom-t.top,right:i.right-t.left}}}}class SVGBaseView extends BaseView{get $ownerSVG(){return $(this._el.ownerSVGElement)}get width(){return this.bounds.width}get height(){return this.bounds.height}get positionLeft(){if(this.$ownerSVG){const e=this._el.getBBox().x+this._el.getCTM().e;return this.$ownerSVG.positionLeft+e}return parseInt(this.css("margin-left"))+this.parent.positionLeft}get positionTop(){if(this.$ownerSVG){const e=this._el.getBBox().y+this._el.getCTM().f;return this.$ownerSVG.positionTop+e}return parseInt(this.css("margin-top"))+this.parent.positionTop}get inverseTransformMatrix(){const e=this._el.getScreenCTM().inverse(),t=[[e.a,e.c,e.e],[e.b,e.d,e.f]];if(Browser.isFirefox){const e=this.transformMatrix;t[0][2]-=e[0][2],t[1][2]-=e[1][2]}return t}setTransform(e,t=0,i=1){const n=e?`translate(${roundTo(e.x,.1)} ${roundTo(e.y,.1)})`:"",s=t?`rotate(${180*t/Math.PI})`:"",r=i?`scale(${i})`:"";this.setAttr("transform",[n,s,r].join(" "))}get strokeLength(){if(this._el instanceof SVGGeometryElement)return this._el.getTotalLength();else{const e=this.bounds;return 2*e.height+2*e.width}}getPointAt(e){if(this._el instanceof SVGGeometryElement){const t=this._el.getPointAtLength(e*this.strokeLength);return new Point(t.x,t.y)}return new Point(0,0)}get points(){const e=this.attr("d");return e?e.replace(/[MZ]/g,"").split(/[LA]/).map(e=>{const t=e.split(",");return new Point(+last$1(t,1),+last$1(t))}):[]}set points(e){const t=e.length?"M"+e.map(e=>e.x+","+e.y).join("L"):"";this.setAttr("d",t)}addPoint(e){const t=this.attr("d")+" L "+e.x+","+e.y;this.setAttr("d",t)}get center(){const e=+this.attr("TEXT"===this.tagName?"x":"cx"),t=+this.attr("TEXT"===this.tagName?"y":"cy");return new Point(e,t)}setCenter(e){this.setAttr("TEXT"===this.tagName?"x":"cx",e.x),this.setAttr("TEXT"===this.tagName?"y":"cy",e.y)}setLine(e,t){this.setAttr("x1",e.x),this.setAttr("y1",e.y),this.setAttr("x2",t.x),this.setAttr("y2",t.y)}setRect(e){this.setAttr("x",e.p.x),this.setAttr("y",e.p.y),this.setAttr("width",e.w),this.setAttr("height",e.h)}draw(e,t={}){const i={mark:this.attr("mark"),arrows:this.attr("arrows"),size:+this.attr("size")||null,fill:this.hasClass("fill"),round:this.hasAttr("round")};this.setAttr("d",drawSVG(e,applyDefaults(t,i)))}}class SVGParentView extends SVGBaseView{get viewBox(){return this._el.viewBox.baseVal||{width:0,height:0}}get $ownerSVG(){return this}get svgWidth(){return this.viewBox.width||this.width}get svgHeight(){return this.viewBox.height||this.height}pngImage(e){return __awaiter(this,void 0,void 0,function*(){const t=this.copy(!0,!0),i=e||this.svgWidth,n=e||this.svgHeight;t.setAttr("width",i),t.setAttr("height",n);const s=new XMLSerializer().serializeToString(t._el);let r="data:image/svg+xml;utf8,"+encodeURIComponent(s);r=r.replace("svg ","svg xmlns=\"http://www.w3.org/2000/svg\" ");const a=$N("canvas",{width:i,height:n});a.ctx.fillStyle="#fff",a.ctx.fillRect(0,0,i,n);const o=yield loadImage(r);return a.ctx.drawImage(o,0,0,i,n),a.pngImage})}}class WindowView extends HTMLBaseView{get width(){return window.innerWidth}get height(){return window.innerHeight}get innerWidth(){return window.innerWidth}get innerHeight(){return window.innerHeight}get outerWidth(){return window.outerWidth}get outerHeight(){return window.outerHeight}get scrollWidth(){return document.body.scrollWidth}get scrollHeight(){return document.body.scrollHeight}get scrollTop(){return window.pageYOffset}get scrollLeft(){return window.pageXOffset}set scrollTop(e){document.body.scrollTop=document.documentElement.scrollTop=e,this.trigger("scroll",{top:e,left:this.scrollLeft})}set scrollLeft(e){document.body.scrollLeft=document.documentElement.scrollLeft=e,this.trigger("scroll",{top:this.scrollTop,left:e})}}class FormView extends HTMLBaseView{get action(){return this._el.action}get formData(){const e={};for(const t of Array.from(this._el.elements)){const i=t.name||t.id;i&&(e[i]=t.value)}return e}get isValid(){return this._el.checkValidity()}}class InputView extends HTMLBaseView{get checked(){return!!(this._el instanceof HTMLInputElement)&&this._el.checked}get value(){return this._el.value}set value(e){this._el.value=e}change(e){let t="";this.on("change",()=>{this.value===t||(t=this.value.trim(),e(t))})}validate(e){this.change(t=>this.setValidity(e(t)))}setValidity(e){this._el.setCustomValidity(e)}get isValid(){return this._el.checkValidity()}}class CanvasView extends HTMLBaseView{constructor(){super(...arguments),this._ctx=null}getContext(e="2d",t={}){return this._el.getContext(e,t)}get pngImage(){return this._el.toDataURL("image/png")}get canvasWidth(){return this._el.width}get canvasHeight(){return this._el.height}get ctx(){return this._ctx||(this._ctx=this.getContext()),this._ctx}draw(e,t={}){this.ctx.save(),drawCanvas(this.ctx,e,t),this.ctx.restore()}clear(){this.ctx.clearRect(0,0,this.canvasWidth,this.canvasHeight)}}class MediaView extends HTMLBaseView{play(){return this._el.play()||Promise.resolve()}pause(){return this._el.pause()}}const SVG_TAGS=["path","rect","circle","ellipse","polygon","polyline","g","defs","marker","line","text","pattern","mask","svg"],$body=new WindowView(document.body),$html=new WindowView(document.documentElement),KEY_CODES={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46};var Browser;(function(e){function t(){if(!p){p=!0;for(const e of d)e();setTimeout(n)}}function i(e){p?e():d.push(e)}function n(){h()}function s(e,t,i=31536000){document.cookie=`${e}=${t};path=/;max-age=${i}`}function r(e,t){const n=(e||"").split("."),s=safeToJSON(window.localStorage.getItem(g));let r=s;for(let s=0;s<n.length-1;++s)null==r[n[s]]&&(r[n[s]]={}),r=r[n[s]];r[n[n.length-1]]=t,window.localStorage.setItem(g,JSON.stringify(s))}function a(e){let t=safeToJSON(window.localStorage.getItem(g));if(!e)return t;const i=(e||"").split("."),n=i.pop();for(const n of i){if(!(n in t))return null;t=t[n]}return t[n]}function o(){const e=document.activeElement;return e===document.body?void 0:$(e)}const l=window.navigator.userAgent.toLowerCase();e.isMobile=/android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(l),e.isRetina=1<(window.devicePixelRatio||1),e.isTouch=window.Touch||"ontouchstart"in window,e.isChrome=!!window.chrome,e.isFirefox=0<=l.indexOf("firefox"),e.isAndroid=0<=l.indexOf("android"),e.isIOS=/iphone|ipad|ipod/i.test(l),e.isSafari=/^((?!chrome|android).)*safari/i.test(l),e.redraw=function(){document.body.offsetHeight};const d=[];let p=!1;window.onload=t,document.addEventListener("DOMContentLoaded",t),e.ready=i;const c=[];e.width=window.innerWidth,e.height=window.innerHeight;const h=throttle(()=>{e.width=window.innerWidth,e.height=window.innerHeight;for(const t of c)t({width:e.width,height:e.height});$body.trigger("scroll",{top:$body.scrollTop})});e.onResize=function(t){t({width:e.width,height:e.height}),c.push(t)},e.offResize=function(e){const t=c.indexOf(e);0<=t&&c.splice(t,1)},e.resize=n,window.addEventListener("resize",()=>{const t=window.innerWidth,i=window.innerHeight;e.width===t&&e.height===i||(e.width=t,e.height=i,h())}),e.getHash=function(){return window.location.hash.slice(1)},e.setHash=function(e){const t=document.body.scrollTop;window.location.hash=e,document.body.scrollTop=t},e.getCookies=function(){const e=document.cookie.split(";"),t={};for(let s=0,i=e.length;s<i;++s){const i=e[s].split("=");i[0]=i[0].replace(/^\s+|\s+$/,""),t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t},e.getCookie=function(e){const t=document.cookie.match(new RegExp(`(^|;) ?${e}=([^;]*)(;|$)`));return t?t[2]:null},e.setCookie=s,e.deleteCookie=function(e){s(e,"",-1)};const g="_M";e.setStorage=r,e.getStorage=a,e.deleteStorage=function(e){e?r(e,null):window.localStorage.setItem(g,"")},e.getActiveInput=o,e.onKey=function(e,t,i=!1){const n=words$1(e),s=n.map(e=>KEY_CODES[e]||e),r=i?"keyup":"keydown";document.addEventListener(r,function(r){const e=o();if(!(e&&e.is("input, textarea, [contenteditable]"))){const e=s.indexOf(r.keyCode);0<=e&&t(r,n[e])}})}})(Browser||(Browser={}));const IEUA=/\bTrident\/[567]\b|\bMSIE (?:9|10)\.0\b/,webkitUA=/\bAppleWebKit\/(\d+)\b/,EdgeUA=/\bEdge\/12\.(\d+)\b/,polyfill=IEUA.test(navigator.userAgent)||10547>+(navigator.userAgent.match(EdgeUA)||[])[1]||537>+(navigator.userAgent.match(webkitUA)||[])[1],requests={};let isReady=!1;setTimeout(()=>isReady=!0);const BOUNCE_IN="cubic-bezier(0.175, 0.885, 0.32, 1.275)",BOUNCE_OUT="cubic-bezier(0.68, -0.275, 0.825, 0.115)",ResolvedAnimation={cancel:()=>{},promise:Promise.resolve()},CSS_MATRIX=/matrix\([0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,[0-9.\-\s]+,([0-9.\-\s]+),([0-9.\-\s]+)\)/;class Draggable extends EventTarget$1{constructor(e,t,i={}){super(),this.$el=e,this.position=new Point(0,0),this.disabled=!1,this.width=0,this.height=0,this.options=applyDefaults(i,{moveX:!0,moveY:!0}),this.setDimensions(t);let n=null;slide(e,{start:()=>{this.disabled||(n=this.position,this.trigger("start"))},move:(e,t)=>{this.disabled||(this.setPosition(n.x+e.x-t.x,n.y+e.y-t.y),this.trigger("drag",this.position))},end:(e,t)=>{this.disabled||this.trigger(e.equals(t)?"click":"end")}}),Browser.onResize(()=>{const e=this.width,i=this.height;this.setDimensions(t),this.setPosition(this.position.x*this.width/e||0,this.position.y*this.height/i||0)})}setDimensions(e){e instanceof SVGParentView?(this.width=this.options.width||e.svgWidth,this.height=this.options.height||e.svgHeight):(this.width=this.options.width||e.width,this.height=this.options.height||e.height)}setPosition(e,t){const i=this.options.margin||0;let n=new Point(this.options.moveX?e:0,this.options.moveY?t:0).clamp(i,this.width-i,i,this.height-i).round(this.options.snap||1);this.options.round&&(n=this.options.round(n)),n.equals(this.position)||(this.position=n,this.options.useTransform?this.$el.translate(n.x,n.y):(this.options.moveX&&this.$el.css("left",n.x+"px"),this.options.moveY&&this.$el.css("top",n.y+"px")),this.trigger("move",n))}}let isReady$1="complete"===document.readyState;window.addEventListener("load",()=>setTimeout(()=>isReady$1=!0)),"scrollRestoration"in window.history&&(window.history.scrollRestoration="manual");class Router extends EventTarget$1{constructor(){super(...arguments),this.$viewport=$body,this.views=[],this.active={path:"",hash:"",index:0},this.search=window.location.search,this.preloaded=!1,this.transition=!1,this.noLoad=!1,this.initialise=()=>{}}setup(e={}){e.$viewport&&(this.$viewport=e.$viewport),e.initialise&&(e.initialise=this.initialise),e.preloaded&&(this.preloaded=e.preloaded),e.transition&&(this.transition=e.transition),e.noLoad&&(this.noLoad=e.noLoad),e.click&&$body.on("click",t=>this.onLinkClick(t)),e.history&&window.addEventListener("popstate",t=>{isReady$1&&t.state&&this.goToState(t.state)})}view(e,{enter:t,exit:i,template:n}={}){const s=(e.match(/:\w+/g)||[]).map(e=>e.substr(1)),r=e.replace(/:\w+/g,"([\\w-]+)").replace("/","\\/")+"\\/?",a=e.includes("?")?"":"(\\?.*)?",o=new RegExp("^"+r+a+"$","i"),l={regex:o,params:s,enter:t,exit:i,template:n};this.views.push(l);const d=getViewParams(window.location.pathname,l);d&&(this.active={path:window.location.pathname+this.search,hash:window.location.hash,index:0},window.history.replaceState(this.active,"",this.active.path+this.active.hash),Browser.ready(()=>{setTimeout(()=>{this.preloaded?(this.initialise(this.$viewport,d),l.enter&&l.enter(this.$viewport,d)):this.loadView(l,d,window.location.pathname)})}))}paths(...e){for(const t of e)this.view(t)}getView(e){for(const t of this.views){const i=getViewParams(e,t);if(i)return{view:t,params:i}}}load(e,t=""){const i=this.getView(e);return e===this.active.path&&t!==this.active.hash?(console.info("[boost] Routing to "+e+t),this.trigger("hashChange",t.slice(1)),this.trigger("change",e+t),!0):!!(i&&e!==this.active.path)&&(console.info("[boost] Routing to "+e+t),this.trigger("change",e+t),window.ga&&window.ga("send","pageview",e+t),this.noLoad?i.view.enter&&i.view.enter(this.$viewport,i.params):this.loadView(i.view,i.params,e),!0)}loadView(e,t={},i=""){return __awaiter(this,void 0,void 0,function*(){this.$viewport.css({opacity:.4,"pointer-events":"none"});const n=yield getTemplate(e,t,i);this.$viewport.css("opacity",0),setTimeout(()=>{this.$viewport.removeChildren(),$body.scrollTop=0,this.$viewport.html=n,Browser.resize(),replaceSvgImports(),this.$viewport.css({opacity:1,"pointer-events":"all"});const i=this.$viewport.$("title");i&&(document.title=i.text),this.initialise(this.$viewport,t),e.enter&&e.enter(this.$viewport,t),this.trigger("afterChange",{$viewport:this.$viewport})},350)})}onLinkClick(t){if(t.metaKey||t.ctrlKey||t.shiftKey)return;if(t.defaultPrevented)return;let e=t.target;for(;e&&"A"!==e.nodeName;)e=e.parentNode;if(e&&"A"===e.nodeName){const i=e;if(!i.target&&i.origin===window.location.origin&&!(i.hasAttribute("download")||"external"===i.getAttribute("rel"))){const e=i.getAttribute("href");if(!(e&&-1<e.indexOf("mailto:"))){const e=this.goTo(i.pathname+i.search,i.hash);e&&t.preventDefault()}}}}goToState(e){if(e&&e.path){const t=this.load(e.path+this.search,e.hash);t&&e.index<this.active.index&&this.trigger("back"),t&&e.index>this.active.index&&this.trigger("forward"),this.active=e}}goTo(e,t=""){const i=this.load(e,t);if(i){const i=this.active?this.active.index+1:0;this.active={path:e,hash:t,index:i},window.history.pushState(this.active,"",e+t)}return i}back(){window.history.back()}forward(){window.history.forward()}}const RouterInstance=new Router,customElementOptions=new Map;class CustomHTMLElement extends HTMLElement{constructor(){super(...arguments),this.wasConnected=!1,this.isReady=!1}connectedCallback(){return __awaiter(this,void 0,void 0,function*(){if(this.wasConnected)return void this._view.trigger("connected");this.wasConnected=!0,this.isReady=!1,this._view.created();const e=customElementOptions.get(this._view.tagName)||{};(e.template||e.templateId)&&applyTemplate(this,e);const t=customElementChildren(this).filter(e=>!e.isReady).map(e=>new Promise(t=>e.addEventListener("ready",t)));yield Promise.all(t),this._view.ready(),this.dispatchEvent(new CustomEvent("ready")),this.isReady=!0})}disconnectedCallback(){this._view.trigger("disconnected")}attributeChangedCallback(e,t,i){this._view.trigger("attr:"+e,{newVal:i,oldVal:t})}}class CustomElementView extends HTMLBaseView{created(){}ready(){}}const PRECISION$1=1e-6,NUM_REGEX=/(\d+)(\d{3})/,POWER_SUFFIX=["","k","m","b","t","q"],SPECIAL_DECIMAL=/^-?0,[0-9]+$/,POINT_DECIMAL=/^-?([0-9]+(,[0-9]{3})*)?\.?[0-9]*$/,COMMA_DECIMAL=/^-?[0-9]+(\.[0-9]{3})*,?[0-9]*$/,ONES=["","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen"],TENS=["","","twenty","thirty","fourty","fifty","sixty","seventy","eighty","ninety"],MULTIPLIERS=["","thousand","million","billion","trillion","quadrillion","quintillion","sextillion"];class Point$1{constructor(e=0,t=0){this.x=e,this.y=t,this.type="point"}get unitVector(){return nearlyEquals$1(this.length,0)?new Point$1(1,0):this.scale(1/this.length)}get length(){return Math.sqrt(this.x**2+this.y**2)}get inverse(){return new Point$1(-this.x,-this.y)}get flip(){return new Point$1(this.y,this.x)}get perpendicular(){return new Point$1(-this.y,this.x)}get array(){return[this.x,this.y]}distanceFromLine(e){return Point$1.distance(this,e.project(this))}clamp(e,t,i,n){return new Point$1(clamp$1(this.x,e,t),clamp$1(this.y,i,n))}transform(e){const t=e[0][0]*this.x+e[0][1]*this.y+e[0][2],i=e[1][0]*this.x+e[1][1]*this.y+e[1][2];return new Point$1(t,i)}rotate(e,t=ORIGIN$1){const i=this.x-t.x,n=this.y-t.y,s=Math.cos(e),r=Math.sin(e),a=i*s-n*r+t.x,o=i*r+n*s+t.y;return new Point$1(a,o)}reflect(e){let t=e.p2.x-e.p1.x,i=e.p2.y-e.p1.y,n=this.x-e.p1.x,s=this.y-e.p1.y,r=(t*s-i*n)/(t*t+i*i),a=this.x+2*r*i,o=this.y-2*r*t;return new Point$1(a,o)}scale(e,t=e){return new Point$1(this.x*e,this.y*t)}shift(e,t=e){return new Point$1(this.x+e,this.y+t)}changeCoordinates(e,t){const i=t.xMin+(this.x-e.xMin)/e.dx*t.dx,n=t.yMin+(this.y-e.yMin)/e.dy*t.dy;return new Point$1(i,n)}add(e){return Point$1.sum(this,e)}subtract(e){return Point$1.difference(this,e)}equals(e){return Point$1.equals(this,e)}round(e=1){return new Point$1(roundTo$1(this.x,e),roundTo$1(this.y,e))}floor(){return new Point$1(Math.floor(this.x),Math.floor(this.y))}mod(e,t=e){return new Point$1(this.x%e,this.y%t)}angle(e=ORIGIN$1){return rad$1(this,e)}static average(...e){let t=total$3(e.map(e=>e.x))/e.length,i=total$3(e.map(e=>e.y))/e.length;return new Point$1(t,i)}static dot(e,t){return e.x*t.x+e.y*t.y}static sum(e,t){return new Point$1(e.x+t.x,e.y+t.y)}static difference(e,t){return new Point$1(e.x-t.x,e.y-t.y)}static distance(e,t){return Math.sqrt(square$1(e.x-t.x)+square$1(e.y-t.y))}static manhattan(e,t){return Math.abs(e.x-t.x)+Math.abs(e.y-t.y)}static interpolate(e,i,n=.5){return new Point$1(lerp$1(e.x,i.x,n),lerp$1(e.y,i.y,n))}static interpolateList(e,i=.5){const t=e.length-1,n=Math.floor(clamp$1(i,0,1)*t);return Point$1.interpolate(e[n],e[n+1],t*i-n)}static equals(e,t){return nearlyEquals$1(e.x,t.x)&&nearlyEquals$1(e.y,t.y)}static fromPolar(e,t=1){return new Point$1(t*Math.cos(e),t*Math.sin(e))}}const ORIGIN$1=new Point$1(0,0);class Bounds{constructor(e,t,i,n){this.xMin=e,this.xMax=t,this.yMin=i,this.yMax=n}get dx(){return this.xMax-this.xMin}get dy(){return this.yMax-this.yMin}}const TWO_PI$1=2*Math.PI;class Angle{constructor(e,t,i){this.a=e,this.b=t,this.c=i,this.type="angle"}transform(e){return new Angle(this.a.transform(e),this.b.transform(e),this.c.transform(e))}get rad(){let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),t=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),i=t-e;return 0>i&&(i+=TWO_PI$1),i}get deg(){return 180*this.rad/Math.PI}get isRight(){return nearlyEquals$1(this.rad,Math.PI/2,.01)}get bisector(){let e=Math.atan2(this.a.y-this.b.y,this.a.x-this.b.x),t=Math.atan2(this.c.y-this.b.y,this.c.x-this.b.x),i=(e+t)/2;e>t&&(i+=Math.PI);let n=Math.cos(i)+this.b.x,s=Math.sin(i)+this.b.y;return new Line$1(this.b,new Point$1(n,s))}get sup(){return this.rad<Math.PI?this:new Angle(this.c,this.b,this.a)}get arc(){return new Arc(this.b,this.a,this.rad)}equals(e){return!1}}class Line$1{constructor(e,t){this.p1=e,this.p2=t,this.type="line"}make(e,t){return new Line$1(e,t)}get length(){return Point$1.distance(this.p1,this.p2)}get midpoint(){return Point$1.average(this.p1,this.p2)}get slope(){return(this.p2.y-this.p1.y)/(this.p2.x-this.p1.x)}get intercept(){return this.p1.y+this.slope*this.p1.x}get angle(){return rad$1(this.p2,this.p1)}get unitVector(){return this.p2.subtract(this.p1).unitVector}get perpendicularVector(){return new Point$1(this.p2.y-this.p1.y,this.p1.x-this.p2.x).perpendicular}parallel(e){const t=Point$1.sum(e,Point$1.difference(this.p2,this.p1));return new Line$1(e,t)}perpendicular(e){return new Line$1(e,Point$1.sum(e,this.perpendicularVector))}get perpendicularBisector(){return this.perpendicular(this.midpoint)}project(e){const t=Point$1.difference(this.p2,this.p1),i=Point$1.difference(e,this.p1),n=t.scale(Point$1.dot(t,i)/this.length**2);return Point$1.sum(this.p1,n)}contains(e){const t=e.x*(this.p1.y-this.p2.y)+this.p1.x*(this.p2.y-e.y)+this.p2.x*(e.y-this.p1.y);return nearlyEquals$1(t,0)}at(e){return Point$1.interpolate(this.p1,this.p2,e)}transform(e){return new this.constructor(this.p1.transform(e),this.p2.transform(e))}rotate(e,t=ORIGIN$1){return new this.constructor(this.p1.rotate(e,t),this.p2.rotate(e,t))}reflect(e){return new this.constructor(this.p1.reflect(e),this.p2.reflect(e))}scale(e,t=e){return this.make(this.p1.scale(e,t),this.p2.scale(e,t))}shift(e,t=e){return this.make(this.p1.shift(e,t),this.p2.shift(e,t))}translate(e){return this.shift(e.x,e.y)}equals(e){return Line$1.equals(this,e)}static equals(e,t){return e.contains(t.p1)&&e.contains(t.p2)}}class Ray extends Line$1{constructor(){super(...arguments),this.type="ray"}}class Segment extends Line$1{constructor(){super(...arguments),this.type="segment"}contains(e){return!0}make(e,t){return new Segment(e,t)}project(e){const t=Point$1.difference(this.p2,this.p1),i=Point$1.difference(e,this.p1),n=clamp$1(Point$1.dot(t,i)/square$1(this.length),0,1);return Point$1.sum(this.p1,t.scale(n))}contract(e){return new Segment(this.at(e),this.at(1-e))}static equals(e,t,i=!1){return Point$1.equals(e.p1,t.p1)&&Point$1.equals(e.p2,t.p2)||!i&&Point$1.equals(e.p1,t.p2)&&Point$1.equals(e.p2,t.p1)}static intersect(e,t){return intersections$1(e,t)[0]||null}}class Circle{constructor(e=ORIGIN$1,t=1){this.c=e,this.r=t,this.type="circle"}get circumference(){return TWO_PI$1*this.r}get area(){return Math.PI*this.r**2}get arc(){let e=this.c.shift(this.r,0);return new Arc(this.c,e,TWO_PI$1)}transform(e){return new Circle(this.c.transform(e),this.r*(e[0][0]+e[1][1])/2)}rotate(e,t=ORIGIN$1){return new Circle(this.c.rotate(e,t),this.r)}reflect(e){return new Circle(this.c.reflect(e),this.r)}scale(e,t=e){return new Circle(this.c.scale(e,t),this.r*(e+t)/2)}shift(e,t=e){return new Circle(this.c.shift(e,t),this.r)}translate(e){return this.shift(e.x,e.y)}contains(e){return Point$1.distance(e,this.c)<=this.r}equals(e){return nearlyEquals$1(this.r,e.r)&&this.c.equals(e.c)}project(e){const t=Point$1.difference(e,this.c).perpendicular.scale(this.r);return Point$1.sum(this.c,t)}at(e){const t=2*Math.PI*e;return this.c.shift(this.r*Math.cos(t),this.r*Math.sin(t))}tangentAt(e){const t=this.at(e),i=this.c.rotate(Math.PI/2,t);return new Line$1(t,i)}}class Arc{constructor(e,t,i){this.c=e,this.start=t,this.angle=i,this.type="arc"}get radius(){return Point$1.distance(this.c,this.start)}get end(){return this.start.rotate(this.angle,this.c)}transform(e){return new this.constructor(this.c.transform(e),this.start.transform(e),this.angle)}get startAngle(){return rad$1(this.start,this.c)}project(e){let t=this.startAngle,i=t+this.angle,n=rad$1(e,this.c);return i>TWO_PI$1&&n<i-TWO_PI$1&&(n+=TWO_PI$1),n=clamp$1(n,t,i),this.c.shift(this.radius,0).rotate(n,this.c)}at(e){return this.start.rotate(this.angle*e,this.c)}contract(e){return new this.constructor(this.c,this.at(e/2),this.angle*(1-e))}get minor(){return this.angle<=Math.PI?this:new this.constructor(this.c,this.end,2*Math.PI-this.angle)}get major(){return this.angle>=Math.PI?this:new this.constructor(this.c,this.end,2*Math.PI-this.angle)}get center(){return this.at(.5)}equals(){return!1}}class Sector extends Arc{constructor(){super(...arguments),this.type="sector"}}class Polygon{constructor(...e){this.type="polygon",this.points=e}get circumference(){let e=0;for(let t=1;t<this.points.length;++t)e+=Point$1.distance(this.points[t-1],this.points[t]);return e}get signedArea(){let e=this.points,t=e.length,n=e[t-1].x*e[0].y-e[0].x*e[t-1].y;for(let s=1;s<t;++s)n+=e[s-1].x*e[s].y-e[s].x*e[s-1].y;return n/2}get area(){return Math.abs(this.signedArea)}get centroid(){let e=this.points,t=e.length,n=0;for(let s=0;s<t;++s)n+=e[s].x;let s=0;for(let n=0;n<t;++n)s+=e[n].y;return new Point$1(n/t,s/t)}get edges(){let e=this.points,t=e.length,n=[];for(let s=0;s<t;++s)n.push(new Segment(e[s],e[(s+1)%t]));return n}get radius(){const e=this.centroid,t=this.points.map(t=>Point$1.distance(t,e));return Math.max(...t)}transform(e){return new this.constructor(...this.points.map(t=>t.transform(e)))}rotate(e,t=ORIGIN$1){const i=this.points.map(i=>i.rotate(e,t));return new this.constructor(...i)}reflect(e){const t=this.points.map(t=>t.reflect(e));return new this.constructor(...t)}scale(e,t=e){const i=this.points.map(i=>i.scale(e,t));return new this.constructor(...i)}shift(e,t=e){const i=this.points.map(i=>i.shift(e,t));return new this.constructor(...i)}translate(e){return this.shift(e.x,e.y)}contains(e){let t=this.points.length,n=!1;for(let s=0;s<t;++s){const i=this.points[s],r=this.points[(s+1)%t],a=i.y>e.y!=r.y>e.y,o=e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x;a&&o&&(n=!n)}return n}equals(e){return!1}project(e){return ORIGIN$1}at(e){return Point$1.interpolateList([...this.points,this.points[0]],e)}get oriented(){if(0<=this.signedArea)return this;const e=[...this.points].reverse();return new this.constructor(...e)}intersect(e){const t=[toLinkedList(this.oriented.points),toLinkedList(e.oriented.points)],i=this.points.length+e.points.length,n=[];let s=0,r=t[s].find(t=>e.contains(t.val));if(!r)return null;for(;r.val!==n[0]&&n.length<i;){n.push(r.val);const e=new Segment(r.val,r.next.val);r=r.next;for(let i of t[1-s]){const t=new Segment(i.val,i.next.val),n=intersections$1(e,t)[0];if(n){s=1-s,r={val:n,next:i.next};break}}}return new Polygon(...n)}static collision(e,t){for(let i of e.edges)for(let e of t.edges)if(Segment.intersect(i,e))return!0;for(let i of e.points)if(t.contains(i))return!0;for(let i of t.points)if(e.contains(i))return!0;return!1}static regular(e,t=1){const n=2*Math.PI/e,s=Math.PI/2-n/2,i=tabulate$1(e=>Point$1.fromPolar(s+n*e,t),e);return new Polygon(...i)}static interpolate(e,n,s=.5){const t=e.points.map((e,t)=>Point$1.interpolate(e,n.points[t],s));return new Polygon(...t)}}class Polyline extends Polygon{constructor(){super(...arguments),this.type="polyline"}get edges(){let e=[];for(let t=0;t<this.points.length-1;++t)e.push(new Segment(this.points[t],this.points[t+1]));return e}}class Triangle extends Polygon{constructor(){super(...arguments),this.type="triangle"}get circumcircle(){const[e,t,i]=this.points,n=2*(e.x*(t.y-i.y)+t.x*(i.y-e.y)+i.x*(e.y-t.y)),s=(e.x**2+e.y**2)*(t.y-i.y)+(t.x**2+t.y**2)*(i.y-e.y)+(i.x**2+i.y**2)*(e.y-t.y),r=(e.x**2+e.y**2)*(i.x-t.x)+(t.x**2+t.y**2)*(e.x-i.x)+(i.x**2+i.y**2)*(t.x-e.x),a=new Point$1(s/n,r/n),o=Point$1.distance(a,this.points[0]);return new Circle(a,o)}get incircle(){const e=this.edges,t=e.map(t=>t.length),i=t[0]+t[1]+t[2],[n,s,r]=this.points,a=t[1]*n.x+t[2]*s.x+t[0]*r.x,o=t[1]*n.y+t[2]*s.y+t[0]*r.y,l=new Point$1(a/i,o/i),d=l.distanceFromLine(e[0]);return new Circle(l,d)}get orthocenter(){const[e,t,i]=this.points,n=new Line$1(e,t).perpendicular(i),s=new Line$1(e,i).perpendicular(t);return intersections$1(n,s)[0]}}class Rectangle{constructor(e,t=1,i=t){this.p=e,this.w=t,this.h=i,this.type="rectangle"}static aroundPoints(...e){const t=e.map(e=>e.x),i=e.map(e=>e.y),n=Math.min(...t),s=Math.max(...t)-n,r=Math.min(...i),a=Math.max(...i)-r;return new Rectangle(new Point$1(n,r),s,a)}get center(){return new Point$1(this.p.x+this.w/2,this.p.y+this.h/2)}get circumference(){return 2*Math.abs(this.w)+2*Math.abs(this.h)}get area(){return Math.abs(this.w*this.h)}get edges(){return this.polygon.edges}get points(){return this.polygon.points}get polygon(){let e=new Point$1(this.p.x+this.w,this.p.y),t=new Point$1(this.p.x+this.w,this.p.y+this.h),i=new Point$1(this.p.x,this.p.y+this.h);return new Polygon(this.p,e,t,i)}transform(e){return this.polygon.transform(e)}rotate(e,t=ORIGIN$1){return this.polygon.rotate(e,t)}reflect(e){return this.polygon.reflect(e)}scale(e,t=e){return new Rectangle(this.p.scale(e,t),this.w*e,this.h*t)}shift(e,t=e){return new Rectangle(this.p.shift(e,t),this.w,this.h)}translate(e){return this.shift(e.x,e.y)}contains(e){return isBetween$1(e.x,this.p.x,this.p.x+this.w)&&isBetween$1(e.y,this.p.y,this.p.y+this.h)}equals(e){return!1}project(e){let t={x:this.p.x+this.w,y:this.p.y+this.h},i={x:this.p.x+this.w/2,y:this.p.y+this.h/2},n=(i.y-e.y)/(i.x-e.x);if(e.x<=i.x){let i=n*(this.p.x-e.x)+e.y;if(this.p.y<i&&i<t.y)return new Point$1(this.p.x,i)}if(e.x>=i.x){let i=n*(t.x-e.x)+e.y;if(this.p.y<i&&i<t.y)return new Point$1(t.x,i)}if(e.y<=i.y){let i=(this.p.y-e.y)/n+e.x;if(this.p.x<i&&i<t.x)return new Point$1(i,this.p.y)}if(e.y>=i.y){let i=(t.y-e.y)/n+e.x;if(this.p.x<i&&i<t.x)return new Point$1(i,t.y)}}at(e){}}var Matrix$1;(function(e){function t(e,t,i){return repeat2D$2(e,t,i)}function i(e=2){const n=t(0,e,e);for(let t=0;t<e;++t)n[t][t]=1;return n}function n(...e){const[t,...i]=e,s=1<i.length?n(...i):i[0];if(t.length!==s.length||t[0].length!==s[0].length)throw new Error("Matrix sizes don\u2019t match");const r=[];for(let n=0;n<t.length;++n){const e=[];for(let i=0;i<t[n].length;++i)e.push(t[n][i]+s[n][i]);r.push(e)}return r}function s(...e){let[t,...i]=e,n=1<i.length?s(...i):i[0];if(t[0].length!==n.length)throw new Error("Matrix sizes don\u2019t match.");let r=[];for(let s=0,i;s<t.length;++s){i=[];for(let e=0,r;e<n[0].length;++e){r=0;for(let i=0;i<n.length;++i)r+=t[s][i]*n[i][e];i.push(r)}r.push(i)}return r}e.fill=t,e.identity=i,e.rotation=function(e){const t=Math.sin(e),i=Math.cos(e);return[[i,-t],[t,i]]},e.shear=function(e){return[[1,e],[0,1]]},e.reflection=function(e){const t=Math.sin(2*e),i=Math.cos(2*e);return[[i,t],[t,-i]]},e.sum=n,e.scalarProduct=function(e,t){return e.map(e=>e.map(e=>e*t))},e.product=s,e.transpose=function(e){let t=[];for(let n=0,s;n<e[0].length;++n){s=[];for(let t=0;t<e.length;++t)s.push(e[t][n]);t.push(s)}return t},e.determinant=function(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let i=0;for(let n=0;n<t;++n){let s=e[0][n],r=e[0][n];for(let a=1;a<t;++a)r*=e[a][n+a%t],s*=e[a][n-a%t];i+=r-s}return i},e.inverse=function(e){let t=e.length;if(t!==e[0].length)throw new Error("Not a square matrix.");let n=i(t),s=tabulate2D$1((t,i)=>e[t][i],t,t);for(let r=0,i;r<t;++r){if(i=s[r][r],!i){for(let e=r+1;e<t;++e)if(0!==s[e][r]){for(let i=0;i<t;++i)[s[e][i],s[r][i]]=[s[r][i],s[e][i]],[n[e][i],n[r][i]]=[n[r][i],n[e][i]];break}if(i=s[r][r],!i)throw new Error("Matrix not invertible.")}for(let e=0;e<t;++e)s[r][e]/=i,n[r][e]/=i;for(let e=0;e<t;++e){if(e===r)continue;let i=s[e][r];for(let a=0;a<t;++a)s[e][a]-=i*s[r][a],n[e][a]-=i*n[r][a]}}return n}})(Matrix$1||(Matrix$1={}));var Random$1;(function(e){function t(e){e=e.slice(0);for(let t=e.length-1,i;0<t;--t)i=Math.floor(Math.random()*(t+1)),[e[t],e[i]]=[e[i],e[t]];return e}function i(e){const t=Math.random()*total$3(e);let i=0;return e.findIndex(e=>(i+=e)>=t)}function s(e=.5){return Math.random()<e?1:0}function r(e){if(.5>e)return Math.PI/(Math.sin(Math.PI*e)*r(1-e));e-=1;let s=n[0];for(let t=1;9>t;t++)s+=n[t]/(e+t);let i=e+l+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*s}function a(e,t,i,n=1){let s=0;for(let r=t;r<i;r+=n)s+=e(r)*n||0;return s}e.shuffle=t,e.integer=function(e,t){let i=void 0===t?0:e,n=void 0===t?e:t-e+1;return i+Math.floor(n*Math.random())},e.intArray=function(e){let n=[];for(let t=0;t<e;++t)n.push(t);return t(n)},e.weighted=i;const o=new Map;e.smart=function(e,t){t||(t=uid$1()),o.has(t)||o.set(t,repeat$3(1,e));const n=o.get(t),s=i(n.map(e=>e*e));return n[s]-=1,0>=n[s]&&o.set(t,n.map(e=>e+1)),s},e.bernoulli=s,e.binomial=function(e=1,n=.5){let r=0;for(let t=0;t<e;++t)r+=s(n);return r},e.poisson=function(e=1){if(0>=e)return 0;const t=Math.exp(-e);let i=1,n=0;for(;i>t;++n)i*=Math.random();return n-1},e.uniform=function(e=0,t=1){return e+(t-e)*Math.random()},e.normal=function(e=0,t=1){const i=Math.random(),n=Math.random(),s=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*n);return s*Math.sqrt(t)+e},e.exponential=function(e=1){return 0>=e?0:-Math.log(Math.random())/e},e.geometric=function(e=.5){return 0>=e||1<e?null:Math.floor(Math.log(Math.random())/Math.log(1-e))},e.cauchy=function(){let e,t,i;do t=2*Math.random()-1,i=2*Math.random()-1,e=t*t+i*i;while(1<=e);return t/i},e.normalPDF=function(e,t=1,i=0){return Math.exp(-((e-t)**2)/(2*i))/Math.sqrt(2*Math.PI*i)};const l=7,n=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];e.integrate=a,e.chiCDF=function(e,i){let n=a(e=>Math.pow(e,(i-2)/2)*Math.exp(-e/2),0,e);return 1-n/Math.pow(2,i/2)/r(i/2)}})(Random$1||(Random$1={}));var Regression$1;(function(e){function t(e,t=!1){let i=0,s=0,r=0,a=0;const o=e.length;for(let l=0;l<o;l++)i+=e[l][0],s+=e[l][1],r+=e[l][0]*e[l][0],a+=e[l][0]*e[l][1];if(t){const e=a/r;return[0,e]}const l=(o*a-i*s)/(o*r-i*i),d=s/o-l*i/o;return[d,l]}function i(e){const t=[0,0,0,0,0,0];for(const i of e)t[0]+=i[0],t[1]+=i[1],t[2]+=i[0]*i[0]*i[1],t[3]+=i[1]*Math.log(i[1]),t[4]+=i[0]*i[1]*Math.log(i[1]),t[5]+=i[0]*i[1];const i=t[1]*t[2]-t[5]*t[5],n=Math.exp((t[2]*t[3]-t[5]*t[4])/i),s=(t[1]*t[4]-t[5]*t[3])/i;return[n,s]}function n(e,t=2){let i=e.map(e=>list$1(t+1).map(t=>Math.pow(e[0],t))),n=Matrix$1.transpose(i),s=e.map(e=>[e[1]]),a=Matrix$1.product(n,i),o=Matrix$1.inverse(a),l=Matrix$1.product(o,n,s);return l.map(e=>e[0])}function s(e,t){let i=e.reduce((e,t)=>e+t[1],0),n=i/e.length,s=e.reduce((e,t)=>e+(t[1]-n)**2,0),r=e.reduce((e,i)=>e+(i[1]-t(i[0]))**2,0);return 1-r/s}e.linear=t,e.exponential=i,e.logarithmic=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=i[1]*Math.log(i[0]),t[2]+=i[1],t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=(t[2]-n*t[0])/i;return[s,n]},e.power=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=Math.log(i[1])*Math.log(i[0]),t[2]+=Math.log(i[1]),t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=Math.exp((t[2]-n*t[0])/i);return[s,n]},e.polynomial=n,e.coefficient=s;const r=[{name:"linear",regression:t,fn:(e,t)=>e[0]+t*e[1]},{name:"quadratic",regression:n,fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]},{name:"cubic",regression:e=>n(e,3),fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]+t*t*t*e[3]},{name:"exponential",regression:i,fn:(e,t)=>e[0]*Math.pow(Math.E,e[1]*t)}];e.find=function(e,i=.9){if(1<e.length)for(const n of r){const t=n.regression(e),r=n.fn.bind(null,t),a=s(e,r);if(a>i)return{type:n.name,fn:r,params:t,coeff:a}}return{type:null,fn:()=>{},params:[],coeff:null}}})(Regression$1||(Regression$1={}));let Blank=class extends CustomElementView{constructor(){super(...arguments),this.done=!1}ready(){this.$target=this.$(".target");const e=this.$(".popup"),t=e.$$(".choice");this.solution=t[0].html;const i=Random$1.intArray(t.length);i.forEach(n=>{e.append(t[0]),t[n].on("click",()=>{this.removeClass("on"),n?(this.$target.html=t[n].html,this.addClass("invalid"),this.trigger("invalid")):(this.solve(),this.trigger("valid",this.solution))})});const n=this.$target.bounds.left+e.width>Browser.width-15;this.setClass("left",n),hover(this,{enter:()=>{if(this.done)return;this.addClass("on");const t=this.$target.bounds,i=e.width,n=e.height,s=Browser.width-10-t.left,r=i<s,a=10<t.right-i,o=t.top+t.height+n>Browser.height-10;this.setClass("left",a&&!r),this.setClass("top",o),e.css("max-width",a||r?"none":`${s}px`)},exit:()=>{this.removeClass("on")},delay:100,exitDelay:400,$clickTarget:this.$target})}solve(){this.done=!0,this.$target.html=this.solution,this.removeClass("on invalid"),this.addClass("done")}};Blank=__decorate([register("x-blank",{templateId:"#blank"})],Blank);let BlankInput=class extends CustomElementView{constructor(){super(...arguments),this.solution="",this.solutionNum=NaN,this.range=0,this.input="",this.attempts=0,this.done=!1}ready(){if(this.$input=this.$("input"),this.$target=this.$(".target"),this.solution=this.attr("solution"),0<=this.solution.indexOf("\xB1")){const e=this.solution.split("\xB1");this.solution=e[0].trim(),this.solutionNum=+this.solution,this.range=+e[1]}else this.solutionNum=parseInput(this.solution);this.removeAttr("solution"),setInputPattern(this.$input,this.solutionNum),this.$input.change(e=>{this.input=e,this.isCorrect&&(this.solve(),this.trigger("valid",e),this.moveCursor())}),this.$input.onKeyDown("enter",()=>this.$input.blur()),this.$input.on("focus",()=>{this.addClass("on"),this.removeClass("invalid"),this.$input.setAttr("placeholder"," ")}),this.$input.on("blur",()=>{this.removeClass("on"),this.setClass("invalid",!!this.input&&!this.done),this.$input.setAttr("placeholder","???"),this.input&&!this.done&&(this.attempts+=1,3<=this.attempts?this.trigger("hint",this.solution):this.trigger("invalid"))})}get isCorrect(){if(this.done)return!0;const e=parseInput(this.input);return this.input.toLowerCase()===this.solution.toLowerCase()||(this.range&&Math.abs(+this.input-this.solutionNum)<=this.range?(this.solution=this.input,!0):nearlyEquals$1(e,this.solutionNum)||toWord(e)===this.solution||this.input===toWord(this.solutionNum))}moveCursor(){const e=this.getModel().$step;if(!e)return;const t=e?e.$$("x-blank, x-blank-input"):[],i=t[t.indexOf(this)+1];i&&!i.done&&"X-BLANK"!==i.tagName&&"hidden"!==i.css("visibility")&&i.bounds.width&&i.focus()}solve(){this.done=!0,this.$input.remove(),this.$target.html=this.solution,this.addClass("done")}focus(){this.$input.focus()}blur(){this.$input.blur()}};BlankInput=__decorate([register("x-blank-input",{templateId:"#blank-input"})],BlankInput);class ExprError extends Error{constructor(e,t){super(t),this.name=e}static undefinedVariable(e){return new ExprError("EvalError",`Undefined variable “${e}”.`)}static undefinedFunction(e){return new ExprError("EvalError",`Undefined function “${e}”.`)}static invalidCharacter(e){return new ExprError("SyntaxError",`Unknown symbol “${e}”.`)}static conflictingBrackets(e){return new ExprError("SyntaxError",`Conflicting brackets “${e}”.`)}static unclosedBracket(e){return new ExprError("SyntaxError",`Unclosed bracket “${e}”.`)}static startOperator(e){return new ExprError("SyntaxError",`A term cannot start with a “${e}”.`)}static endOperator(e){return new ExprError("SyntaxError",`A term cannot end with a “${e}”.`)}static consecutiveOperators(e,t){return new ExprError("SyntaxError",`A “${e}” cannot be followed by a “${t}”.`)}static invalidExpression(){return new ExprError("SyntaxError",`This expression is invalid.`)}}const PRECISION$2=1e-6,TWO_PI$2=2*Math.PI;var Matrix$2;(function(e){function t(e,t,i){return repeat2D$3(e,t,i)}function i(e=2){const n=t(0,e,e);for(let t=0;t<e;++t)n[t][t]=1;return n}function n(...e){const[t,...i]=e,s=1<i.length?n(...i):i[0];if(t.length!==s.length||t[0].length!==s[0].length)throw new Error("Matrix sizes don\u2019t match");const r=[];for(let n=0;n<t.length;++n){const e=[];for(let i=0;i<t[n].length;++i)e.push(t[n][i]+s[n][i]);r.push(e)}return r}function s(...e){let[t,...i]=e,n=1<i.length?s(...i):i[0];if(t[0].length!==n.length)throw new Error("Matrix sizes don\u2019t match.");let r=[];for(let s=0,i;s<t.length;++s){i=[];for(let e=0,r;e<n[0].length;++e){r=0;for(let i=0;i<n.length;++i)r+=t[s][i]*n[i][e];i.push(r)}r.push(i)}return r}e.fill=t,e.identity=i,e.rotation=function(e){const t=Math.sin(e),i=Math.cos(e);return[[i,-t],[t,i]]},e.shear=function(e){return[[1,e],[0,1]]},e.reflection=function(e){const t=Math.sin(2*e),i=Math.cos(2*e);return[[i,t],[t,-i]]},e.sum=n,e.scalarProduct=function(e,t){return e.map(e=>e.map(e=>e*t))},e.product=s,e.transpose=function(e){let t=[];for(let n=0,s;n<e[0].length;++n){s=[];for(let t=0;t<e.length;++t)s.push(e[t][n]);t.push(s)}return t},e.determinant=function(e){if(e.length!==e[0].length)throw new Error("Not a square matrix.");let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let i=0;for(let n=0;n<t;++n){let s=e[0][n],r=e[0][n];for(let a=1;a<t;++a)r*=e[a][n+a%t],s*=e[a][n-a%t];i+=r-s}return i},e.inverse=function(e){let t=e.length;if(t!==e[0].length)throw new Error("Not a square matrix.");let n=i(t),s=tabulate2D$2((t,i)=>e[t][i],t,t);for(let r=0,i;r<t;++r){if(i=s[r][r],!i){for(let e=r+1;e<t;++e)if(0!==s[e][r]){for(let i=0;i<t;++i)[s[e][i],s[r][i]]=[s[r][i],s[e][i]],[n[e][i],n[r][i]]=[n[r][i],n[e][i]];break}if(i=s[r][r],!i)throw new Error("Matrix not invertible.")}for(let e=0;e<t;++e)s[r][e]/=i,n[r][e]/=i;for(let e=0;e<t;++e){if(e===r)continue;let i=s[e][r];for(let a=0;a<t;++a)s[e][a]-=i*s[r][a],n[e][a]-=i*n[r][a]}}return n}})(Matrix$2||(Matrix$2={}));var Random$2;(function(e){function t(e){e=e.slice(0);for(let t=e.length-1,i;0<t;--t)i=Math.floor(Math.random()*(t+1)),[e[t],e[i]]=[e[i],e[t]];return e}function i(e){const t=Math.random()*total$4(e);let i=0;return e.findIndex(e=>(i+=e)>=t)}function s(e=.5){return Math.random()<e?1:0}function r(e){if(.5>e)return Math.PI/(Math.sin(Math.PI*e)*r(1-e));e-=1;let s=n[0];for(let t=1;9>t;t++)s+=n[t]/(e+t);let i=e+l+.5;return Math.sqrt(2*Math.PI)*Math.pow(i,e+.5)*Math.exp(-i)*s}function a(e,t,i,n=1){let s=0;for(let r=t;r<i;r+=n)s+=e(r)*n||0;return s}e.shuffle=t,e.integer=function(e,t){let i=void 0===t?0:e,n=void 0===t?e:t-e+1;return i+Math.floor(n*Math.random())},e.intArray=function(e){let n=[];for(let t=0;t<e;++t)n.push(t);return t(n)},e.weighted=i;const o=new Map;e.smart=function(e,t){t||(t=uid$2()),o.has(t)||o.set(t,repeat$4(1,e));const n=o.get(t),s=i(n.map(e=>e*e));return n[s]-=1,0>=n[s]&&o.set(t,n.map(e=>e+1)),s},e.bernoulli=s,e.binomial=function(e=1,n=.5){let r=0;for(let t=0;t<e;++t)r+=s(n);return r},e.poisson=function(e=1){if(0>=e)return 0;const t=Math.exp(-e);let i=1,n=0;for(;i>t;++n)i*=Math.random();return n-1},e.uniform=function(e=0,t=1){return e+(t-e)*Math.random()},e.normal=function(e=0,t=1){const i=Math.random(),n=Math.random(),s=Math.sqrt(-2*Math.log(i))*Math.cos(2*Math.PI*n);return s*Math.sqrt(t)+e},e.exponential=function(e=1){return 0>=e?0:-Math.log(Math.random())/e},e.geometric=function(e=.5){return 0>=e||1<e?null:Math.floor(Math.log(Math.random())/Math.log(1-e))},e.cauchy=function(){let e,t,i;do t=2*Math.random()-1,i=2*Math.random()-1,e=t*t+i*i;while(1<=e);return t/i},e.normalPDF=function(e,t=1,i=0){return Math.exp(-((e-t)**2)/(2*i))/Math.sqrt(2*Math.PI*i)};const l=7,n=[.9999999999998099,676.5203681218851,-1259.1392167224028,771.3234287776531,-176.6150291621406,12.507343278686905,-.13857109526572012,9984369578019572e-21,1.5056327351493116e-7];e.integrate=a,e.chiCDF=function(e,i){let n=a(e=>Math.pow(e,(i-2)/2)*Math.exp(-e/2),0,e);return 1-n/Math.pow(2,i/2)/r(i/2)}})(Random$2||(Random$2={}));var Regression$2;(function(e){function t(e,t=!1){let i=0,s=0,r=0,a=0;const o=e.length;for(let l=0;l<o;l++)i+=e[l][0],s+=e[l][1],r+=e[l][0]*e[l][0],a+=e[l][0]*e[l][1];if(t){const e=a/r;return[0,e]}const l=(o*a-i*s)/(o*r-i*i),d=s/o-l*i/o;return[d,l]}function i(e){const t=[0,0,0,0,0,0];for(const i of e)t[0]+=i[0],t[1]+=i[1],t[2]+=i[0]*i[0]*i[1],t[3]+=i[1]*Math.log(i[1]),t[4]+=i[0]*i[1]*Math.log(i[1]),t[5]+=i[0]*i[1];const i=t[1]*t[2]-t[5]*t[5],n=Math.exp((t[2]*t[3]-t[5]*t[4])/i),s=(t[1]*t[4]-t[5]*t[3])/i;return[n,s]}function n(e,t=2){let i=e.map(e=>list$2(t+1).map(t=>Math.pow(e[0],t))),n=Matrix$2.transpose(i),s=e.map(e=>[e[1]]),a=Matrix$2.product(n,i),o=Matrix$2.inverse(a),l=Matrix$2.product(o,n,s);return l.map(e=>e[0])}function s(e,t){let i=e.reduce((e,t)=>e+t[1],0),n=i/e.length,s=e.reduce((e,t)=>e+(t[1]-n)**2,0),r=e.reduce((e,i)=>e+(i[1]-t(i[0]))**2,0);return 1-r/s}e.linear=t,e.exponential=i,e.logarithmic=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=i[1]*Math.log(i[0]),t[2]+=i[1],t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=(t[2]-n*t[0])/i;return[s,n]},e.power=function(e){const t=[0,0,0,0],i=e.length;for(const i of e)t[0]+=Math.log(i[0]),t[1]+=Math.log(i[1])*Math.log(i[0]),t[2]+=Math.log(i[1]),t[3]+=Math.pow(Math.log(i[0]),2);const n=(i*t[1]-t[2]*t[0])/(i*t[3]-t[0]*t[0]),s=Math.exp((t[2]-n*t[0])/i);return[s,n]},e.polynomial=n,e.coefficient=s;const r=[{name:"linear",regression:t,fn:(e,t)=>e[0]+t*e[1]},{name:"quadratic",regression:n,fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]},{name:"cubic",regression:e=>n(e,3),fn:(e,t)=>e[0]+t*e[1]+t*t*e[2]+t*t*t*e[3]},{name:"exponential",regression:i,fn:(e,t)=>e[0]*Math.pow(Math.E,e[1]*t)}];e.find=function(e,i=.9){if(1<e.length)for(const n of r){const t=n.regression(e),r=n.fn.bind(null,t),a=s(e,r);if(a>i)return{type:n.name,fn:r,params:t,coeff:a}}return{type:null,fn:()=>{},params:[],coeff:null}}})(Regression$2||(Regression$2={}));const CONSTANTS={pi:Math.PI,π:Math.PI,e:Math.E},BRACKETS={"(":")","[":"]","{":"}","|":"|"},SPECIAL_OPERATORS={"*":"\xB7","**":"\u2217","//":"//","+-":"\xB1","–":"\u2212","-":"\u2212",xx:"\xD7",sum:"\u2211",prod:"\u220F",int:"\u222B",del:"\u2202",grad:"\u2207",aleph:"\u2135",not:"\xAC",AA:"\u2200",EE:"\u2203","'":"\u2019","!=":"\u2260","<=":"\u2264",">=":"\u2265",in:"\u2208","!in":"\u2209","==":"\u2261","~=":"\u2245","~~":"\u2248",sub:"\u2282",sube:"\u2286",prop:"\u221D",oo:"\u221E","<-":"\u2190","->":"\u2192","=>":"\u21D2","<=>":"\u21D4","|->":"\u21A6",uarr:"\u2191",darr:"\u2193",lArr:"\u21D0",CC:"\u2102",NN:"\u2115",QQ:"\u211A",RR:"\u211D",ZZ:"\u2124"},SPECIAL_IDENTIFIERS={Gamma:"\u0393",Delta:"\u0394",Theta:"\u0398",Lambda:"\u039B",Xi:"\u039E",Pi:"\u03A0",Sigma:"\u03A3",Phi:"\u03A6",Psi:"\u03A8",Omega:"\u03A9",alpha:"\u03B1",beta:"\u03B2",gamma:"\u03B3",delta:"\u03B4",epsilon:"\u025B",zeta:"\u03B6",eta:"\u03B7",theta:"\u03B8",iota:"\u03B9",kappa:"\u03BA",lambda:"\u03BB",mu:"\u03BC",nu:"\u03BD",xi:"\u03BE",pi:"\u03C0",rho:"\u03C1",sigma:"\u03C3",tau:"\u03C4",upsilon:"\u03C5",phi:"\u03C6",chi:"\u03C7",psi:"\u03C8",omega:"\u03C9"},ALPHABET="abcdefghijklmnopqrstuvwxyz",LOWERCASE=ALPHABET.split(""),UPPERCASE=ALPHABET.toUpperCase().split(""),GREEK=Object.values(SPECIAL_IDENTIFIERS),IDENTIFIER_SYMBOLS=[...LOWERCASE,...UPPERCASE,...GREEK,"$"],SIMPLE_SYMBOLS="|()[]{}\xF7,!<>=*/+-\u2013\u2212~^_\u2026\xB0\u2022\u2225\u22A5'\u2220:%\u223C\u25B3",COMPLEX_SYMBOLS=Object.values(SPECIAL_OPERATORS),OPERATOR_SYMBOLS=[...SIMPLE_SYMBOLS,...COMPLEX_SYMBOLS],ESCAPES={"<":"&lt;",">":"&gt;"},SPECIAL=new Set(["sin","cos","tan","sec","csc","cot","arcsin","arccos","arctan","sinh","cosh","tanh","sech","csch","coth","exp","log","ln","det","dim","mod","gcd","lcm","min","max"]);class ExprElement{evaluate(e={}){return NaN}substitute(e={}){return this}get simplified(){return this}get variables(){return[]}get functions(){return[]}collapse(){return this}toString(){return""}toMathML(e={}){return""}}class ExprNumber extends ExprElement{constructor(e){super(),this.n=e}evaluate(){return this.n}toString(){return""+this.n}toMathML(){return`<mn>${this.n}</mn>`}}class ExprIdentifier extends ExprElement{constructor(e){super(),this.i=e}evaluate(e={}){if(this.i in e)return e[this.i];if(this.i in CONSTANTS)return CONSTANTS[this.i];throw ExprError.undefinedVariable(this.i)}toMathML(){const e=isSpecialFunction(this.i)?" mathvariant=\"normal\"":"";return`<mi${e}>${this.i}</mi>`}substitute(e={}){return e[this.i]||this}get variables(){return[this.i]}toString(){return this.i}}class ExprString extends ExprElement{constructor(e){super(),this.s=e}evaluate(e={}){if(this.s in e)return e[this.s];throw ExprError.undefinedVariable(this.s)}toString(){return"\""+this.s+"\""}toMathML(){return`<mtext>${this.s}</mtext>`}}class ExprSpace extends ExprElement{toString(){return" "}toMathML(){return`<mspace/>`}}class ExprOperator extends ExprElement{constructor(e){super(),this.o=e}toString(){return this.o.replace("//","/")}get functions(){return[this.o]}toMathML(){const e=escape(this.toString());return`<mo value="${e}">${e}</mo>`}}const PRECEDENCE=words$2("+ \u2212 * \xD7 \xB7 / \xF7 // sup sub"),COMMA="<mo value=\",\" lspace=\"0\">,</mo>";class ExprFunction extends ExprElement{constructor(e,t=[]){super(),this.fn=e,this.args=t}evaluate(e={}){const t=this.args.map(t=>t.evaluate(e));if(this.fn in e)return e[this.fn](...t);switch(this.fn){case"+":return t.reduce((e,t)=>e+t,0);case"\u2212":return 1<t.length?t[0]-t[1]:-t[0];case"*":case"\xB7":case"\xD7":return t.reduce((e,t)=>e*t,1);case"/":return t[0]/t[1];case"sin":return Math.sin(t[0]);case"cos":return Math.sin(t[0]);case"tan":return Math.sin(t[0]);case"log":return Math.log(t[0])/Math.log(t[1]||Math.E);case"sup":return Math.pow(t[0],t[1]);case"sqrt":return Math.sqrt(t[0]);case"root":return Math.pow(t[0],1/t[1]);case"(":return t[0];}throw ExprError.undefinedFunction(this.fn)}substitute(e={}){return new ExprFunction(this.fn,this.args.map(t=>t.substitute(e)))}collapse(){return"("===this.fn?this.args[0].collapse():new ExprFunction(this.fn,this.args.map(e=>e.collapse()))}get simplified(){return this}get variables(){return unique$1(flatten$2(this.args.map(e=>e.variables)))}get functions(){return unique$1([this.fn,...flatten$2(this.args.map(e=>e.functions))])}toString(){const e=this.args.map(e=>needsBrackets(e,this.fn)?"("+e.toString()+")":e.toString());return"\u2212"===this.fn?1<e.length?e.join(" \u2212 "):"\u2212"+e[0]:"sup"===this.fn?e.join("^"):"sub"===this.fn?e.join("_"):words$2("+ * \xD7 \xB7 / = < > \u2264 \u2265 \u2248").includes(this.fn)?e.join(" "+this.fn+" "):isOneOf$4(this.fn,"(","[","{")?this.fn+this.args.join(", ")+BRACKETS[this.fn]:isOneOf$4(this.fn,"!","%")?e[0]+this.fn:`${this.fn}(${e.join(", ")})`}toMathML(e={}){const t=this.args.map(t=>t.toMathML(e)),n=this.args.map((e,n)=>addMFence(e,this.fn,t[n]));if(this.fn in e){const i=t.map((e,t)=>({toString:()=>e,val:this.args[t]}));return e[this.fn](...i)}if("\u2212"===this.fn)return 1<n.length?n.join("<mo value=\"\u2212\">\u2212</mo>"):"<mo rspace=\"0\" value=\"\u2212\">\u2212</mo>"+n[0];if(isOneOf$4(this.fn,"+","=","<",">","\u2264","\u2265","\u2248")){const e=escape(this.fn);return n.join(`<mo value="${e}">${e}</mo>`)}if(isOneOf$4(this.fn,"*","\xD7","\xB7")){let e=n[0];for(let t=1;t<n.length-1;++t){const t=this.args[0]instanceof ExprNumber&&this.args[1]instanceof ExprNumber;e+=(t?`<mo value="×">×</mo>`:"")+n[1]}return e}if("//"===this.fn)return n.join(`<mo value="/">/</mo>`);if("sqrt"===this.fn)return`<msqrt>${n[0]}</msqrt>`;if(isOneOf$4(this.fn,"/","root")){const e="/"===this.fn?"mfrac":"mroot",i=this.args.map((e,n)=>addMRow(e,t[n]));return`<${e}>${i.join("")}</${e}>`}if(isOneOf$4(this.fn,"sup","sub")){const e=[addMRow(this.args[0],n[0]),addMRow(this.args[1],t[1])];return`<m${this.fn}>${e.join("")}</m${this.fn}>`}if(isOneOf$4(this.fn,"(","[","{"))return`<mfenced open="${this.fn}" close="${BRACKETS[this.fn]}">${n.join(COMMA)}</mfenced>`;if(isOneOf$4(this.fn,"!","%"))return n[0]+`<mo value="${this.fn}" lspace="0">${this.fn}</mo>`;if("abs"===this.fn)return`<mfenced open="|" close="|">${n.join(COMMA)}</mfenced>`;if("bar"===this.fn)return`<mover>${addMRow(this.args[0],n[0])}<mo value="‾">‾</mo></mover>`;if("vec"===this.fn)return`<mover>${addMRow(this.args[0],n[0])}<mo value="→">→</mo></mover>`;const s=isSpecialFunction(this.fn)?" mathvariant=\"normal\"":"";return`<mi${s}>${this.fn}</mi><mfenced>${n.join(COMMA)}</mfenced>`}}class ExprTerm extends ExprElement{constructor(e){super(),this.items=e}evaluate(e={}){return this.collapse().evaluate(e)}substitute(e={}){return this.collapse().substitute(e)}get simplified(){return this.collapse().simplified}get variables(){return unique$1(join(...this.items.map(e=>e.variables)))}get functions(){return this.collapse().functions}toString(){return this.items.map(e=>e.toString()).join(" ")}toMathML(e={}){return this.items.map(t=>t.toMathML(e)).join("")}collapse(){return collapseTerm(this.items).collapse()}}var TokenType;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SPACE=1]="SPACE",e[e.STR=2]="STR",e[e.NUM=3]="NUM",e[e.VAR=4]="VAR",e[e.OP=5]="OP"})(TokenType||(TokenType={}));const Expression={numEquals,parse:cache(parse$1)},FUNCTION_STEP=2,GRID_SPACING=80,GRID_STEPS=[5,2,1],TICK_LENGTH=4,ANIMATION=5e3;let CoordinateSystem=class extends CustomElementView{constructor(){super(...arguments),this.mathBounds=new Bounds(-5,5,0,10),this.plotOrigin=new Point$1(0,0),this.animated=this.hasAttr("animate"),this.noLabels=this.hasAttr("no-labels"),this.xLabel=this.attr("x-label"),this.yLabel=this.attr("y-label"),this.crosshairGrid=10,this.getCrosshairPosn=e=>e}ready(){const e=+this.attr("width")||600,t=+this.attr("height")||400;this.css("width",e+"px");const i=this.$("svg");i.setAttr("width",e),i.setAttr("height",t),i.setAttr("viewBox",`0 0 ${e} ${t}`),this.$grid=$N("g",{class:"grid"},i),this.$xAxis=$N("line",{class:"axis"},i),this.$yAxis=$N("line",{class:"axis"},i),this.$plot=$N("g",{class:"plot"},i),this.$labels=$N("g",{class:"labels"},i),this.$overlay=$N("g",{},i);const n=this.hasAttr("margins")?words(this.attr("margins")):[20,20,20,20];if(this.plotBounds=new Bounds(+n[3],e-+n[1],t-+n[2],+n[0]),this.xAxisOptions=this.attr("x-axis").split("|"),this.yAxisOptions=this.attr("y-axis").split("|"),this.xSuffix=this.attr("x-suffix"),this.ySuffix=this.attr("y-suffix"),this.animated=this.hasAttr("animate"),this.noLabels=this.hasAttr("no-labels"),this.xLabel=this.attr("x-label"),this.yLabel=this.attr("y-label"),this.hasAttr("fns")){const e=this.attr("fns").split("|").map(e=>Expression.parse(e,!0)).map(e=>t=>e.evaluate({x:t}));this.setFunctions(...e)}this.hasAttr("crosshair-grid")&&(this.crosshairGrid=+this.attr("crosshair-grid")),this.hasAttr("no-crosshairs")||this.setupCrosshairs(i,e)}setupCrosshairs(t,i){const n=$N("g",{class:"crosshair"},t),s=$N("path",{},n),r=$N("circle",{r:4},n),a=$N("text",{},n);let o=new Point$1(0,0);const l=n=>{const e=this.plotToMathCoords(svgPointerPosn(n,t)),l=this.getCrosshairPosn(e);if(!l.equals(o)){o=l;const e=this.mathToPlotCoords(l);r.setCenter(e),s.points=[new Point$1(this.plotOrigin.x,e.y),e,new Point$1(e.x,this.plotOrigin.y)],a.text=`(${l.x}, ${numberFormat(l.y,5)})`;const t=a.width;a.setAttr("x",e.x+8+t<i?e.x+5:e.x-t-5),a.setAttr("y",20<e.y?e.y-7:e.y+18)}};t.on("touchstart mouseover",t=>{n.show(),l(t)},{passive:!0}),t.on("touchend mouseout",()=>n.hide(),{passive:!0}),t.on("pointermove",l)}mathToPlotCoords(e){return e.changeCoordinates(this.mathBounds,this.plotBounds)}plotToMathCoords(e){return e.changeCoordinates(this.plotBounds,this.mathBounds)}setPoints(e,t=1){const i=e.map((e,n)=>new Point$1(n+t,e));this.setSeries(i)}setSeries(...e){const[t,i,n]=computeAxis(this.xAxisOptions,this.plotBounds.dx,[0,Math.max(...e.map(e=>last(e).x))]);this.mathBounds.xMin=t,this.mathBounds.xMax=i;const[s,r,a]=computeAxis(this.yAxisOptions,this.plotBounds.dy,getDataBounds(e));this.mathBounds.yMin=s,this.mathBounds.yMax=r,this.drawAxes(n,a),this.$plot.removeChildren();for(let t of e)this.drawLinePlot(t);this.getCrosshairPosn=t=>e[0].reduce((e,i)=>Math.abs(i.x-t.x)<=Math.abs(e.x-t.x)?i:e)}setFunctions(...e){const[t,i,n]=computeAxis(this.xAxisOptions,this.plotBounds.dx,[-5,5]);this.mathBounds.xMin=t,this.mathBounds.xMax=i;const s=e.map(()=>[]);for(let t=this.plotBounds.xMin,i;t<this.plotBounds.xMax;t+=FUNCTION_STEP){i=this.plotToMathCoords(new Point$1(t,0)).x;for(let t=0;t<e.length;++t)s[t].push(new Point$1(i,e[t](i)))}const[r,a,o]=computeAxis(this.yAxisOptions,this.plotBounds.dy,getDataBounds(s));this.mathBounds.yMin=r,this.mathBounds.yMax=a,this.drawAxes(n,o),this.$plot.removeChildren();for(let t of s)this.drawLinePlot(t);this.getCrosshairPosn=s=>{const r=roundTo$1(clamp$1(s.x,t,i),n/this.crosshairGrid);return new Point$1(round(r,3),e[0](r))}}drawAxes(e,t){const[i,n]=[this.mathBounds,this.plotBounds],s=getOrigin(this.mathBounds);this.plotOrigin=this.mathToPlotCoords(s),this.$xAxis.setLine({x:n.xMin,y:this.plotOrigin.y},{x:n.xMax,y:this.plotOrigin.y}),this.$yAxis.setLine({x:this.plotOrigin.x,y:n.yMin},{x:this.plotOrigin.x,y:n.yMax}),this.$grid.removeChildren(),this.$labels.removeChildren(),this.xLabel&&$N("text",{text:this.xLabel,x:this.plotBounds.xMax-2,y:this.plotOrigin.y-12,"text-anchor":"end"},this.$labels),this.yLabel&&$N("text",{text:this.yLabel,x:this.plotOrigin.x+10,y:this.plotBounds.yMax+5},this.$labels);for(let r=i.xMin+e;r<i.xMax;r+=e){if(r===s.x)continue;const e=this.mathToPlotCoords(new Point$1(r,0)).x;$N("line",{x1:e,y1:n.yMin,x2:e,y2:n.yMax},this.$grid),this.noLabels||($N("text",{text:numberFormat(r,4)+this.xSuffix,x:e,y:this.plotOrigin.y+18,"text-anchor":"middle"},this.$labels),$N("line",{class:"tick",x1:e,y1:this.plotOrigin.y,x2:e,y2:this.plotOrigin.y+TICK_LENGTH},this.$grid))}for(let r=i.yMin+t;r<i.yMax;r+=t){if(r===s.y)continue;const e=this.mathToPlotCoords(new Point$1(0,r)).y;$N("line",{x1:n.xMin,y1:e,x2:n.xMax,y2:e},this.$grid),this.noLabels||($N("text",{text:numberFormat(r,4)+this.ySuffix,x:this.plotOrigin.x-8,y:e+4,"text-anchor":"end"},this.$labels),$N("line",{class:"tick",x1:this.plotOrigin.x,y1:e,x2:this.plotOrigin.x-TICK_LENGTH,y2:e},this.$grid))}this.noLabels||(0!==i.xMin||0!==i.yMin||this.ySuffix||this.ySuffix?0===i.yMin?$N("text",{text:numberFormat(s.x,4)+this.xSuffix,x:this.plotOrigin.x,y:this.plotOrigin.y+18,"text-anchor":"middle"},this.$labels):$N("text",{text:numberFormat(s.y,4)+this.ySuffix,x:this.plotOrigin.x-8,y:this.plotOrigin.y+4,"text-anchor":"end"},this.$labels):$N("text",{text:0,x:this.plotOrigin.x-5,y:this.plotOrigin.y+15,"text-anchor":"end"},this.$labels))}drawLinePlot(e){const t=$N("g",{},this.$plot),i=$N("path",{},t),n=this.mathBounds;e=e.filter(e=>e.y>=n.yMin&&e.y<=n.yMax);const s=e.map(e=>this.mathToPlotCoords(e));this.animated?animate(t=>{const r=n.xMin+t*(n.xMax-n.xMin),a=e.findIndex(e=>e.x>r);i.points=s.slice(0,a)},ANIMATION):i.points=s}drawPoints(e){const t=$N("g",{},this.$plot),i=this.mathBounds;for(let n of e){const e=this.mathToPlotCoords(n),s=$N("circle",{r:4,cx:e.x,cy:e.y},t);if(this.animated){s.hide();const e=ANIMATION*(n.x-i.xMin)/(i.xMax-i.xMin);setTimeout(()=>s.show(),e)}}}};CoordinateSystem=__decorate([register("x-coordinate-system",{templateId:"#coordinate-system"})],CoordinateSystem);const keys=KEY_CODES,DEFAULT_ERROR="This is not a valid mathematical expression.",PLACEHOLDERS_ERROR="Fill in all empty placeholders in the expression.",FN_NAMES={"+":"addition","×":"multiplication","/":"fractions or division","−":"subtraction",sqrt:"square roots","^":"powers"};let Equation=class extends CustomElementView{constructor(){super(...arguments),this.numeric=null,this.isDone=!1,this.shortVar=!1,this.lastAttempt="",this.errorCount=0,this.hints=[],this.fns=[],this.validate=void 0}ready(){if(this.$math=this.$(".math"),this.$textarea=this.$("textarea"),this.$cursor=this.$(".cursor"),this.$error=this.$(".error-message"),this.$step=this.getModel().$step,this.solution=Expression.parse(this.attr("solution")),this.hasAttr("numeric")&&(this.numeric=+this.attr("precision")||.01),this.vars=this.hasAttr("vars")?words(this.attr("vars")):this.solution?this.solution.variables:[],this.hasAttr("fns")&&(this.fns=words(this.attr("fns"))),this.solution&&this.fns.push(...this.solution.functions),this.fns.includes("/")&&!this.fns.includes("\xD7")&&this.fns.push("\xD7"),this.hasAttr("hints")&&(this.hints=words(this.attr("hints"))),this.hasAttr("substitutions")){this.substitutions={},this.autocomplete=this.vars.slice(0);for(let e of this.attr("substitutions").split("|"))if(e.trim()){const[t,i]=e.split(":");this.autocomplete.push(t.trim()),this.substitutions[t.trim()]=Expression.parse(i)}}for(let e of["solution","precision","vars","fns","vars-required","substitutions"])this.removeAttr(e);this.shortVar=this.hasAttr("short-var");const e=words(this.attr("keys")||"+ \u2212 \xD7 \xF7 frac sup sqrt brackets"),t=this.$(".keys");for(let i of t.children)e.includes(i.data.type)?(i.on("pointerdown",t=>t.preventDefault()),i.on("pointerup",()=>{type(this.$cursor,i.data.type),this.check()})):i.remove();this.on("pointerdown",t=>this.onPointerdown(t)),this.$textarea.on("blur",()=>this.onBlur()),this.$textarea.on("key",t=>this.onKey(t))}focus(){this.trigger("pointerdown")}onPointerdown(t){if(!this.isDone){t.preventDefault&&t.preventDefault(),this.addClass("active"),this.$textarea.focus();const e=t.target?$(t.target):this;if("X-EQUATION"===e.tagName||e.hasClass("math")){const e=this.$math.children,i=total(e.map(e=>e.outerWidth))/2,n=pointerPosition(t).x<this.$math.bounds.left+i;n?this.$math.prepend(this.$cursor):this.$math.append(this.$cursor)}else if("M"===e.tagName[0]){const i=pointerPosition(t).x<e.boxCenter.x;"MROW"===e.tagName?i?e.prepend(this.$cursor):e.append(this.$cursor):i?e.insertBefore(this.$cursor):e.insertAfter(this.$cursor)}}}onKey(t){if(isOneOf(t.code,keys.enter,keys.escape))this.$textarea.blur();else if(t.code===keys.left)goLeft(this.$cursor);else if(t.code===keys.right)goRight(this.$cursor);else if(t.code===keys.up)goUp(this.$cursor);else if(t.code===keys.down)goDown(this.$cursor);else if(isOneOf(t.code,keys.backspace,keys.delete))backspace(this.$cursor),this.check();else{let e=t.key.replace("*","\xD7").replace("/","\xF7").replace("-","\u2212");type(this.$cursor,e),this.check()}}onBlur(){if(this.isDone)return;if(!this.value)return this.removeClass("active has-error");if(this.removeClass("active"),this.addClass("has-error"),this.value===this.lastAttempt)return;if(this.lastAttempt=this.value,!this.$step)return;const e=this.error||(this.hints||[]).shift()||"incorrect",t=this.$step.addHint(e,{class:"incorrect"});this.$error.html=t.text,this.errorCount+=1,this.trigger("error",{count:this.errorCount,msg:e}),5<=this.errorCount&&this.$step.addHint(`Hmmm… maybe try ${this.solution.toMathML()}?`)}check(){if(this.error=void 0,this.value=toString(this.$math,this.shortVar).trim(),!!this.value){if(this.$math.$(".empty"))return this.error=PLACEHOLDERS_ERROR;const e=parseInput$1(this.value);if(e.error)return this.error=e.error;const t=this.substitutions?e.expr.substitute(this.substitutions):e.expr;if(this.numeric&&checkNumeric(this.solution,t,this.numeric))return this.solve();if(this.solution&&Expression.numEquals(this.solution,t))return this.complete(e.expr);const i=checkVariables(t,this.vars,this.autocomplete);if(i)return this.error=i;if(this.validate){const t=this.validate(e.expr)||{};if(t.isCorrect)return this.complete(e.expr);if(t.error)return this.error=t.error}const n=checkFunctions(t,this.fns);if(n)return this.error=n}}complete(e){this.isDone||(this.isDone=!0,this.removeClass("has-error active"),this.addClass("done"),this.$textarea.blur(),!this.shortVar&&cleanGroups(this.$math,"mi"),cleanGroups(this.$math,"mn"),this.trigger("solve",{expr:e}))}solve(){this.$math.removeClass("empty"),this.$math.html=this.solution.toMathML(),this.complete(this.solution)}};Equation=__decorate([register("x-equation",{templateId:"#equation"})],Equation);class Ticker{constructor(){this.callbacks=[]}add(e){this.callbacks.push(e)}start(e=1e3){const t=animate(e=>{for(const t of this.callbacks)t(e)},e);return t.promise}}const FONT_SIZE=18,CHAR_SHIFT=4,LINE_HEIGHT=18*1.25-CHAR_SHIFT;class DisplayNode{constructor(e,t,i,n){this.type=e,this.$element=n,this.parent=null,this.children=[],this.status="",this.value="",this.width=0,this.height=0,this.baseline=0,this.transform={x:0,y:0,scale:1},this.currentDimensions=[0,0,0],this.currentWorldTransform={x:0,y:0,scale:1},this.addChildren(t),n&&i.$row.append(n)}get expr(){return""}get log(){const e=this.children.map(e=>e.log);return`<${this.type}>${e.join("")}</${this.type}>`}static create(e,t){const i=e.nodeName;if(isOneOf(i,"mn","mi","mo","mtext"))return new DisplayNodeText(i,e,t);let n=Array.from(e.children,e=>DisplayNode.create(e,t));switch(i){case"mrow":return new DisplayNodeRow(n,t);case"mfrac":return n=n.map(e=>wrapInRow(t,[e])),new DisplayNodeFraction(n,t);case"mfenced":return n=[wrapInRow(t,n)],new DisplayNodeFenced(n,t);case"msqrt":return n=[wrapInRow(t,n)],new DisplayNodeRoot(i,n,t);case"mroot":return n=n.map(e=>wrapInRow(t,[e])),new DisplayNodeRoot(i,n,t);case"msub":case"msup":case"msubsup":return n=n.map(e=>wrapInRow(t,[e])),new DisplayNodeSubSup(i,n,t);}throw new Error(`Unknown element type tag ${e.nodeName}`)}get marginLeft(){return .1}get marginRight(){return .1}setTransform(e=0,t=0,i=1){this.transform.x=e,this.transform.y=t,this.transform.scale=i}get worldTransform(){let e=this;const t=Object.assign({},this.transform);for(;e=e.parent;)applyTransform(t,e.transform);return t}get next(){if(this.parent){const e=this.parent.children.indexOf(this);return this.parent.children[e+1]}}get prev(){if(this.parent){const e=this.parent.children.indexOf(this);return this.parent.children[e-1]}}addChildren(e,t=this.children.length){for(const i of e)i.detach(),i.parent=this;this.children.splice(t,0,...e)}insertAfter(e){const t=this.parent.children.indexOf(this);this.parent.addChildren(e,t+1)}insertBefore(e){const t=this.parent.children.indexOf(this);this.parent.addChildren(e,t)}detach(){if(this.parent){const e=this.parent.children.indexOf(this);0<=e&&this.parent.children.splice(e,1)}}deleteFromDom(){this.$element&&this.$element.remove(),this.$element=void 0;for(const e of this.children)e.deleteFromDom()}hasParent(e){for(let t=this;t=t.parent;)if(t.type===e)return!0;return!1}measure(){for(const e of this.children)e.measure()}setStatus(e){this.status=e;for(const t of this.children)t.setStatus(e);this.$element&&(this.$element.removeClass("adding deleting"),e&&this.$element.addClass(e))}render(e){for(const t of this.children)t.render(e);if(!this.$element)return;const i=this.currentWorldTransform,t=this.currentWorldTransform=this.worldTransform,n=this.currentDimensions,s=this.currentDimensions=[this.width,this.height,this.baseline];return transformEquals(i,t)&&arrayEquals(n,s)&&!this.status?void 0:e?void("adding"===this.status&&this.$element.setTransform(t,0,t.scale),e.add(e=>{if(!this.$element)return;const r=isOneOf(this.status,"adding","deleting"),a=r?s[0]:lerp$1(n[0],s[0],e),o=r?s[1]:lerp$1(n[1],s[1],e),l=r?s[2]:lerp$1(n[2],s[2],e),d=r?t.scale:lerp$1(i.scale,t.scale,e);if(this.drawElement(e,a,o,l,d),!this.status){const n=lerp$1(i.x,t.x,e),s=lerp$1(i.y,t.y,e);this.$element.setTransform({x:n,y:s},0,d)}})):(this.$element.setTransform(t,0,t.scale),void this.drawElement(1,s[0],s[1],s[2],t.scale))}drawElement(e,t,i,n,s){}}const ASCENDERS="acegmnopqrsuvwxyz",DESCENDERS="gjy";class DisplayNodeText extends DisplayNode{constructor(e,t,i){const n=$N("text",{text:t.textContent});super(e,[],i,n),this.value=t.textContent||"";const s=this.value.split("").every(e=>ASCENDERS.includes(e)),r=this.value.split("").some(e=>DESCENDERS.includes(e));this.width=this.$element.width,this.height=LINE_HEIGHT-(s?3:0)+(r?3:0),this.baseline=LINE_HEIGHT-(s?3:0),this.dy=CHAR_SHIFT/2+(s?3:0),("mtext"===e||"normal"===t.getAttribute("mathvariant"))&&n.addClass("font-normal")}setTransform(e=0,t=0,i=1){this.transform.x=e,this.transform.y=t-this.dy,this.transform.scale=i}get expr(){return"mtext"===this.type?`"${this.value}"`:this.value}get log(){return`<${this.type}>${this.value}</${this.type}>`}get marginLeft(){if("mo"===this.type)return isOneOf(this.value,"=","\u2248")?.6:isOneOf(this.value,"\u2221","\u25B3","!","%","\u2019")?0:isOneOf(this.value,"\u2026","\xB0")&&this.prev&&"mn"===this.prev.type?0:.25;if("mi"===this.type){if(this.prev&&"mn"===this.prev.type)return .1;if(this.prev&&"mi"===this.prev.type)return .05;if(this.prev&&"mfrac"===this.prev.type)return .15}return 0}get marginRight(){return"mo"===this.type?isOneOf(this.value,"=","\u2248")?.6:isOneOf(this.value,"\u2221","\u25B3")?0:"\u2212"!==this.value||this.prev&&"="!==this.prev.value?.25:.1:0}drawElement(e,t,i,n,s){"adding"===this.status?this.$element.setAttr("opacity",.5>e?0:2*e-1):"deleting"===this.status&&this.$element.setAttr("opacity",.5>e?1-2*e:0),this.$element.css("stroke-width",1.5*(1-s)+"px")}}class DisplayNodeRow extends DisplayNode{constructor(e,t,i,n=0){super("mrow",e,t),this.align=i,this.dx=n}addChildren(e,t=this.children.length){const i=[];for(const n of e)"mrow"===n.type?(i.push(...n.children),n.detach()):i.push(n);DisplayNode.prototype.addChildren.call(this,i,t)}get expr(){return this.children.map(e=>e.expr).join("")}measure(){if(DisplayNode.prototype.measure.call(this),!this.children.length)return this.height=LINE_HEIGHT,this.width=0,void(this.baseline=LINE_HEIGHT);this.baseline=Math.max(...this.children.map(e=>e.baseline)),this.height=this.baseline+Math.max(...this.children.map(e=>e.height-e.baseline));let e=0;for(const[t,i]of this.children.entries())i.setTransform(e,this.baseline-i.baseline),e+=i.width,t<this.children.length-1&&(e+=Math.max(i.marginRight,this.children[t+1].marginLeft)*FONT_SIZE);if(this.align){const e=this.children.find(e=>e.expr===this.align);if(e){const t=e.$element.$ownerSVG.svgWidth;this.transform.x=t/2-e.transform.x-e.width/2+this.dx}}this.width=e}}class DisplayNodeFraction extends DisplayNode{constructor(e,t){super("mfrac",e,t,$N("line"))}get expr(){return this.children.map(e=>e.expr).join("/")}measure(){DisplayNode.prototype.measure.call(this);const e=this.hasParent("mfrac")?.75:1,[t,i]=this.children;this.width=(Math.max(t.width,i.width)+2*(.1*LINE_HEIGHT))*e,this.height=(t.height+i.height)*e+2,this.baseline=t.height*e+LINE_HEIGHT/2+1,t.setTransform((this.width-t.width*e)/2,0,e),i.setTransform((this.width-i.width*e)/2,t.height*e+2,e)}drawElement(e,t,i,n){const s=n-LINE_HEIGHT/2;this.$element.setLine({x:0,y:s},{x:t,y:s}),drawStroke(this.$element,e,this.status)}}class DisplayNodeSubSup extends DisplayNode{get expr(){let e=this.children[0].expr;return"msup"!==this.type&&(e+="_"+this.children[1].expr),"msup"===this.type&&(e+="^"+this.children[1].expr),"msubsup"===this.type&&(e+="^"+this.children[2].expr),e}measure(){DisplayNode.prototype.measure.call(this);const[e,t,i]=this.children,n="msup"===this.type?null:t,s="msubsup"===this.type?i:"msup"===this.type?t:null,r=.05*FONT_SIZE,a=.65,o=.4*LINE_HEIGHT,l=s?s.width:0,d=n?n.width:0;this.width=e.width+r+Math.max(l,d)*a,this.height=e.height,s&&(this.height+=s.height*a-o),n&&(this.height+=n.height*a-o),this.baseline=e.baseline,s&&(this.baseline+=s.height*a-o),e.setTransform(0,this.baseline-e.baseline),s&&s.setTransform(e.width+r,0,a),n&&n.setTransform(e.width+r,this.height-n.height*a,a)}}class DisplayNodeFenced extends DisplayNode{constructor(e,t){super("mfenced",e,t,$N("path"))}get expr(){return`(${this.children.map(e=>e.expr).join()})`}get marginLeft(){return .2}get marginRight(){return .2}measure(){DisplayNode.prototype.measure.call(this);const e=this.children[0];this.height=e.height+2,this.baseline=e.baseline+1;const t=3+this.height/LINE_HEIGHT,i=.06*LINE_HEIGHT;this.width=e.width+2*(t+i),e.setTransform(t+i,1)}drawElement(e,t,i){const n=3+i/LINE_HEIGHT,s=i,r=t-n;this.$element.setAttr("d",`M${n},0C${.33*n},${.15*s},0,${.32*s},0,${s/2}s${.33*n},${.35*s},${n},${s/2}`+`M${r},0C${r+.67*n},${.15*s},${r+n},${.32*s},${r+n},${s/2}S${r+.67*n},${.85*s},${r},${s}`),drawStroke(this.$element,e,this.status)}}class DisplayNodeRoot extends DisplayNode{constructor(e,t,i){super(e,t,i,$N("path"))}get expr(){return`sqrt(${this.children.map(e=>e.expr).join()})`}get marginLeft(){return .2}get marginRight(){return .2}measure(){DisplayNode.prototype.measure.call(this);const e=this.children[0];this.height=e.height+2,this.baseline=e.baseline+2;const t=Math.min(16,2+6*this.height/LINE_HEIGHT),i=.1*LINE_HEIGHT;this.width=e.width+t+2*i,e.setTransform(t+i,2)}drawElement(e,t,i){const n=Math.min(16,2+6*i/LINE_HEIGHT),s=i;this.$element.setAttr("d",`M0,${.55*s}L${.18*n},${.51*s}L${.45*n},${s}L${n},2L${t},2`),drawStroke(this.$element,e,this.status)}}class DisplayEquation extends EventTarget{constructor(e,t,i=0){super(),this.$row=t,this.isReady=!0,this.deletedNodes=new Set,this.root=new DisplayNodeRow([],this,"=",i),this.root.addChildren(this.parse(e)),this.root.measure(),this.root.render()}parse(e){const t=new DOMParser,i=Expression.parse(e).toMathML(),n=t.parseFromString(`<math>${i}</math>`,"text/xml");let s=n.firstChild.childNodes;return Array.from(s,e=>DisplayNode.create(e,this))}find(e){let[t,n]=e.split("`");t=t.replace(/[–-]/g,"\u2212");const i=this.root.children.slice(0);for(let s=0;i.length;){const e=i.shift(),r=e instanceof DisplayNodeRow?null:matchNodes(e,t);if(r&&(s+=1,s===(+n||1)))return r;i.unshift(...e.children)}throw new Error(`Can't find element ${t}.`)}animate(){return __awaiter(this,void 0,void 0,function*(){this.isReady=!1,this.root.measure();const e=new Ticker;this.root.render(e),this.trigger("resize",{height:this.root.height});for(const t of this.deletedNodes)t.render(e);yield e.start(1200);for(const e of this.deletedNodes)e.deleteFromDom();this.root.setStatus(""),this.deletedNodes.clear(),this.isReady=!0})}addTermAfter(e,t){const i=last(t?this.find(t):this.root.children),n=this.parse(e);i.insertAfter(n);for(const i of n)i.setStatus("adding")}addTermBefore(e,t){const i=t?this.find(t)[0]:this.root.children[0],n=this.parse(e);i.insertBefore(n);for(const i of n)i.setStatus("adding");return n}deleteTerm(e){for(const t of this.find(e))t.setStatus("deleting"),t.detach(),this.deletedNodes.add(t)}replaceTerm(e,t){const i=this.find(e),n=this.parse(t);i[0].insertBefore(n);for(const i of n)i.setStatus("adding");for(const n of i)n.setStatus("deleting"),n.detach(),this.deletedNodes.add(n)}moveTermAfter(e,t){const i=this.find(e),n=last(t?this.find(t):this.root.children);return n.insertAfter(i),i}moveTermBefore(e,t){const i=this.find(e),n=t?this.find(t)[0]:this.root.children[0];return n.insertBefore(i),i}wrapTerms(e,...t){const n=t.map(e=>this.find(e)),s=this.parse(e);for(const i of s)i.setStatus("adding");n[0][0].insertBefore(s);for(const[s,i]of n.entries()){const e=this.find("$"+(s+1))[0];e.insertAfter(i),e.detach(),e.deleteFromDom()}}unwrapTerm(e,t=1){const i=this.find(e);let n=i[0],s=1;for(;s<=t;)n=n.parent,n instanceof DisplayNodeRow&&(n=n.parent),s+=1;n.insertAfter(i),n.setStatus("deleting"),n.detach(),this.deletedNodes.add(n)}get leftSide(){const e=this.root.children.findIndex(e=>"="===e.expr);return this.root.children.slice(0,e-1)}get rightSide(){const e=this.root.children.findIndex(e=>"="===e.expr);return this.root.children.slice(e+1)}}let EquationFlow=class extends CustomElementView{constructor(){super(...arguments),this.isReady=!0,this.topOffset=4,this.currentHeight=0}ready(){this.$svg=this.$("svg"),this.$lastRow=this.$svg.$("g");const e=+this.attr("dx")||0;this.equation=new DisplayEquation(this.attr("expr"),this.$lastRow,e),this.currentHeight=this.topOffset+this.$lastRow.height+16,this.$svg.css("height",this.currentHeight+"px"),this.equation.on("resize",({height:e})=>{const t=this.topOffset+e+16;10>Math.abs(t-this.currentHeight)||(this.currentHeight=t,this.$svg.animate({height:t+"px"},1200))});let t=0;const i=this.attr("max-steps")||1/0,n=this.$(".next-step");n.on("click",()=>{this.isReady&&this.equation.isReady&&(t+=1,this.trigger(`step-${t}`,{equation:this.equation,system:this}),t>=i&&n.exit("pop"))})}newRow(){return __awaiter(this,void 0,void 0,function*(){this.isReady=!1;const e=this.$lastRow.copy(!0,!1);this.$lastRow.insertBefore(e),this.topOffset+=e.height+16,this.$lastRow.animate({transform:`translateY(${this.topOffset}px)`}),this.currentHeight=this.topOffset+e.height+16,yield this.$svg.animate({height:this.currentHeight+"px"}).promise,this.isReady=!0})}};EquationFlow=__decorate([register("x-equation-flow",{templateId:"#equation-flow"})],EquationFlow);const KEYFRAMES={opacity:[0,1],transform:["translateX(-50px)","none"]},REPEAT_ERROR={error:"You\u2019ve already had this expression before. Try simplifying it."},SOLUTION="You have to fully simplify this expression. The correct solution is $0.";let EquationSystem=class extends CustomElementView{constructor(){super(...arguments),this.rowCount=1,this.previousAnswers=[],this.isSolved=!1,this.maxRows=6,this.steps=[],this.hints=[]}created(){this.$table=this.$("table tbody"),this.lastRowContent=this.$table.$("tr:last-child").html}ready(){this.hasAttr("max-rows")&&(this.maxRows=+this.attr("max-rows")),this.hasAttr("steps")&&(this.steps=this.attr("steps").split("|")),this.hasAttr("hints")&&(this.hints=this.attr("hints").split("|")),this.removeAttr("steps"),this.removeAttr("hints"),this.setupEquation(this.$("x-equation"))}setupEquation(e){this.$equation=e,e.one("solve",t=>this.onSolveRow(t.expr)),e.hints=this.hints,e.validate=e=>this.previousAnswers.includes(e.toString())?REPEAT_ERROR:this.validate?this.validate(e):{}}onSolveRow(e){if(this.trigger("solve-row",{expr:e,$math:this.$equation.$math}),this.isFinal&&this.isFinal(e))return this.trigger("solve");if(!this.isSolved){if(this.rowCount+=1,this.previousAnswers.push(e.toString()),this.rowCount>this.maxRows){const e=this.$equation.solution.toMathML();this.trigger("hint",SOLUTION.replace("$0",e)),this.trigger("solve")}const t=$N("tr",{html:this.lastRowContent},this.$table);t.animate(KEYFRAMES,400,500),this.setupEquation(t.$("x-equation")),setTimeout(()=>this.$equation.focus(),1200)}}solve(){if(this.isSolved=!0,this.steps.length){const e=this.$table.$("tr:last-child"),t=this.lastRowContent.replace(/<x-equation.*<\/x-equation>/,"<div class=\"math\"></div>");for(let i of this.steps){const n=$N("tr",{html:t},this.$table),s=n.$(".math"),r=Expression.parse(i);s.html=r.toMathML(),e.insertBefore(n),this.trigger("solve-row",{expr:r,$math:s})}}this.$equation.solve()}};EquationSystem=__decorate([register("x-equation-system")],EquationSystem);let Gallery=class extends CustomElementView{ready(){function e(){C=Date.now()-S,v(A+_*ease(b,C/w))}function t(){!k&&C<w&&requestAnimationFrame(t),e()}function i(e){k=!1,C=0,A=y,_=-e*f-y,S=Date.now(),$(e),t()}function n(){b="quad",x<h-m&&i(x+1)}function s(){b="quad",0<x&&i(x-1)}const r=this.$(".wrapper"),a=this.$(".panel"),o=a.children,l=this.$(".next"),d=this.$(".back"),p=this.$(".dots"),c=o.map(()=>$N("div",{class:"dot"},p));let h=o.length,g=+this.attr("slide-width")||null,u=this.width,m=1,f=u,x=0,y=0;const v=e=>{y=e,a.translate(e,0),this.trigger("move",e)},$=e=>{x=e;for(const[t,i]of c.entries())i.setClass("on",t>=e&&t<e+m);l.setClass("disabled",e===h-m),d.setClass("disabled",0===e),this.trigger("change",e)};Browser.onResize(()=>{u=this.width,m=g?Math.ceil(u/g):1,f=u/m;for(const e of o)e.css("width",f+"px");a.css("width",h*f+"px"),v(-x*f),$(x)});let b="quad",w=500,k=!1,C,A,_,S;l.on("click",n),d.on("click",s);let T,P,M,I;slide(r,{start:e=>{k=!0,T=y,P=e.x,I=M=P},move:e=>{M=I,I=e.x;let t=T-P+e.x,i=-(h-m)*f,n=0<t?t/4:t<i?i+(t-i)/4:t;v(n),this.css("pointer-events","none")},end:()=>{let e=I-M,t=12<e?1:-12>e?-1:0;b="quad-out",i(clamp$1(Math.round(-y/f-t),0,h-m)),setTimeout(()=>this.css("pointer-events","auto"))}})}};Gallery=__decorate([register("x-gallery",{templateId:"#gallery"})],Gallery);let Gameplay=class extends CustomElementView{constructor(){super(...arguments),this.slideGenerator=()=>{},this.currentAnimation=null,this.history=[],this.$currentSlide=null,this.playing=!1,this.completed=!1}ready(){this.addClass("paused");const e=this.$(".slide-template");this.slideTemplate=e.html,e.remove(),this.time=+this.attr("time")||8e3,this.goal=(this.attr("goal")||"6/8").split("/").map(e=>+e),this.$progress=this.$(".progress"),this.$dots=this.$(".dots"),this.$dots.css("margin-left",-8*this.goal[1]+"px");for(let e=0;e<this.goal[1];++e)$N("div",{class:"dot"},this.$dots);this.$(".toggle").on("click",()=>{this[this.playing?"pause":"play"]()})}score(e){if(this.$dots.children[this.history.length].addClass(e?"green":"red"),this.history.push(e),!this.completed&&total(this.history)>=this.goal[0])return this.completed=!0,this.$("x-solved").enter(),this.trigger("score"),this.pause(),!0}makeSlide(){function e(t){i.trigger("error",t),s(0)}if(!this.playing)return;if(this.history.length>=this.goal[1]){this.history.shift(),this.$dots.animate({transform:["none","translateX(-16px)"]},300).promise.then(()=>this.$dots.css("transform","none"));let e=this.$dots.children[0];e.exit("fade",300).promise.then(()=>e.remove());let t=$N("div",{class:"dot"},this.$dots);t.enter("fade",300)}if(this.$currentSlide){let e=this.$currentSlide;e.animate({transform:["none","translateX(-100%)"]},400).promise.then(()=>{e.remove()})}let i=$N("div",{class:"slide",html:this.slideTemplate},this);i.animate({transform:["translateX(100%)","none"]},400);let n=this.time*(1-total(this.history)/this.goal[1]/2),t=this.$progress.animate({width:["100%","0%"]},n,400,"linear");const s=e=>{i.addClass("done");let n=this.score(e);t.cancel(),n||setTimeout(()=>this.makeSlide(),1e3)};t.promise.then(e),this.$currentSlide=i,this.currentAnimation=t,this.slideGenerator(i,function(t){i.trigger("success",t),s(1)},e)}setFirstSlide(e){this.$currentSlide=$N("div",{class:"slide",html:this.slideTemplate},this),e(this.$currentSlide)}play(){this.playing||(this.playing=!0,this.removeClass("paused"),this.makeSlide(),this.$("x-solved").hide())}pause(){this.playing&&(this.playing=!1,this.currentAnimation&&this.currentAnimation.cancel(),this.addClass("paused"))}};Gameplay=__decorate([register("x-gameplay",{templateId:"#gameplay"})],Gameplay);class GeoElement{constructor(e,t,i,n){this.$geopad=e,this.removed=!1,this.x=t,this.name=n||e.model.name(),this.$el=i||this.makeEl(),e.elements.set(this.name,this),this.$el.hasAttr("label")&&this.setLabel(this.$el.attr("label")),this.val=t(e.model),this.val&&e.model.set(this.name,this.val),e.model.watch(e=>{if(!this.removed&&(this.val=this.x(e),this.$el.setClass("hidden",!this.val),(this.val||this.name in e)&&(e[this.name]=this.val),!!this.val)){const t=this.val.transform(this.$geopad.gridTransform);this.update(t),this.$label&&this.updateLabel(e,t)}})}setLabel(e,t,i){this.$label||(this.$label=makeLabel(this.$el,this.$geopad,t)),this.labelStr=parse(e),i&&(this.labelPosition=parse(i,!1))}updateLabel(e,t){if(this.$label.text=this.labelStr(e)||"",this.labelPosition)this.$label.setTransform(this.labelPosition(e).shift(0,5));else{const[e,i]=labelPosn(t,this.$el,this.$geopad);this.$label.setTransform(e,i)}}remove(e=400){this.$label&&this.$label.exit(),this.exit(e).promise.then(()=>{this.$geopad.elements.delete(this.name),this.removed=!0})}}class GeoPath extends GeoElement{constructor(){super(...arguments),this.points=[]}update(e){try{this.$el.draw(e,{box:this.$geopad.box})}catch(t){this.$el.setAttr("d","")}}makeEl(){return $N("path",{},this.$geopad.$paths)}exit(e=400){return this.$el.exit("draw",e)}}class GeoPoint extends GeoElement{makeEl(){const e=this.$geopad.noPoints?void 0:this.$geopad.$points;return $N("circle",{r:4},e)}exit(e){return this.$el.exit("pop",e)}update(e){this.$el.setCenter(e),this.$halo&&this.$halo.setCenter(e)}addHalo(){this.$halo=$N("circle",{class:"halo",r:18},this.$geopad.$pulses),this.$halo.setCenter(this.$el.center),this.$halo.enter("pop")}removeHalo(){return __awaiter(this,void 0,void 0,function*(){this.$halo&&(yield this.$halo.exit("pop").promise,this.$halo.remove(),this.$halo=void 0)})}}class GeoMovablePoint extends GeoPoint{constructor(e,t,i,n,s){let r=!0;const a=e=>{const i=r?t:e[this.name];return s?s(e).project(i):i};super(e,a,i,n),r=!1,this.$el.hasClass("pulsate")&&this.pulsate(),this.projection=s,this.locked=!1}project(e){this.projection=e,this.$geopad.model.update()}pulsate(){this.$pulse=$N("circle",{class:"pulse",r:8},this.$geopad.$pulses),this.$pulse.setCenter(this.$el.center),this.$el.one("mouseover pointerdown",()=>this.$pulse.remove())}lock(){this.$el.removeClass("move"),this.$el.setAttr("r",4),this.locked=!0}makeEl(){return $N("circle",{class:"move",r:8},this.$geopad.$points)}}class GeoTool{constructor(e){this.$geopad=e}start(e,t){}move(e,t){}end(e,t){}click(e,t){}cancel(){}addMovablePoint(e){const t=new GeoMovablePoint(this.$geopad,e);return this.$geopad.trigger("add:point",t),t}}class MoveTool extends GeoTool{start(e){e&&e instanceof GeoMovablePoint&&!e.locked&&(this.startPoint=e)}move(e,t){this.startPoint&&!this.startPoint.val.equals(t)&&this.$geopad.model.set(this.startPoint.name,t)}end(){this.startPoint=void 0,this.$geopad.trigger("moveEnd",this.startPoint)}}class PointTool extends MoveTool{click(e,t){e||this.addMovablePoint(t)}}class DrawTool extends GeoTool{constructor(){super(...arguments),this.clicked=!1}start(e,t){if(!this.pending){this.startPoint=e||this.addMovablePoint(t),this.endPosn=this.startPoint.val;this.pending=new GeoPath(this.$geopad,()=>this.path(this.startPoint.val,this.endPosn)),this.pending.$el.addClass("thin"),this.$geopad.trigger("begin:path",this.pending)}}move(e,t){this.pending&&(this.endPosn=e?e.val:t,this.$geopad.model.update())}end(e,t){if(!this.pending)return;if(e===this.startPoint)return this.cancel();const i=this.pending;i.points=[this.startPoint,e||this.addMovablePoint(t)],i.$el.removeClass("thin"),i.x=()=>this.path(i.points[0].val,i.points[1].val),this.$geopad.model.update(),this.$geopad.trigger("add:path",i),this.startPoint=this.endPosn=this.pending=void 0,this.clicked=!1}click(e,t){return this.pending?this.clicked?void this.end(e,t):this.clicked=!0:void 0}hover(e,t){this.pending&&this.move(e,t)}cancel(){this.pending&&this.pending.remove(),this.startPoint=this.endPosn=this.pending=void 0,this.clicked=!1}}class LineTool extends DrawTool{path(e,t){return new Segment(e,t)}}class CircleTool extends DrawTool{path(e,t){const i=Point$1.distance(e,t);return new Circle(e,i)}}class RectangleTool extends DrawTool{path(e,t){return new Rectangle(e,t.x-e.x,t.y-e.y)}}class PerpBisectorTool extends DrawTool{path(e,t){return new Segment(e,t).perpendicularBisector}}class AngleBisectorTool extends GeoTool{click(e,t){if(e||(e=this.addMovablePoint(t)),!this.startPoint)this.startPoint=e,e.addHalo();else if(!this.secondPoint){this.secondPoint=e,e.addHalo(),this.endPosn=e.val;this.pending=new GeoPath(this.$geopad,()=>new Angle(this.startPoint.val,this.secondPoint.val,this.endPosn).bisector),this.$geopad.trigger("begin:path",this.pending)}else this.pending.$el.removeClass("thin"),this.pending.x=()=>new Angle(this.startPoint.val,this.secondPoint.val,e.val).bisector,this.$geopad.model.update(),this.$geopad.trigger("add:path",this.pending),this.startPoint.removeHalo(),this.secondPoint.removeHalo(),this.startPoint=this.secondPoint=this.endPosn=this.pending=void 0}hover(e,t){this.pending&&(this.endPosn=e?e.val:t,this.$geopad.model.update())}cancel(){this.startPoint&&this.startPoint.removeHalo(),this.secondPoint&&this.secondPoint.removeHalo(),this.pending&&this.pending.remove(),this.startPoint=this.endPosn=this.pending=void 0}}const COMPASS="M100,50h0l-5.2-4.9L52.6,10.2v-9C52.6.6,51.4,0,50,0s-2.6.6-2.6,1.2v9L5.2,45.1,0,50H0l6.6-3L35,25.9H65L93.4,47ZM38.4,23.5,50,14.8l11.6,8.7Z",RULER="M0,0V8H100V0ZM7,6A2,2,0,1,1,9,4,2,2,0,0,1,7,6Z",MODEL_FUNCTIONS={pi:Math.PI,point:(e,t)=>new Point$1(e,t),angle:(e,t,i)=>new Angle(e,t,i),line:(e,t)=>new Line$1(e,t),ray:(e,t)=>new Ray(e,t),segment:(e,t)=>new Segment(e,t),circle:(e,t)=>new Circle(e,t),arc:(e,t,i)=>new Arc(e,t,i),sector:(e,t,i)=>new Sector(e,t,i),polygon:(...e)=>new Polygon(...e),polyline:(...e)=>new Polyline(...e),triangle:(e,t,i)=>new Triangle(e,t,i),rectangle:(e,t,i)=>new Rectangle(e,t,i),distance:Point$1.distance,round:(e,t=0)=>round(e,t),sqrt:e=>Math.sqrt(e),intersections:intersections$1};let Geopad=class extends CustomElementView{constructor(){super(...arguments),this.elements=new Map,this.grid=!1,this.gridTransform=[[1,0,0],[0,1,0]],this.gridTransformInverse=[[1,0,0],[0,1,0]]}ready(){const e=+this.attr("width")||this.width,t=+this.attr("height")||+this.attr("width")||this.height;this.box=new Rectangle(new Point$1(0,0),e,t),this.css({width:e+"px",height:t+"px"}),this.hasClass("sticky")&&this.css("top",`calc(50vh - ${t/2}px)`),this.$svg=this.children.filter(e=>"SVG"===e.tagName)[0],this.model=this.getModel(),this.model.assign(MODEL_FUNCTIONS),this.findIntersections=this.hasAttr("intersect"),this.noPoints=this.hasAttr("no-points"),this.model.watch(()=>this.cachedIntersections=void 0);const n=+this.attr("grid");if(n){this.grid=!0,this.gridTransformInverse=[[1/n,0,-.5],[0,1/n,-.5]],this.gridTransform=[[n,0,n/2],[0,n,n/2]];const s=$N("g",{class:"grid"},this.$svg);for(let r=n/2;r<e;r+=n)$N("line",{x1:r,x2:r,y1:0,y2:t},s);for(let r=n/2;r<t;r+=n)$N("line",{x1:0,x2:e,y1:r,y2:r},s)}this.$paths=$N("g",{class:"paths"},this.$svg),this.$pulses=$N("g",{class:"pulses"},this.$svg),this.$points=$N("g",{class:"points"},this.$svg),this.$labels=$N("g",{class:"labels"},this.$svg);const s=this.$svg.$$("path[x], circle");for(const e of s){const t=e.hasAttr("x")?parse(e.attr("x"),!1):null,i=e.attr("name")||this.model.name();if("PATH"===e.tagName)this.$paths.append(e),new GeoPath(this,t,e,i);else if(this.$points.append(e),e.hasClass("move")){e.setAttr("r",8);const t=e.hasAttr("project")?parse(e.attr("project"),!1):void 0;new GeoMovablePoint(this,e.center,e,i,t)}else t&&(e.setAttr("r",4),new GeoPoint(this,t,e,i))}const r={move:new MoveTool(this),point:new PointTool(this),line:new LineTool(this),circle:new CircleTool(this),perpBisector:new PerpBisectorTool(this),angleBisector:new AngleBisectorTool(this),rectangle:new RectangleTool(this)};this.$tools=this.$(".tools");let a=r[this.$tools.$active.data.tool];this.$tools.on("change",e=>a=r[e.data.tool]);const o=i=>i.clamp(5,e-5,5,t-5).transform(this.gridTransformInverse).round();slide(this.$svg,{start:e=>a.start(this.vertexAt(e),o(e)),move:e=>a.move(this.vertexAt(e),o(e)),end:(e,t)=>{const i=10>Point$1.distance(e,t)?"click":"end";a[i](this.vertexAt(e),o(e))}}),this.$svg.on("mousemove",t=>{if(a instanceof DrawTool||a instanceof AngleBisectorTool){const e=svgPointerPosn(t,this.$svg);a.hover(this.vertexAt(e),o(e))}}),Browser.onKey("escape",()=>a.cancel())}lock(){this.$svg.css("pointer-events","none")}unlock(){this.$svg.css("pointer-events","all")}get points(){if(this.noPoints)return[];const e=Array.from(this.elements.values());return e.filter(t=>t instanceof GeoPoint&&t.val&&!t.removed)}get paths(){const e=Array.from(this.elements.values());return e.filter(t=>t instanceof GeoPath&&t.val&&!t.removed)}get intersections(){if(!this.findIntersections)return[];if(this.cachedIntersections)return this.cachedIntersections;const e=this.paths,t=[];for(let n of e)for(let s of e){if(n===s)continue;const e=intersections$1(n.val,s.val);for(let r=0;r<e.length;++r){const i=()=>intersections$1(n.val,s.val)[r];t.push({val:e[r],x:i})}}return this.cachedIntersections=t,t}vertexAt(e){let t=null,i=1/0,n=this.grid?this.gridTransform[0][0]/2:20;const s=this.points,r=s.filter(e=>e instanceof GeoMovablePoint),a=s.filter(e=>!(e instanceof GeoMovablePoint));for(let s of[...r,...a,...this.intersections]){const r=Point$1.distance(e,s.val.transform(this.gridTransform));r<n&&r<i-1&&(i=r,t=s)}return t instanceof GeoPoint?t:t?this.drawPoint(t.x,{animated:0}):void 0}setActiveTool(e){this.$tools.makeActive(this.$(`.tool[data-tool="${e}"]`))}drawPath(e,{classes:t,animated:i,target:n,name:s}={}){const r=$N("path",{class:t,target:n},this.$paths);"string"==typeof e&&(e=parse(e,!1));const a=new GeoPath(this,e,r,s);return i&&r.enter(r.hasClass("fill")?"fade":"draw",i),a}drawPoint(e,{classes:t,animated:s=1,target:i,name:n}={}){const r=$N("circle",{r:4,class:t,target:i},this.$points);"string"==typeof e&&(e=parse(e,!1));const a=new GeoPoint(this,e,r,n);return s&&r.enter("pop"),a}drawMovablePoint(e,{classes:t,animated:s=1,target:i,name:n}={}){const r=$N("circle",{r:4,class:t,target:i},this.$points),a=new GeoMovablePoint(this,e,r,n);return s&&r.enter("pop"),a}animatePoint(e,t,i=400){const n=new Line$1(this.model[e],t);animate(t=>this.model.set(e,n.at(t)),i)}animateConstruction(e,t=2e3){return __awaiter(this,void 0,void 0,function*(){let i=this.elements.get(e),n=i.val;if(n instanceof Circle&&(n=n.arc),n instanceof Line$1){this.$ruler||(this.$ruler=$N("path",{d:RULER,class:"sketch"},this.$svg));const e=getToolTransform(n.at(-.1),12,n.angle-.3,1.2*n.length),s=getToolTransform(n.at(-.1),12,n.angle,1.2*n.length);this.$ruler.show(),i.$el.hide(),yield this.$ruler.animate({opacity:[0,1],transform:[e,s]},500).promise,yield i.$el.enter("draw",t).promise,yield this.$ruler.animate({opacity:[1,0],transform:[s,e]},500).promise}else if(n instanceof Arc){this.$compass||(this.$compass=$N("path",{d:COMPASS,class:"sketch"},this.$svg));const e=getToolTransform(n.c,50,n.startAngle,1.5*n.radius),s=getToolTransform(n.c,50,n.startAngle,n.radius),r=getToolTransform(n.c,50,n.startAngle+n.angle,n.radius),a=getToolTransform(n.c,50,n.startAngle+n.angle,1.5*n.radius);this.$compass.show(),i.$el.hide(),yield this.$compass.animate({opacity:[0,1],transform:[e,s]},500).promise,i.$el.enter("draw",t),yield this.$compass.animate({transform:[s,r]},t,0,"linear").promise,yield this.$compass.animate({opacity:[1,0],transform:[r,a]},500).promise}})}showGesture(e,t){this.$gesture||(this.$gesture=$N("x-gesture",{},this)),this.$gesture.stop();const i=parse(e,!1)(this.model);if(this.$gesture.from=i,t){const e=parse(t,!1)(this.model);this.$gesture.start(e.subtract(i))}else this.$gesture.start();this.one("click mouseover pointerdown",()=>this.$gesture.stop())}waitForPath(e){const t=defer(),i=()=>{for(let n of this.paths)if(e(n))return t.resolve(n),void this.off("add:path moveEnd",i)};return this.on("add:path moveEnd",i),t.promise}waitForPaths(e,{onCorrect:t,onIncorrect:n,onHint:s,onComplete:r,maxErrors:a=4}={}){const o=e.map(e=>"string"==typeof e?parse(e,!1):()=>e),l=repeat(!1,e.length);let d=0,p=!1;this.on("add:path",e=>{if(!p){const c=o.findIndex(t=>t(this.model).equals(e.val));if(0<=c)return l[c]?e.remove(0):(l[c]=!0,t&&t(e,c),d=0,void(l.every(e=>e)&&(p=!0,r&&r(!1))));if(e.remove(),!(1>e.val.length))if(d+=1,d>=a){const e=l.findIndex(e=>!e),t=this.drawPath(o[e],{animated:1e3});l[e]=!0,s&&s(t,e),d=0,l.every(e=>e)&&(p=!0,r&&r(!0))}else n&&n(e)}})}};Geopad=__decorate([register("x-geopad",{templateId:"#geopad"})],Geopad);const glossary=JSON.parse($("#glossary").text),bios=JSON.parse($("#bios").text),WIDTH_SMALL=600;let activeGloss=null;Browser.onResize(()=>{activeGloss&&activeGloss.hide()});let Gloss=class extends CustomElementView{ready(){this.xid=this.attr("xid"),this.$target=this.$(".target"),this.$popup=this.$(".popup"),this.$popup.html=this.body()||"",this.setClass("left",Browser.width>WIDTH_SMALL&&this.$target.bounds.left+this.$popup.width>Browser.width-15),hover(this,{enter:()=>this.show(),exit:()=>this.hide(),delay:100,exitDelay:200,$clickTarget:this.$target,preventMouseover:()=>Browser.width<=WIDTH_SMALL})}show(){if(activeGloss=this,this.addClass("on"),Browser.width<=WIDTH_SMALL){const e=$("#glossary-modal");return e.$(".modal-body").html=this.body(),e.open()}const e=this.$target.bounds,t=this.$popup.width,i=this.$popup.height,n=e.top+e.height+i<Browser.height-10,s=e.top-i>(window.isWebView?10:54);this.setClass("top",s&&!n),this.setClass("left",e.left+t>Browser.width-15)}hide(){activeGloss=null,this.removeClass("on")}body(){const e=glossary[this.xid];if(!e)return console.warn("missing gloss:",this.xid);let t=e.text;if(e.image&&(t+=`<img class="gloss-img" src="/resources/shared/glossary/${e.image}"/>`),e.link&&!window.isWebView){const i=location.pathname===e.link.split("#")[0];i||(t+=`<p><a href="${e.link}" target="_blank">Learn more…</a></p>`)}return t}};Gloss=__decorate([register("x-gloss",{templateId:"#gloss"})],Gloss);let Bio=class extends Gloss{body(){const e=bios[this.xid];if(!e)return console.warn("missing bio:",this.xid);const t=`<img class="bio-img" src="/resources/shared/bios/${this.xid}.jpg"/>`;return t+e.bio}};Bio=__decorate([register("x-bio",{templateId:"#gloss"})],Bio);let isOpen=!1,transform={x:0,y:0,s:1},$activeImg=null;const $lightbox=$N("div",{class:"lightbox-overlay"},$body),$lightboxImg=$N("div",{class:"lightbox-img"},$lightbox);$lightbox.on("click touchmove",closeLightbox),Browser.onKey("escape",closeLightbox),$lightbox.on("scrollwheel touchmove",t=>{t.preventDefault(),t.stopPropagation()}),Browser.onKey("space up down left right pagedown pageup",t=>{isOpen&&(t.preventDefault(),t.stopPropagation())});let Media=class extends CustomElementView{ready(){const e=this.attr("src"),t=this.$(".wrap"),i=this.attr("width"),n=this.attr("height");this.css("width",i+"px"),t.css("padding-bottom",100*(+n/+i)+"%");const s=t.$("img");s.setAttr("src",e),e.endsWith(".gif")&&s.on("click",()=>s.setAttr("src",e));const r=t.$(".credit"),a=this.attr("credit");a?r.text=a:r.remove();const o=t.$(".zoom");if(this.hasAttr("lightbox")){this.addClass("interactive");const t=e.replace(/\.(?=[^.]*$)/,"-large.");this.on("click",()=>openLightbox(this,e,t))}else o.remove()}};Media=__decorate([register("x-media",{templateId:"#media"})],Media);let Picker=class extends CustomElementView{constructor(){super(...arguments),this.correctCount=0,this.solvedCount=0,this.isSolved=!1}ready(){this.$items=this.children,this.itemsClicked=this.$items.map(()=>!1),this.$items.forEach((e,t)=>{const i=e.data.error,n=i?"incorrect":"correct";i||(this.correctCount+=1),e.one("click",()=>{this.itemsClicked[t]||this.isSolved||(this.trigger("hint",{msg:i||"correct",class:n}),e.addClass(n),!i&&(this.solvedCount+=1,this.trigger("score","picker-"+t),this.checkSolved()))})})}restore(e){const t=e.map(e=>+e.slice(7));for(let n of t)this.itemsClicked[n]=!0,this.$items[n].addClass("correct");this.solvedCount=t.length,this.checkSolved()}checkSolved(){this.solvedCount<this.correctCount||(this.addClass("solved"),this.isSolved=!0)}};Picker=__decorate([register("x-picker")],Picker);let PlayBtn=class extends CustomElementView{constructor(){super(...arguments),this.visible=!0}ready(){this.on("click",()=>{this.play(),setTimeout(()=>this.trigger("play"),400)})}play(){this.visible&&(this.visible=!1,this.exit("pop",400))}reset(){this.visible||(this.visible=!0,setTimeout(()=>this.enter("pop"),400))}};PlayBtn=__decorate([register("x-play-toggle",{templateId:"#play-toggle"})],PlayBtn);let PlayToggle=class extends CustomElementView{constructor(){super(...arguments),this.playing=!1}ready(){this.$icon=this.$("x-icon-btn"),this.$("button").on("click",()=>this.toggle())}toggle(){this.playing?this.pause():this.play()}play(){this.playing||(this.playing=!0,this.$icon.setAttr("icon","pause"),this.trigger("play"))}pause(){this.playing&&(this.playing=!1,this.$icon.setAttr("icon","play"),this.trigger("pause"))}};PlayToggle=__decorate([register("x-play-btn",{templateId:"#play-btn"})],PlayToggle);let ScaleBox=class extends CustomElementView{ready(){const e=this.children[0],t=+this.attr("width")||760;e.css("width",t+"px");const i=e.height;Browser.onResize(()=>{const n=this.width/t;this.css("height",i*n+"px"),e.css("transform",`scale(${n})`)})}};ScaleBox=__decorate([register("x-scale-box",{template:"<div><slot></slot></div>"})],ScaleBox);let Slider=class extends CustomElementView{constructor(){super(...arguments),this.current=0,this.playing=!1}ready(){this.steps=+this.attr("steps"),this.speed=+this.attr("speed")||1;const e=this.$(".bar"),t=this.$(".knob");this.drag=new Draggable(t,e,{moveY:!1}),this.drag.on("start",()=>this.playing=!1),this.drag.on("move",t=>{const e=Math.round(t.x/this.drag.width*this.steps);e===this.current||(this.current=e,this.trigger("move",e))}),this.drag.on("end",()=>this.trigger("slide-end"));const i=this.$(".play");this.hasAttr("no-play")?i.remove():i.on("click",()=>this.play()),this.on("attr:steps",t=>this.steps=+t.newAttr)}play(){if(this.playing)return;this.playing=!0,this.current>=this.steps&&this.set(0);const e=()=>{const t=this.drag.position.x;this.playing&&t<this.drag.width?window.requestAnimationFrame(e):this.playing&&(this.playing=!1,this.trigger("slide-end"));const i=Math.min(this.drag.width,t+2*this.speed);this.drag.setPosition(i,0)};e()}set(e){this.drag.setPosition(e*this.drag.width/this.steps,0)}moveTo(e,i=300){return __awaiter(this,void 0,void 0,function*(){if(e===this.current)return;const t=this.current;yield animate(i=>this.set(t+(e-t)*i),i).promise,this.trigger("slide-end")})}};Slider=__decorate([register("x-slider",{attributes:["steps"],templateId:"#slider"})],Slider);let Slideshow=class extends CustomElementView{constructor(){super(...arguments),this.length=0,this.current=0,this.locked=!1}ready(){this.$legend=this.$(".legend-box"),this.$steps=this.$legend.children,this.$back=this.$(".back"),this.$next=this.$(".next");const e=this.$(".dots");this.$dots=this.$steps.map(()=>$N("div",{class:"dot"},e)),this.length=this.$steps.length,this.current=0,this.$back.on("click",()=>this.goBack()),this.$next.on("click",()=>this.goNext()),this.$steps[0].show(),this.$dots[0].addClass("on")}go(e){if(!(this.locked||0>e||e>this.length-1||e===this.current)){this.locked=!0,setTimeout(()=>this.locked=!1,600),this.$back.setClass("disabled",0===e),this.$next.setClass("disabled",e===this.length-1),this.$dots[this.current].removeClass("on"),this.$dots[e].addClass("on"),this.$steps[e].show();const t=this.$steps[e].height+"px";this.$steps[e].hide(),this.$steps[this.current].exit("fade",300).promise.then(()=>this.$steps[e].enter("fade",300)),this.$legend.animate({height:t},600).promise.then(()=>this.$legend.css("height","auto")),this.current=e,this.trigger("step",e)}}goNext(){this.locked||(this.go(this.current+1),this.trigger("next",this.current))}goBack(){this.locked||(this.go(this.current-1),this.trigger("back",this.current))}};Slideshow=__decorate([register("x-slideshow",{templateId:"#slideshow"})],Slideshow);const COLORS=loop(Color.rainbow(8)),IMAGES=loop(["badge","homework","laurels","lightbulb","owl","scroll","trophy"]);let Solved=class extends CustomElementView{constructor(){super(...arguments),this.visible=!1}ready(){this.$svg=this.$("use"),this.$text=this.$(".message"),this.$step=this.getModel().$step,this.on("click",()=>this.exit())}enter(){if(this.visible)return ResolvedAnimation;this.visible=!0;const e=this.$step?this.$step.addHint("correct").text:"correct",t=COLORS(),i=IMAGES();return this.css("background-color",t.toString()),this.$text.text=e.replace(/<.*?>/g,""),this.$svg.setAttr("xlink:href","/sketch.svg#"+i),replaceSvgImports(),enter(this,"pop",300,600)}exit(){return this.visible?(this.visible=!1,exit(this,"pop",300)):ResolvedAnimation}};Solved=__decorate([register("x-solved",{templateId:"#solved"})],Solved);let Sortable=class extends CustomElementView{ready(){this.items=this.children.map(e=>({drag:new Draggable(e,this,{moveX:!1,useTransform:!0}),index:+e.data.index,h:0}));for(const e of this.children)e.removeAttr("data-index");for(const e of this.items)e.drag.on("drag",()=>{this.items=sortBy(this.items,t=>t.drag.position.y-(t===e?10:0)),position(this.items,e)}),e.drag.on("end",()=>{position(this.items),check(this.items)&&this.solve()});Browser.onResize(()=>{for(const e of this.items)e.h=e.drag.$el.height;const e=total(this.items.map(e=>e.h));this.css("height",e+10*this.items.length-10+"px"),position(this.items)})}solve(){this.trigger("solve"),this.addClass("solved");for(let e of this.items)e.drag.disabled=!0}};Sortable=__decorate([register("x-sortable")],Sortable);const colours=loop(["#cd0e66","#0f82f2","#22ab24","#fd8c00"]);class Particle{constructor(e){this.index=e,this.color=colours(),this.tilt=Math.floor(10*Math.random())-10,this.tiltAngleIncrement=.07*Math.random()+.05,this.tiltAngle=0,this.x=Math.random()*Browser.width,this.y=(Math.random()-1)*Browser.height,this.r=Random$1.uniform(10,30)}draw(e){e.beginPath(),e.lineWidth=this.r/2,e.strokeStyle=this.color,e.moveTo(this.x+this.tilt+this.r/4,this.y),e.lineTo(this.x+this.tilt,this.y+this.tilt+this.r/4),e.stroke()}update(e,t){this.tiltAngle+=this.tiltAngleIncrement,this.y+=(Math.cos(e)+3+this.r/2)/2,this.x+=Math.sin(e),this.tilt=15*Math.sin(this.tiltAngle-this.index/3),-20>this.x?(this.x=-20,this.y=Math.random()*Browser.height,this.tilt=Math.floor(10*Math.random())-20):this.x>Browser.width+20?(this.x=Browser.width+20,this.y=Math.random()*Browser.height,this.tilt=Math.floor(10*Math.random())-20):t&&this.y>Browser.height&&(this.x=Math.random()*Browser.width,this.y=-10,this.tilt=Math.floor(10*Math.random())-20)}}const style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999";let $confetti=null,Step=class extends CustomElementView{constructor(){super(...arguments),this.model=observable({$step:this}),this.tools={confetti},this.isShown=!1,this.isCompleted=!1,this.scores=new Set}ready(){this.goals=words(this.attr("goals")),this.$course=(this.getModel()||{}).$course,this.$blanks=this.$$("x-blank, x-blank-input");for(const[e,t]of this.$blanks.entries())t.on("valid",()=>{this.addHint("correct"),this.score("blank-"+e)}),t.on("invalid",()=>this.addHint("incorrect")),t.on("hint",e=>this.addHint(`Hmmm… maybe try ${e}?`));this.$equations=this.$$("x-equation, x-equation-system").filter(e=>!e.parents("x-equation-system").length);for(const[e,t]of this.$equations.entries())t.on("solve",()=>{this.addHint("correct"),this.score("eqn-"+e)});for(const e of this.$$("x-equation-system"))e.on("hint",e=>this.addHint(e));this.$reveals=this.$$(".reveal");for(let e of this.$reveals){e.data.display="visibility";const t=+e.data.duration||400,i=+e.data.delay||0;this.onScore(e.data.when,()=>__awaiter(this,void 0,void 0,function*(){"visible"===e.css("visibility")||(yield e.enter(e.data.animation||"fade",t,i).promise,e.css("opacity",""))}))}this.$nextBtn=this.$$(".next-step");for(const[e,t]of this.$nextBtn.entries())this.onScore("next-"+e,()=>t.exit("pop")),t.one("click",()=>this.score("next-"+e));for(let e of this.$$(".check[data-when]"))this.onScore(e.data.when,()=>e.addClass("visible"));this.$picker=this.$("x-picker"),this.$picker&&(this.$picker.on("hint",t=>this.addHint(t.msg,{class:t.class})),this.$picker.on("score",t=>this.score(t)));for(const e of this.$$(".step-target"))hover(e,{enter:()=>{const t=this.$$("[target~=\""+e.data.to+"\"]");for(let e of t)e.addClass("focus");this.addClass("focus")},exit:()=>{for(let e of this.$$(".focus"))e.removeClass("focus");this.removeClass("focus")}});const e=this.$("x-slideshow");e&&e.on("next",e=>this.score("slide-"+(e-1))),this.$sortables=this.$$("x-sortable");for(const[e,t]of this.$sortables.entries())t.on("solve",()=>{this.addHint("correct"),this.score("sortable-"+e)});const t=this.$("x-gameplay");t&&t.on("score",()=>this.score("gameplay")),this.$$("x-slider").forEach((e,t)=>{e.on("slide-end",()=>this.score("slider-"+t))});const i=this.$("x-quill");i&&i.on("submit",()=>this.score("quill"));for(const[e,t]of this.$$("x-var").entries())t.on("slide-end",()=>this.score("var-"+e));for(let e of this.$$(".var"))e.bindObservable(this.model,!1)}show(){if(this.isShown)return;this.isShown=!0;try{const e=toCamelCase(this.id);window.StepFunctions&&window.StepFunctions[e]&&window.StepFunctions[e](this)}catch(t){console.error(t)}this.initialData&&this.restore(this.initialData);const e=this.$$("x-gesture[target]");setTimeout(()=>{if(!this.isReady)for(let t of e)t.start()},2e3),this.$course&&this.$course.log("Step","show",this.id),this.trigger("show"),this.addClass("on"),Browser.resize()}complete(){if(!this.isCompleted){this.isShown||this.show(),this.isCompleted=!0;for(let e of this.$reveals)"visible"!==e.css("visibility")&&e.enter("fade",400).promise.then(()=>e.css("opacity",""));for(let e=0;e<this.$nextBtn.length;++e)this.score("next-"+e);this.trigger("complete")}}restore(e){this.$blanks.forEach((t,n)=>{e.scores.includes("blank-"+n)&&t.solve()}),this.$equations.forEach((t,n)=>{e.scores.includes("eqn-"+n)&&t.solve()}),this.$sortables.forEach((t,n)=>{e.scores.includes("sortable-"+n)&&t.solve()}),this.$picker&&this.$picker.restore(e.scores.filter(e=>e.startsWith("picker-"))),e.scores.forEach(e=>this.score(e,!1))}get isReady(){return this.goals.every(e=>this.scores.has(e))}score(e,t=!0){this.scores.has(e)||(this.scores.add(e),this.trigger("score-"+e),this.trigger("score"),this.$course&&(this.$course.trigger("score"),this.$course.saveProgress({steps:{[this.id]:{scores:[e]}}}),this.$course.log("Step","score",this.id+"/"+e)),t&&this.isReady&&this.$course&&this.$course.isReady&&setTimeout(()=>{this.$course.$activeStep===this&&this.$course.nextStep()},1e3))}storeData(e,t){this.$course&&this.$course.saveProgress({steps:{[this.id]:{data:{[e]:t}}}})}onScore(e,t){const i=words(e);if(i.every(e=>this.scores.has(e)))return t();if(1===i.length)return this.one("score-"+i[0],t);const n=()=>{i.every(e=>this.scores.has(e))&&(t(),this.off("score",n))};this.on("score",n)}addHint(e,t={}){return this.trigger("hint",e),this.$course&&this.$course.isReady?this.isInViewport?this.$course.$tutor.showHint(e,t):(this.one("enterViewport",()=>this.$course.$tutor.showHint(e,t)),{text:this.$course.$tutor.hints[e]||e}):{text:e}}getText(e){return this.$course&&this.$course.$tutor?this.$course.$tutor.hints[e]||e:e}getHelp(){}delayedHint(e,i=1e4){let t=setTimeout(e,i);this.on("score",()=>{clearTimeout(t),this.isCompleted||(t=setTimeout(e,2e4))}),this.on("complete",()=>clearTimeout(t))}};Step=__decorate([register("x-step")],Step);const $fixed=$$("header, x-tutor, .sidebar"),$targets=$N("svg",{class:"target-body",style:`position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            display: none; pointer-events: none; z-index: 900; opacity: 0;
            transform: translateZ(0); will-change: opacity; transition: opacity .3s;`,html:`<defs>
      <mask id="masking"><rect width="100%" height="100%" fill="white"/></mask>
    </defs>
    <marker id="arrow" viewBox="0 0 10 10" refX="5" refY="5" markerWidth="4" markerHeight="4" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z"/>
    </marker>
    <rect x="0" y="0" width="100%" height="100%" mask="url(#masking)" fill="white" opacity="0.9"/>
    <path id="target-arrow" stroke="black" stroke-width="5" marker-end="url(#arrow)" opacity="0.3" stroke-linecap="round"/>`},$body),$mask=$targets.$("mask"),$arrow=$targets.$("#target-arrow");let active=!1,$bounds=[],Target=class extends CustomElementView{ready(){function t(){active=!0;let e=$$(a);if(!e.length)return;let t=e[0].hasParent(...$fixed);null===l&&(l=r.hasParent(...$fixed));let i=r.bounds,n=e.map(e=>e.bounds).filter(e=>e.width||e.height);if(p=0,!t){let e=Math.min(...n.map(e=>e.top)),t=Math.max(...n.map(e=>e.top+e.height)),i=Browser.height-12-t,s=(window.isWebView?12:56)-e;p=0>i?i:0<s?s:0}for(const e of $bounds)e.remove();$bounds=[i].concat(n).map((e,t)=>{let i=t&&!o?10:4;return $N("rect",{x:e.left-i,y:e.top-i+(t||!l?p:0),width:e.width+2*i,height:e.height+2*i,rx:4,ry:4},$mask)}),$arrow.points=connect(i,n[0],l?0:p,t?0:p)}function i(){p&&$body.scrollBy(-p,300),$targets.css("display","block"),Browser.redraw(),delay(function(){$targets.css("opacity",1)},p?300:0)}function n(e){if(active){if(e){let t=isOneOf(e.type,"mousemove","pointermove");if(t&&40>distance(d,[e.clientX,e.clientY]))return}clearTimeout(c),active=!1,$targets.css("opacity",0),setTimeout(function(){active||$targets.css("display","none")},300),$body.off("mousewheel mousemove touchend touchmove",n),r.off("mouseleave",n)}}function s(){$body.on(p&&!l?"mousemove":"mouseleave",n),$body.on("mousewheel touchend touchmove",n)}const r=this;let a=r.attr("to"),o=r.hasAttr("no-margins"),l=null,d,p,c;r.on("mouseenter touchstart",function(n){d=[n.clientX,n.clientY],t(),c=window.setTimeout(i,p?50:30),s()}),r.on("click",t=>{active?(t.handled=!0,n(),setTimeout(()=>$(a).trigger("click mousedown"))):(active=!0,p=0,i(),s())})}};Target=__decorate([register("x-target")],Target);const MATHS_REGEX=/[0-9+\-*/()^\s]+/g;let Tutor=class extends CustomElementView{constructor(){super(...arguments),this.recentMessages=[],this.isOpen=!1,this.queuePromise=Promise.resolve()}ready(){this.$course=(this.getModel()||{}).$course,this.hints=JSON.parse($("#hints").text)||{},this.correct=loop(Random$1.shuffle(this.hints.correct||[])),this.incorrect=loop(Random$1.shuffle(this.hints.incorrect||[])),this.$toasts=this.$(".toasts"),this.$chat=this.$(".chat"),this.$chatBody=this.$(".chat-body"),this.$toasts.on("click",t=>{t.handled||this.open()}),this.$(".close").on("click",()=>this.close());const e=this.$(".chat-footer");this.$query=e.$(".input"),this.$query.onKeyDown("enter",t=>{t.preventDefault(),this.askQuestion(this.$query.text.trim()),this.$query.text=""}),this.$query.on("focus",()=>e.addClass("focus")),this.$query.on("blur",()=>e.removeClass("focus")),this.$(".hint").on("click",()=>{this.queue(this.hints.tutorial1),this.queue(this.$course.user?this.hints.tutorial2:this.hints.account)})}open(){this.isOpen||(this.isOpen=!0,this.$chat.enter("slide-up",200),this.$chatBody.scrollTop=this.$chatBody.scrollHeight,this.trigger("open"))}close(){this.isOpen&&(this.isOpen=!1,this.$query.blur(),this.trigger("close"),this.$chat.exit("slide-down",200))}queue(e,t="hint",i={}){this.queuePromise=this.queuePromise.then(()=>(this.display(e,t,i),wait(500)))}display(e,t="hint",i={}){let n=i.timeout||8e3;if(640>Browser.width&&(n*=.7),i.toast&&!this.isOpen){const s=createMsgElement(e,t,i);this.$toasts.append(s),s.enter("reveal-right"),setTimeout(()=>s.exit("reveal-right",400,0,!0),n),this.on("open",()=>s.exit("reveal",200,0,!0))}const s=createMsgElement(e,t,{class:i.class,visible:!this.isOpen});this.$chatBody.append(s),this.isOpen&&(s.enter("reveal",300),animate(()=>this.$chatBody.scrollTop=this.$chatBody.scrollHeight,200))}showHint(e,t={}){if(isOneOf(e,"correct","incorrect")){const i="correct"===e?this.correct():this.incorrect(),n="correct"===e?3e3:5e3;return this.queue(i,"hint",{class:t.class||e,timeout:n}),{text:i}}let i=this.hints[e]||e;if(t.variables)for(let[e,n]of Object.entries(t.variables))i=i.replace(new RegExp("\\$"+e,"g"),n);return!t.force&&this.recentMessages.includes(e)?{text:i}:(this.recentMessages.push(e),setTimeout(()=>this.recentMessages.shift(),1e4),!1!==t.store&&this.$course.saveProgress({hints:[{content:i,kind:"hint"}]}),this.queue(i,"hint",{class:t.class}),{text:i})}askQuestion(query){if(query){this.queue(query,"question"),this.$course&&this.$course.log("Tutor","ask",query);const equation=(query.match(MATHS_REGEX)||[]).filter(e=>3<=e.length&&!e.match(/^[\s0-9]+$/));if(equation.length)try{const result=eval(equation[0].replace(/\b0+/g,"0").replace(/\^/g,"**"));return this.queue("= "+result)}catch(t){console.error("Parse Error:",equation[0])}}}meanEasterEgg(){}};Tutor=__decorate([register("x-tutor",{templateId:"#tutor"})],Tutor);const $overlay=$N("div",{class:"var-overlay"},$body);let Variable=class extends CustomElementView{ready(){const e=this,t=e.attr("bind");if(!t)return;let[i,n,s]=t.split("|"),[r,a,o]=s.split(",").map(e=>+e),l=+n;const d=this.getModel();d.set(i,l),this.$(".content").bindObservable(d);let p=e.$(".progress");p.css("width",116*(+l-r)/(a-r)+"px");let c=0,h=0,g=Math.max((a-r)/240,o/20),u=!1;slide(e,{start(t){c=t.x,h=l,e.addClass("on"),u=!1,$overlay.show()},move(e){let t=(e.x-c)*g,n=roundTo$1(clamp$1(h+t,r,a),o);n=round(n,2),n===l||(l=n,u=!0,d&&d.set(i,l),p.css("width",116*(l-r)/(a-r)+"px"))},end(){e.removeClass("on"),u&&e.trigger("slide-end"),$overlay.hide()}})}};Variable=__decorate([register("x-var",{templateId:"#var"})],Variable);let Video=class extends CustomElementView{ready(){const e=this.attr("src"),t=this.$(".video-wrap"),i=this.$("video"),n=this.attr("width"),s=this.attr("height");this.css("width",n+"px"),t.css("padding-bottom",100*(+s/+n)+"%"),i.setAttr("poster",this.attr("poster")||e.replace(/mp4$/,"jpg")),this.hasAttr("loop")&&(i._el.loop=!0),this.hasAttr("audio")||(i._el.muted=!0),$N("source",{src:e,type:"video/mp4"},i),this.hasAttr("credit")&&(this.$(".credit").text=this.attr("credit"));const r=this.$(".bar"),a=this.$(".progress"),o=this.$(".buffer"),l=this.$(".timecode"),d=new Draggable(this.$(".handle"),r,{moveY:!1}),p=this.video=i._el;let c=this.width-110;Browser.onResize(()=>c=this.width-110),i.on("canplay",()=>{l.text=formatTime(+p.duration)}),i.on("timeupdate",()=>{const e=p.currentTime/p.duration;a.css("width",100*e+"%"),l.text=formatTime(+p.currentTime),d.setPosition(e*c,0),this.trigger("timeupdate",p.currentTime)}),i.on("progress",()=>{if(0>=p.buffered.length||0>=p.duration)return;const e=p.buffered.end(p.buffered.length-1),t=100*(e/p.duration);o.css("width",t+"%")}),i.on("ended",()=>{p.pause(),this.removeClass("playing"),this.trigger("end")});const h=()=>p.paused?this.play():this.pause(),g=e=>this.setTime(e/c*p.duration);this.hasAttr("hover")?(i.on("mouseover touchstart",()=>this.play()),i.on("mouseout touchend touchcancel",()=>this.pause())):i.on("click",h),this.hasAttr("controls")&&(this.$(".controls").show(),this.$(".play-pause-btn").on("click",h),d.on("start",()=>this.pause()),d.on("drag",e=>g(e.x)),r.on("click",t=>g(t.offsetX)))}setTime(e){this.video.currentTime=e}play(){this.video.play(),this.addClass("playing"),this.trigger("play")}pause(){this.video.pause(),this.removeClass("playing")}};Video=__decorate([register("x-video",{templateId:"#video"})],Video);let Gesture=class extends CustomElementView{constructor(){super(...arguments),this.doAnimation=!1,this.$end=null,this.$target=null}created(){this.slide=parseAttr(this.attr("slide")),this.shift=parseAttr(this.attr("offset"))}ready(){this.$target=$(this.attr("target")),this.$target&&(this.$target.on("click pointerdown",()=>this.stop()),this.hasAttr("start")&&this.start())}start(e){this.doAnimation||!this.$target||(this.doAnimation=!0,e&&(this.slide=e),this.slide||this.$end?this.runSlideAnimation():this.runClickAnimation())}startSlide(e,t){this.$target=e,this.$end=t,this.start()}stop(){this.doAnimation=!1}runSlideAnimation(){return __awaiter(this,void 0,void 0,function*(){this.show();let e=this.from||getPosition(this,this.$target);this.shift&&(e=e.add(this.shift));const t=this.slide?e.add(this.slide):getPosition(this,this.$end),i=`translate(${e.x-15}px,${e.y-10}px)`,n=`translate(${t.x-15}px,${t.y-10}px)`;yield this.animate({transform:[i+" scale(2)",i],opacity:[0,1]},300).promise,yield this.animate({transform:[i,n]},1e3).promise,yield this.animate({transform:[n,n+" scale(2)"],opacity:[1,0]},300).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runSlideAnimation()},1e3)})}runClickAnimation(){return __awaiter(this,void 0,void 0,function*(){this.show();let e=this.from||getPosition(this,this.$target);this.shift&&(e=e.add(this.shift));const t=`translate(${e.x-15}px,${e.y-10}px)`;yield this.animate({transform:[t+" scale(2)",t],opacity:[0,1]},500).promise,yield this.animate({transform:[t,t+" scale(2)"],opacity:[1,0]},500,200).promise,this.hide(),setTimeout(()=>{this.doAnimation&&this.runClickAnimation()},1e3)})}};Gesture=__decorate([register("x-gesture",{templateId:"#gesture"})],Gesture);let IconBtn=class extends CustomElementView{ready(){const e=this.$("use"),t=e.attr("xlink:href").replace("#xxx","#");e.setAttr("xlink:href",t+this.attr("icon")),this.on("attr:icon",({newVal:i})=>e.setAttr("xlink:href",t+i))}};IconBtn=__decorate([register("x-icon-btn",{templateId:"#icon-btn",attributes:["icon"]})],IconBtn);let Parallax=class extends CustomElementView{ready(){function e(r){if(!(r.top<n||r.top>s)){const e=(r.top-n)/(s-n)*(i?50:33);t.css("transform",`translateY(${e}%)`)}}const t=this.$(".image"),i=50>this.positionTop;let n,s;t.css({"background-image":`url("${this.attr("background")}")`,height:i?"100%":"150%"});Browser.onResize(({height:e})=>{const t=this.positionTop;n=Math.max(0,t-e),s=t+this.height}),$body.on("scroll",e)}};Parallax=__decorate([register("x-parallax",{templateId:"#parallax"})],Parallax);let Popup=class extends CustomElementView{constructor(){super(...arguments),this.isOpen=!1}ready(){this.animation=this.attr("animation")||"pop",this.$bubble=this.$(".popup-body"),this.$bubble.hide();const e=this.$(".popup-target");e.on("click",()=>this.toggle()),this.on("clickOutside",()=>this.close());for(const e of this.$bubble.$$("a"))e.on("click",()=>this.close())}toggle(){this.isOpen?this.close():this.open()}open(){this.isOpen||(this.isOpen=!0,this.addClass("active"),this.$bubble.enter(this.animation,200))}close(){this.isOpen&&(this.isOpen=!1,this.removeClass("active"),this.$bubble.exit(this.animation,200))}};Popup=__decorate([register("x-popup")],Popup);const template="<div class=\"titles\"></div><div class=\"body\"><slot></slot></div>";let Tabbox=class extends CustomElementView{constructor(){super(...arguments),this.$titles=[],this.active=0}ready(){const e=this.$(".titles");this.$body=this.$(".body"),this.$tabs=this.$$(".tab");for(let t=0;t<this.$tabs.length;++t){const i=this.$tabs[t].$("h3")||$N("h3");e.append(i),this.$titles.push(i),i.on("click",()=>this.makeActive(t))}this.$titles[0].addClass("active"),this.$tabs[0].show()}makeActive(e){if(this.active!==e){this.$titles[this.active].removeClass("active"),this.$titles[e].addClass("active"),this.$tabs[e].show();const t=this.$tabs[e].outerHeight+"px";this.$tabs[e].hide(),this.$tabs[this.active].exit("fade",300).promise.then(()=>this.$tabs[e].enter("fade",300)),this.$body.animate({height:t},600).promise.then(()=>this.$body.css("height","auto")),this.active=e,this.trigger("change",e)}}};Tabbox=__decorate([register("x-tabbox",{template:"<div class=\"titles\"></div><div class=\"body\"><slot></slot></div>"})],Tabbox);const PADDING=12;let Progress=class extends CustomElementView{constructor(){super(...arguments),this.completed=!1}ready(){this.r=+this.attr("r")||10,this.r1=this.r+PADDING,this.$svg=$N("svg",{width:2*this.r1,height:2*this.r1},this),this.$progress=$N("path",{class:"pie",d:getProgress(this.r),"stroke-width":this.r},this.$svg),this.setProgress(+this.attr("p"),!1)}setProgress(e,t=!0){if(.99<e)return this.complete(t);const i=Math.PI*this.r;this.$progress.css("stroke",e?"currentColor":"none"),this.$progress.css("stroke-dasharray",`${e*i} ${i}`)}complete(e=!0){if(this.completed)return;if(this.completed=!0,this.$progress.css("stroke","none"),this.$progress.css("fill","currentColor"),this.$progress.setAttr("d",getCheck(this.r)),!e)return;const t=`translate(${this.r1} ${this.r1})`,i=$N("g",{transform:t},this.$svg),n=tabulate(()=>$N("line",{},i),18);animate(e=>{const t=this.r+PADDING*ease("quint-out",e),r=this.r+PADDING*e;for(let a=0;18>a;++a){const e=Math.cos(2*Math.PI*a/18),i=Math.sin(2*Math.PI*a/18);n[a].setLine({x:e*t,y:i*t},{x:e*r,y:i*r})}},800).promise.then(()=>i.remove())}};Progress=__decorate([register("x-progress")],Progress);const $modalBackground=$N("div",{class:"modal-background"},$body);let $openModal=null;$modalBackground.on("click",tryClose),Browser.onKey("escape",tryClose),$modalBackground.on("scrollwheel touchmove",t=>{t.preventDefault(),t.stopPropagation()}),Browser.onKey("space up down pagedown pageup",t=>{$openModal&&(t.preventDefault(),t.stopPropagation())}),Browser.onResize(()=>{$openModal&&$openModal.css("transform","translate(-50%, -50%)")});let Modal=class extends CustomElementView{constructor(){super(...arguments),this.isOpen=!1,this.$iframe=null,this.canClose=!0}ready(){this.canClose=!this.hasAttr("no-close"),this.$iframe=this.$("iframe[data-src]");const e=$$(`[data-modal=${this.id}]`);for(let t of e)t.on("click",()=>this.open());RouterInstance.on("afterChange",({$viewport:e})=>{const t=e.$$(`[data-modal=${this.id}]`);for(let i of t)i.on("click",()=>this.open())}),this.hasClass("open")&&!$openModal&&($modalBackground.show(),this.show(),this.isOpen=!0,$openModal=this);const t=this.$(".close");t&&t.on("click",()=>this.close())}open(){this.isOpen||($modalBackground.setClass("light",this.hasClass("light")),$openModal?$openModal.close(!0):$modalBackground.enter("fade",250),this.isOpen=!0,$openModal=this,this.$iframe&&this.$iframe.setAttr("src",this.$iframe.data.src),this.enter("pop",250),this.trigger("open"))}close(e=!1,t=!1){this.isOpen&&(this.isOpen=!1,$openModal=null,this.$iframe&&this.$iframe.setAttr("src",""),!e&&$modalBackground.exit("fade",250),this.exit("pop",250).promise.then(()=>this.css("transform","")),!t&&this.trigger("close"))}};Modal=__decorate([register("x-modal")],Modal);let Select=class extends CustomElementView{ready(){const e=this.children;this.$active=this.$(".active")||e[0],this.$active.addClass("active");for(let t of e)t.on("click",()=>this.makeActive(t));this.trigger("change",this.$active)}makeActive(e){e===this.$active||(this.$active.removeClass("active"),this.$active=e,e.addClass("active"),this.trigger("change",e))}};Select=__decorate([register("x-select")],Select);const VERSION="2.4.1",DEV_ID="i5iSjo",VERSION_PARAM="_av",USAGE_PARAM="_au",NULL_DIMENSION="(not set)",instances=[];class MethodChain{static add(e,t,i){getOrCreateMethodChain(e,t).add(i)}static remove(e,t,i){getOrCreateMethodChain(e,t).remove(i)}constructor(e,t){this.context=e,this.methodName=t,this.isTask=/Task$/.test(t),this.originalMethodReference=this.isTask?e.get(t):e[t],this.methodChain=[],this.boundMethodChain=[],this.wrappedMethod=(...e)=>{const t=this.boundMethodChain[this.boundMethodChain.length-1];return t(...e)},this.isTask?e.set(t,this.wrappedMethod):e[t]=this.wrappedMethod}add(e){this.methodChain.push(e),this.rebindMethodChain()}remove(e){const t=this.methodChain.indexOf(e);-1<t&&(this.methodChain.splice(t,1),0<this.methodChain.length?this.rebindMethodChain():this.destroy())}rebindMethodChain(){this.boundMethodChain=[];for(let e=0,t;t=this.methodChain[e];e++){const i=this.boundMethodChain[e-1]||this.originalMethodReference.bind(this.context);this.boundMethodChain.push(t(i))}}destroy(){const e=instances.indexOf(this);-1<e&&(instances.splice(e,1),this.isTask?this.context.set(this.methodName,this.originalMethodReference):this.context[this.methodName]=this.originalMethodReference)}}const proto=window.Element.prototype,nativeMatches=proto.matches||proto.matchesSelector||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector,a=document.createElement("a"),queueMap={},assign=Object.assign||function(e,...t){for(let n=0,i=t.length;n<i;n++){const i=Object(t[n]);for(let t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},uuid=function e(t){return t?(t^16*Math.random()>>t/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e)};class EventEmitter{constructor(){this.registry_={}}on(e,t){this.getRegistry_(e).push(t)}off(e=void 0,t=void 0){if(e&&t){const i=this.getRegistry_(e),n=i.indexOf(t);-1<n&&i.splice(n,1)}else this.registry_={}}emit(e,...t){this.getRegistry_(e).forEach(e=>e(...t))}getEventCount(){let e=0;return Object.keys(this.registry_).forEach(t=>{e+=this.getRegistry_(t).length}),e}getRegistry_(e){return this.registry_[e]=this.registry_[e]||[]}}const AUTOTRACK_PREFIX="autotrack",instances$1={};let isListening=!1,browserSupportsLocalStorage;class Store extends EventEmitter{static getOrCreate(e,t,i){const n=[AUTOTRACK_PREFIX,e,t].join(":");return instances$1[n]||(instances$1[n]=new Store(n,i),!isListening&&initStorageListener()),instances$1[n]}static isSupported_(){if(null!=browserSupportsLocalStorage)return browserSupportsLocalStorage;try{window.localStorage.setItem(AUTOTRACK_PREFIX,AUTOTRACK_PREFIX),window.localStorage.removeItem(AUTOTRACK_PREFIX),browserSupportsLocalStorage=!0}catch(e){browserSupportsLocalStorage=!1}return browserSupportsLocalStorage}static get_(e){return window.localStorage.getItem(e)}static set_(e,t){window.localStorage.setItem(e,t)}static clear_(e){window.localStorage.removeItem(e)}constructor(e,t={}){super(),this.key_=e,this.defaults_=t,this.cache_=null}get(){if(this.cache_)return this.cache_;if(Store.isSupported_())try{this.cache_=parse$2(Store.get_(this.key_))}catch(e){}return this.cache_=assign({},this.defaults_,this.cache_)}set(e){if(this.cache_=assign({},this.defaults_,this.cache_,e),Store.isSupported_())try{Store.set_(this.key_,JSON.stringify(this.cache_))}catch(e){}}clear(){if(this.cache_={},Store.isSupported_())try{Store.clear_(this.key_)}catch(e){}}destroy(){delete instances$1[this.key_],Object.keys(instances$1).length||removeStorageListener()}}const SECONDS=1e3,MINUTES=60000,instances$2={};class Session{static getOrCreate(e,t,i){const n=e.get("trackingId");return instances$2[n]?instances$2[n]:instances$2[n]=new Session(e,t,i)}constructor(e,t,i){this.tracker=e,this.timeout=t||Session.DEFAULT_TIMEOUT,this.timeZone=i,this.sendHitTaskOverride=this.sendHitTaskOverride.bind(this),MethodChain.add(e,"sendHitTask",this.sendHitTaskOverride);try{this.dateTimeFormatter=new Intl.DateTimeFormat("en-US",{timeZone:this.timeZone})}catch(e){}this.store=Store.getOrCreate(e.get("trackingId"),"session",{hitTime:0,isExpired:!1}),this.store.get().id||this.store.set({id:uuid()})}getId(){return this.store.get().id}isExpired(e=this.getId()){if(e!=this.getId())return!0;const t=this.store.get();if(t.isExpired)return!0;const i=t.hitTime;if(i){const e=new Date,t=new Date(i);if(e-t>this.timeout*MINUTES||this.datesAreDifferentInTimezone(e,t))return!0}return!1}datesAreDifferentInTimezone(e,t){return!!this.dateTimeFormatter&&this.dateTimeFormatter.format(e)!=this.dateTimeFormatter.format(t)}sendHitTaskOverride(e){return t=>{e(t);const i=t.get("sessionControl"),n="start"==i||this.isExpired(),s=this.store.get();s.hitTime=now(),n&&(s.isExpired=!1,s.id=uuid()),"end"==i&&(s.isExpired=!0),this.store.set(s)}}destroy(){MethodChain.remove(this.tracker,"sendHitTask",this.sendHitTaskOverride),this.store.destroy(),delete instances$2[this.tracker.get("trackingId")]}}Session.DEFAULT_TIMEOUT=30;const plugins={CLEAN_URL_TRACKER:1,EVENT_TRACKER:2,IMPRESSION_TRACKER:3,MEDIA_QUERY_TRACKER:4,OUTBOUND_FORM_TRACKER:5,OUTBOUND_LINK_TRACKER:6,PAGE_VISIBILITY_TRACKER:7,SOCIAL_WIDGET_TRACKER:8,URL_CHANGE_TRACKER:9,MAX_SCROLL_TRACKER:10},PLUGIN_COUNT=Object.keys(plugins).length,HIDDEN="hidden",VISIBLE="visible",PAGE_ID=uuid(),SECONDS$1=1e3;class PageVisibilityTracker{constructor(e,t){if(trackUsage(e,plugins.PAGE_VISIBILITY_TRACKER),!!document.visibilityState){const i={sessionTimeout:Session.DEFAULT_TIMEOUT,visibleThreshold:5*SECONDS$1,sendInitialPageview:!1,fieldsObj:{}};this.opts=assign(i,t),this.tracker=e,this.lastPageState=document.visibilityState,this.visibleThresholdTimeout_=null,this.isInitialPageviewSent_=!1,this.trackerSetOverride=this.trackerSetOverride.bind(this),this.handleChange=this.handleChange.bind(this),this.handleWindowUnload=this.handleWindowUnload.bind(this),this.handleExternalStoreSet=this.handleExternalStoreSet.bind(this),this.store=Store.getOrCreate(e.get("trackingId"),"plugins/page-visibility-tracker"),this.store.on("externalSet",this.handleExternalStoreSet),this.session=Session.getOrCreate(e,this.opts.sessionTimeout,this.opts.timeZone),MethodChain.add(e,"set",this.trackerSetOverride),window.addEventListener("unload",this.handleWindowUnload),document.addEventListener("visibilitychange",this.handleChange),deferUntilPluginsLoaded(this.tracker,()=>{document.visibilityState==VISIBLE?(this.opts.sendInitialPageview&&(this.sendPageview({isPageLoad:!0}),this.isInitialPageviewSent_=!0),this.store.set({time:now(),state:VISIBLE,pageId:PAGE_ID,sessionId:this.session.getId()})):this.opts.sendInitialPageview&&this.opts.pageLoadsMetricIndex&&this.sendPageLoad()})}}handleChange(){if(document.visibilityState!=VISIBLE&&document.visibilityState!=HIDDEN)return;const e=this.getAndValidateChangeData(),t={time:now(),state:document.visibilityState,pageId:PAGE_ID,sessionId:this.session.getId()};document.visibilityState==VISIBLE&&this.opts.sendInitialPageview&&!this.isInitialPageviewSent_&&(this.sendPageview(),this.isInitialPageviewSent_=!0),document.visibilityState==HIDDEN&&this.visibleThresholdTimeout_&&clearTimeout(this.visibleThresholdTimeout_),this.session.isExpired(e.sessionId)?(this.store.clear(),this.lastPageState==HIDDEN&&document.visibilityState==VISIBLE&&(clearTimeout(this.visibleThresholdTimeout_),this.visibleThresholdTimeout_=setTimeout(()=>{this.store.set(t),this.sendPageview({hitTime:t.time})},this.opts.visibleThreshold))):(e.pageId==PAGE_ID&&e.state==VISIBLE&&this.sendPageVisibilityEvent(e),this.store.set(t)),this.lastPageState=document.visibilityState}getAndValidateChangeData(){const e=this.store.get();return this.lastPageState==VISIBLE&&e.state==HIDDEN&&e.pageId!=PAGE_ID&&(e.state=VISIBLE,e.pageId=PAGE_ID,this.store.set(e)),e}sendPageVisibilityEvent(e,{hitTime:t}={}){const i=this.getTimeSinceLastStoredChange(e,{hitTime:t});if(i&&i>=this.opts.visibleThreshold){const e=Math.round(i/SECONDS$1),n={transport:"beacon",nonInteraction:!0,eventCategory:"Page Visibility",eventAction:"track",eventValue:e,eventLabel:NULL_DIMENSION};t&&(n.queueTime=now()-t),this.opts.visibleMetricIndex&&(n["metric"+this.opts.visibleMetricIndex]=e),this.tracker.send("event",createFieldsObj(n,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}}sendPageLoad(){const e={transport:"beacon",eventCategory:"Page Visibility",eventAction:"page load",eventLabel:NULL_DIMENSION,["metric"+this.opts.pageLoadsMetricIndex]:1,nonInteraction:!0};this.tracker.send("event",createFieldsObj(e,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}sendPageview({hitTime:e,isPageLoad:t}={}){const i={transport:"beacon"};e&&(i.queueTime=now()-e),t&&this.opts.pageLoadsMetricIndex&&(i["metric"+this.opts.pageLoadsMetricIndex]=1),this.tracker.send("pageview",createFieldsObj(i,this.opts.fieldsObj,this.tracker,this.opts.hitFilter))}trackerSetOverride(e){return(t,i)=>{const n=isObject(t)?t:{[t]:i};n.page&&n.page!==this.tracker.get("page")&&this.lastPageState==VISIBLE&&this.handleChange(),e(t,i)}}getTimeSinceLastStoredChange(e,{hitTime:t}={}){return e.time?(t||now())-e.time:0}handleExternalStoreSet(e,t){e.time!=t.time&&(t.pageId!=PAGE_ID||t.state!=VISIBLE||this.session.isExpired(t.sessionId)||this.sendPageVisibilityEvent(t,{hitTime:e.time}))}handleWindowUnload(){this.lastPageState!=HIDDEN&&this.handleChange()}remove(){this.store.destroy(),this.session.destroy(),MethodChain.remove(this.tracker,"set",this.trackerSetOverride),window.removeEventListener("unload",this.handleWindowUnload),document.removeEventListener("visibilitychange",this.handleChange)}}return provide("pageVisibilityTracker",PageVisibilityTracker),window.$=$,window.$$=$$,window.Browser=Browser,replaceSvgImports(),$html.addClass((Browser.isMobile?"is":"not")+"-mobile"),Browser.isSafari&&$html.addClass("is-safari"),setTimeout(()=>$html.addClass("ready")),exports.Course=class extends CustomElementView{constructor(){super(...arguments),this.user=window.user,this.model=observable({$course:this}),this.isCompleted=!1,this.isReady=!1,this.$activeStep=null}created(){this.glossary=JSON.parse(this.$("#glossary").text)||{},this.userData=JSON.parse(this.$("#userdata").text)||{},this.$steps=this.$$("x-step");for(let e of this.$steps)e.on("score",()=>this.trigger("score")),e.initialData=(this.userData.steps||{})[e.id]||null}ready(){this.$footer=this.$("footer"),this.$skipStep=this.$footer.$(".skip-step"),this.$progress=this.$(".sidebar-row.on x-progress"),this.$tutor=this.$("x-tutor"),this.$stepsWrap=this.$(".steps");const e=this.$(".sidebar");e&&(this.$(".sidebar-toggle").on("click",()=>e.addClass("open")),this.$(".sidebar-shadow").on("pointerdown",()=>e.removeClass("open")));const t=this.findStep(Browser.getHash()),i=this.findStep(this.userData.activeStep);this.$activeStep=i||this.$steps[0];for(let e of this.$steps){if(e.show(),e===this.$activeStep)break;e.complete()}if(this.userData.completed||"full"===Browser.getHash())this.complete();else for(;this.$activeStep&&this.$activeStep.isReady&&!this.isCompleted;)this.nextStep();(t||i)&&this.goToStep(t||i,!1),this.$(".section-dev")&&this.complete();const n=this.$(".reveal-banner");setTimeout(()=>{this.isCompleted||(n.removeClass("off"),this.on("score complete",()=>n.addClass("off")))},1500),n.$(".complete").one("click",()=>this.complete()),Browser.onKey("space",t=>{t.preventDefault(),this.nextStep(),n.addClass("off")}),this.$footer.$(".skip").on("click",()=>this.nextStep()),this.$footer.$(".show-all").on("click",()=>this.complete()),this.isReady=!0,setTimeout(()=>this.addClass("ready"))}nextStep(){if(this.isCompleted)return;let e=this.$activeStep;const t=this.$stepsWrap.height;do{if(e.complete(),e=this.$steps[this.$steps.indexOf(e)+1],!e)return this.complete(!0);e.show()}while(e.isReady);this.$stepsWrap.animate({height:[t+"px","auto"]},800),this.$activeStep=e,this.saveProgress({activeStep:e.id})}goToStep(e,t=!0){const i=this.$stepsWrap.height;for(let i of this.$steps){if(i.isShown||(this.$activeStep=i),i.show(),e.isShown&&!i.isReady)break;i.complete()}const n=e.positionTop-Math.max(50,(Browser.height-e.height)/2);t?(this.$stepsWrap.animate({height:[i+"px","auto"]},800),$body.scrollTo(n)):$body.scrollTop=n;const s=last(this.$steps);return s.isShown&&s.isReady?this.complete():void(this.$activeStep&&this.saveProgress({activeStep:this.$activeStep.id}))}complete(e=!1){if(!this.isCompleted){this.isCompleted=!0,this.$steps.forEach(e=>e.complete()),this.$activeStep=null;const t=this.$footer.$(".next-section");e?(this.$skipStep.exit("fade",200),t&&t.enter("pop")):(this.$skipStep.hide(),t&&t.show()),this.trigger("complete"),this.saveProgress({completed:!0}),this.log("Course","complete")}}findStep(e){for(let t of this.$steps)if(t.id===e)return t;return null}saveProgress(e){if(this.isReady){const e=total(this.$steps.map(e=>e.scores.size));this.$progress.setProgress(e/+this.data.goals||0)}}log(e,t,i){}},exports.Course=__decorate([register("x-course")],exports.Course),exports}({});